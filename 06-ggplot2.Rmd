
# R graphics ggplot2

지난 5장에서는 R에서 기본으로 제공되는 그래프 함수를 알아보았습니다. 이번에는 `ggplot2`를 이용한 시각화에 대해서 알아봅니다. 데이터를 분석할 때 실제 데이터를 눈으로 확인하는 것은 중요합니다. 가능하면 raw 데이터를 보면서 크기 비교나 분포를 대략적으로 예측한다면 tool을 사용해서 나오는 결과를 가늠하는 척도가 될 수도 있습니다. 그러나 데이터가 커질경우 그래프를 이용해서 분포나 패턴을 확인하게되고 이를 위한 시각화 패키지 중 가장  많이 쓰이는 도구가 `ggplot2` 입니다.  `ggplot2` (https://ggplot2.tidyverse.org/)는 해들리위컴이 (Hadley Wickham) 만든 데이터 시각화 패키지입니다. `ggplot2`는 `tidyverse`의 (데이터 분석을 위한 패키지모음) 핵심 패키지 중 하나로서 `tidyverse`에는 `ggplot2` 외에도 다음에 배울 `dplyr` 등의 데이터 사이언스를 위한 유용한 패키지들이 함께 관리되고 있습니다. 본 강의는 https://r4ds.had.co.nz/data-visualisation.html 의 내용을 참고하여 작성되었습니다.  


## A simple ggplot

`iris` 데이터를 이용해서 간단하게 barplot을 그려봅니다. `iris` 데이터는 3가지 품종별 꽃잎과 꽃받침의 길이와 넓이를 측정한 데이터 입니다. 다음은 꽃잎의 길이와 넓이의 관계를 볼 수 있는 산점도 입니다. 

```{r, eval=F}
library(ggplot2)
head(iris)
ggplot(data=iris) +
  geom_point(mapping=aes(x=Petal.Length, y=Petal.Width))
```

눈에 띄이는 부분은 `+`를 이용한 레이어들의 연결입니다. `ggplot()` 함수 뒤에 다양한 레이어들을 연결할 수 있고 `geom_point()` 함수는 지정한 위치에 산점도 레이어를 추가하는 기능을 합니다. 각 레이어들은 다음과 같은 다양한 기능을 갖는 함수들로 구성될 수 있습니다. 

* 데이터 지정 (ggplot)
* 색상, 크기, x축의 값, y축의 값 등 심미적 요소 지정 (aes)
* 점, 선, 면 등 기하학적 요소 지정 (geoms)
* 그릴 통계량 지정  (stats)
* 테마, 스케일 지정 (theme)

아래 ggplot만을 실행할 경우 데이터와 x, y 축만 지정한 상태로 어떤 그래프 (히스토그램인지, 산포도인지 등)를 그릴지 명시되어 있지 않아서 아무것도 그리지 않은 상태의 빈 켄버스만 그려지게 되며 `geom_point()` 함수를 즉, 점을 그릴지 선을 그릴지 어떤 통계량을 그릴지 아니면 값 자체를 그릴지 등을 지정해 주고 나서야 비로서 그래프가 그려집니다. 

```{r, eval=F}
ggplot(data=iris, mapping=aes(x=Petal.Length, y=Petal.Width))
?ggplot
ggplot(iris, aes(x=Petal.Length, y=Petal.Width))
ggplot(iris, aes(x=Petal.Length, y=Petal.Width)) + geom_point()
```

`geom_point()`의 도움말을 보면 다음과 같이 `data`, `mapping`, `stat` 등의 파라메터들이 있습니다. 이는 `ggplot`함수에서 설정한 `data`나 `mapping` 정보를 `geom_point`에서 설정 하거나 완전히 다른 데이터를 x축과 y축에 그릴 수 있다는 뜻 이기도 합니다.   

```{r, eval=F}
ggplot() + 
  geom_point(data=iris, mapping=aes(x=Petal.Length, y=Petal.Width)) 
```

그런데 위 꽃잎의 길이와 넓이는 세 가지 다른 종류의 붓꽃에 대한 정보입니다. 따라서 각 종에 따라 다른 색이나 기호를 할당하는 것도 `mapping`에서 설정할 수 있습니다. 

```{r, eval=F}
ggplot(iris, aes(x=Petal.Length, y=Petal.Width, color=Species, shape=Species)) + 
  geom_point()

ggplot(iris, aes(x=Petal.Length, y=Petal.Width)) + 
  geom_point(aes(color=Species, shape=Species))
```


```{r, eval=F}
ggplot(iris, aes(x=Petal.Length, y=Petal.Width)) + 
  geom_point() 
```




```+``` 로 레이어를 추가하면서 `geom_bar()` 함수로 막대그래프를 그린다고 명시를 하면 되지만 `geom_bar`의 기본 `stat`은  `count`로 mydata의 GFP 즉 y 값은 count 데이터가 아니므로 에러`Error: stat_count() must not be used with a y aesthetic` 를 보여줍니다. 

```{r, eval=F}
ggplot(iris, aes(x=Petal.Length, y=Petal.Width)) +  
  geom_point()
```

따라서 `stat`을 `identity`로 명시하고 그릴 경우 정상적으로 막대그래프가 그려지게 됩니다.

```{r, eval=F}
ggplot(iris, aes(x=Petal.Length, y=Petal.Width)) +  
  geom_bar(stat="identity")
```

위 그림은 반복이나 농도 등을 고려하지 않고 모두 한 위치 (예를 들어 1번 샘플의 반복 및 다른 농도 값들 모두 첫 번째 위치)에 그려지게 됩니다. 따라서 아래와 같이 각 농도를 다른 색으로 채우고 ```fill=concentration```, 위치도 다르게 ```"position=dodge"``` 그려줄 수 있습니다.   



---


<a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="크리에이티브 커먼즈 라이선스" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/88x31.png" /></a><br />이 저작물은 <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/">크리에이티브 커먼즈 저작자표시-비영리-변경금지 4.0 국제 라이선스</a>에 따라 이용할 수 있습니다.

