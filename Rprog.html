<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>R 프로그래밍과 데이터 분석</title>
  <meta name="description" content="UST lecture web site" />
  <meta name="generator" content="bookdown #bookdown:version# and GitBook 2.6.7" />

  <meta property="og:title" content="R 프로그래밍과 데이터 분석" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="UST lecture web site" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="R 프로그래밍과 데이터 분석" />
  
  <meta name="twitter:description" content="UST lecture web site" />
  

<meta name="author" content="한국생명공학연구원 김하성" />


<meta name="date" content="2020-06-17" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<!--bookdown:link_prev-->
<!--bookdown:link_next-->
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



<!--bookdown:title:start-->
<div id="header">
<h1 class="title">R 프로그래밍과 데이터 분석</h1>
<p class="author"><em>한국생명공학연구원 김하성</em></p>
<p class="date"><em>2020-06-17</em></p>
</div>
<!--bookdown:title:end-->

<!--bookdown:toc:start-->
  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">
<!--bookdown:toc2:start-->
<ul>
<li><a href="#introduction-강의-개요"><span class="toc-section-number">1</span> Introduction 강의 개요</a>
<ul>
<li><a href="#goal-강의-목표"><span class="toc-section-number">1.1</span> Goal 강의 목표</a></li>
<li><a href="#this-course"><span class="toc-section-number">1.2</span> This course</a></li>
<li><a href="#tips"><span class="toc-section-number">1.3</span> Tips</a></li>
<li><a href="#references-books-참고-교제"><span class="toc-section-number">1.4</span> References books 참고 교제</a></li>
<li><a href="#references-참고-자료"><span class="toc-section-number">1.5</span> References 참고 자료</a></li>
<li><a href="#evaluation-평가-세부-항목"><span class="toc-section-number">1.6</span> Evaluation 평가 세부 항목</a></li>
<li><a href="#schedule-강의-계획"><span class="toc-section-number">1.7</span> Schedule 강의 계획</a></li>
<li><a href="#r-lecture-youtube-link"><span class="toc-section-number">1.8</span> R Lecture Youtube Link</a>
<ul>
<li><a href="#lecture-chapter-3"><span class="toc-section-number">1.8.1</span> Lecture Chapter 3</a></li>
<li><a href="#lecture-chapter-4"><span class="toc-section-number">1.8.2</span> Lecture Chapter 4</a></li>
<li><a href="#lecture-chapter-5"><span class="toc-section-number">1.8.3</span> Lecture Chapter 5</a></li>
<li><a href="#lecture-chapter-6"><span class="toc-section-number">1.8.4</span> Lecture Chapter 6</a></li>
<li><a href="#lecture-chapter-7"><span class="toc-section-number">1.8.5</span> Lecture Chapter 7</a></li>
<li><a href="#lecture-chapter-8"><span class="toc-section-number">1.8.6</span> Lecture Chapter 8</a></li>
</ul></li>
</ul></li>
<li><a href="#r-basics"><span class="toc-section-number">2</span> R basics</a>
<ul>
<li><a href="#what-is-r-rstudio"><span class="toc-section-number">2.1</span> What is R / Rstudio</a></li>
<li><a href="#r-rstudio-installation"><span class="toc-section-number">2.2</span> R / Rstudio installation</a></li>
<li><a href="#rstudio-interface"><span class="toc-section-number">2.3</span> Rstudio interface</a></li>
<li><a href="#keyboard-shortcuts"><span class="toc-section-number">2.4</span> Keyboard shortcuts</a></li>
<li><a href="#set-working-directory"><span class="toc-section-number">2.5</span> Set working directory</a></li>
<li><a href="#hello-world"><span class="toc-section-number">2.6</span> Hello world</a></li>
<li><a href="#help"><span class="toc-section-number">2.7</span> Help</a></li>
<li><a href="#rstudio-workspace"><span class="toc-section-number">2.8</span> RStudio workspace</a></li>
<li><a href="#r-packages"><span class="toc-section-number">2.9</span> R packages</a></li>
<li><a href="#data-sets"><span class="toc-section-number">2.10</span> Data sets</a></li>
<li><a href="#cheatsheet"><span class="toc-section-number">2.11</span> Cheatsheet</a></li>
</ul></li>
<li><a href="#r-programming-basics-i"><span class="toc-section-number">3</span> R programming basics I</a>
<ul>
<li><a href="#terminology"><span class="toc-section-number">3.1</span> Terminology</a></li>
<li><a href="#r-console-script"><span class="toc-section-number">3.2</span> R console script</a></li>
<li><a href="#what-is-a-programming-language"><span class="toc-section-number">3.3</span> What is a programming language</a></li>
<li><a href="#variables-and-values"><span class="toc-section-number">3.4</span> Variables and values</a></li>
<li><a href="#object-variable-type-of-storage-mode"><span class="toc-section-number">3.5</span> Object (variable) type of (storage) mode</a></li>
<li><a href="#levels-of-measurement"><span class="toc-section-number">3.6</span> Levels of measurement</a></li>
<li><a href="#object---vectors"><span class="toc-section-number">3.7</span> Object - Vectors</a>
<ul>
<li><a href="#exercise-3-1"><span class="toc-section-number">3.7.1</span> Exercise 3-1</a></li>
<li><a href="#exercise-3-2"><span class="toc-section-number">3.7.2</span> Exercise 3-2</a></li>
<li><a href="#exercise-3-3"><span class="toc-section-number">3.7.3</span> Exercise 3-3</a></li>
</ul></li>
<li><a href="#object---matrix"><span class="toc-section-number">3.8</span> Object - matrix</a>
<ul>
<li><a href="#exercise-3-4"><span class="toc-section-number">3.8.1</span> Exercise 3-4</a></li>
</ul></li>
<li><a href="#object---data.frame"><span class="toc-section-number">3.9</span> Object - data.frame</a></li>
<li><a href="#object---list"><span class="toc-section-number">3.10</span> Object - list</a></li>
<li><a href="#missing-values"><span class="toc-section-number">3.11</span> Missing values</a></li>
<li><a href="#useful-functions-i"><span class="toc-section-number">3.12</span> Useful functions I</a>
<ul>
<li><a href="#exercise-3-5"><span class="toc-section-number">3.12.1</span> Exercise 3-5</a></li>
</ul></li>
</ul></li>
<li><a href="#r-programming-basics-ii"><span class="toc-section-number">4</span> R programming basics II</a>
<ul>
<li><a href="#a-script-in-r"><span class="toc-section-number">4.1</span> A script in R</a></li>
<li><a href="#functions"><span class="toc-section-number">4.2</span> Functions</a>
<ul>
<li><a href="#exercise-4-1"><span class="toc-section-number">4.2.1</span> Exercise 4-1</a></li>
</ul></li>
<li><a href="#vectorized-functions"><span class="toc-section-number">4.3</span> Vectorized functions</a>
<ul>
<li><a href="#exercise-4-2"><span class="toc-section-number">4.3.1</span> Exercise 4-2</a></li>
<li><a href="#exercise-4-3"><span class="toc-section-number">4.3.2</span> Exercise 4-3</a></li>
</ul></li>
<li><a href="#if-statements"><span class="toc-section-number">4.4</span> if statements</a>
<ul>
<li><a href="#exercise-4-4"><span class="toc-section-number">4.4.1</span> Exercise 4-4</a></li>
</ul></li>
<li><a href="#for-while-repeat"><span class="toc-section-number">4.5</span> for, while, repeat</a></li>
<li><a href="#avoiding-loops"><span class="toc-section-number">4.6</span> Avoiding Loops</a></li>
<li><a href="#object-oriented-programming-advanced"><span class="toc-section-number">4.7</span> Object Oriented Programming (Advanced)</a></li>
<li><a href="#usuful-functions-ii"><span class="toc-section-number">4.8</span> Usuful functions II</a>
<ul>
<li><a href="#exercise-4-5"><span class="toc-section-number">4.8.1</span> Exercise 4-5</a></li>
</ul></li>
<li><a href="#file-read-and-write"><span class="toc-section-number">4.9</span> File read and write</a>
<ul>
<li><a href="#exercise-4-6"><span class="toc-section-number">4.9.1</span> Exercise 4-6</a></li>
</ul></li>
<li><a href="#excel-file-read-and-data-plotting"><span class="toc-section-number">4.10</span> Excel file read and data plotting</a>
<ul>
<li><a href="#exercise-4-7-barplot-with-error-bars"><span class="toc-section-number">4.10.1</span> Exercise 4-7 barplot with error bars</a></li>
</ul></li>
</ul></li>
<li><a href="#r-graphics-basics"><span class="toc-section-number">5</span> R graphics basics</a>
<ul>
<li><a href="#scatter-plot"><span class="toc-section-number">5.1</span> scatter plot</a></li>
<li><a href="#histogram"><span class="toc-section-number">5.2</span> histogram</a></li>
<li><a href="#boxplot"><span class="toc-section-number">5.3</span> boxplot</a></li>
<li><a href="#barplot"><span class="toc-section-number">5.4</span> barplot</a>
<ul>
<li><a href="#exercise-5-1"><span class="toc-section-number">5.4.1</span> Exercise 5-1</a></li>
</ul></li>
<li><a href="#draw-multiple-graphs-in-the-same-plot"><span class="toc-section-number">5.5</span> Draw multiple graphs in the same plot</a>
<ul>
<li><a href="#exercise-5-2"><span class="toc-section-number">5.5.1</span> Exercise 5-2</a></li>
</ul></li>
<li><a href="#barplot-for-multiplate-reader-data"><span class="toc-section-number">5.6</span> Barplot for multiplate reader data</a></li>
</ul></li>
<li><a href="#r-graphics-ggplot2"><span class="toc-section-number">6</span> R graphics ggplot2</a>
<ul>
<li><a href="#basics"><span class="toc-section-number">6.1</span> Basics</a></li>
<li><a href="#facets"><span class="toc-section-number">6.2</span> Facets</a>
<ul>
<li><a href="#exercise-6.1"><span class="toc-section-number">6.2.1</span> Exercise 6.1</a></li>
</ul></li>
<li><a href="#bar-graph"><span class="toc-section-number">6.3</span> Bar graph</a>
<ul>
<li><a href="#exercise-6.2"><span class="toc-section-number">6.3.1</span> Exercise 6.2</a></li>
</ul></li>
<li><a href="#line-graph"><span class="toc-section-number">6.4</span> Line graph</a>
<ul>
<li><a href="#exercise-6.3"><span class="toc-section-number">6.4.1</span> Exercise 6.3</a></li>
</ul></li>
<li><a href="#smoothing"><span class="toc-section-number">6.5</span> Smoothing</a></li>
<li><a href="#statstics-and-positions"><span class="toc-section-number">6.6</span> Statstics and positions</a></li>
<li><a href="#themes-labels-and-scales"><span class="toc-section-number">6.7</span> Themes, Labels, and Scales</a>
<ul>
<li><a href="#exercise-6.4"><span class="toc-section-number">6.7.1</span> Exercise 6.4</a></li>
</ul></li>
</ul></li>
<li><a href="#data-transformation-basics"><span class="toc-section-number">7</span> Data transformation basics</a>
<ul>
<li><a href="#subset-and-filter"><span class="toc-section-number">7.1</span> subset and filter</a>
<ul>
<li><a href="#exercise-7.1"><span class="toc-section-number">7.1.1</span> Exercise 7.1</a></li>
</ul></li>
<li><a href="#merging-and-split"><span class="toc-section-number">7.2</span> merging and split</a></li>
<li><a href="#transforming-data"><span class="toc-section-number">7.3</span> transforming data</a></li>
<li><a href="#analysis-example-babies"><span class="toc-section-number">7.4</span> Analysis example (babies)</a>
<ul>
<li><a href="#exercise-7.2"><span class="toc-section-number">7.4.1</span> Exercise 7.2</a></li>
</ul></li>
<li><a href="#apply"><span class="toc-section-number">7.5</span> apply</a>
<ul>
<li><a href="#exercise-7.3"><span class="toc-section-number">7.5.1</span> Exercise 7.3</a></li>
</ul></li>
</ul></li>
<li><a href="#data-transformation-with-dplyr"><span class="toc-section-number">8</span> Data transformation with dplyr</a>
<ul>
<li><a href="#long-and-wide-data-structure"><span class="toc-section-number">8.1</span> Long and wide data structure</a></li>
<li><a href="#dplyr---pipe-operator"><span class="toc-section-number">8.2</span> dplyr - pipe operator</a></li>
<li><a href="#dplyr---important-functions"><span class="toc-section-number">8.3</span> dplyr - Important functions</a>
<ul>
<li><a href="#filter"><span class="toc-section-number">8.3.1</span> filter</a></li>
<li><a href="#arrange"><span class="toc-section-number">8.3.2</span> arrange</a></li>
<li><a href="#select"><span class="toc-section-number">8.3.3</span> select</a></li>
<li><a href="#mutate"><span class="toc-section-number">8.3.4</span> mutate</a></li>
<li><a href="#summarise"><span class="toc-section-number">8.3.5</span> summarise</a></li>
<li><a href="#join"><span class="toc-section-number">8.3.6</span> join</a></li>
<li><a href="#code-comparison"><span class="toc-section-number">8.3.7</span> code comparison</a></li>
</ul></li>
<li><a href="#dplyr-example-iris"><span class="toc-section-number">8.4</span> dplyr example iris</a></li>
</ul></li>
<li><a href="#exercise-class"><span class="toc-section-number">9</span> Exercise class</a>
<ul>
<li><a href="#exercise-7.3-1"><span class="toc-section-number">9.1</span> Exercise 7.3</a></li>
<li><a href="#exercise-9.1"><span class="toc-section-number">9.2</span> Exercise 9.1</a></li>
<li><a href="#exercise-9.2"><span class="toc-section-number">9.3</span> Exercise 9.2</a></li>
<li><a href="#exercise-9.3"><span class="toc-section-number">9.4</span> Exercise 9.3</a></li>
<li><a href="#exercise-9.4"><span class="toc-section-number">9.5</span> Exercise 9.4</a></li>
</ul></li>
</ul>
<!--bookdown:toc2:end-->
      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R 프로그래밍과 데이터 분석</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<!--bookdown:toc:end-->
<!--bookdown:body:start-->
<div id="introduction-강의-개요" class="section level1">
<h1 number="1"><span class="header-section-number">1</span> Introduction 강의 개요</h1>
<ul>
<li>장소: 한국생명공학연구원 연구동 세미나실 1213호 (매주수요일 13:00~16:00)</li>
<li>강사: 한국생명공학연구원 바이오합성연구센터 김하성</li>
<li>연락처: 042-860-4372, <a href="mailto:haseong@kribb.re.kr" class="email">haseong@kribb.re.kr</a> (생명연 연구동 1143)</li>
<li>강의site: <a href="https://greendaygh.github.io/Rstat2020/" class="uri">https://greendaygh.github.io/Rstat2020/</a></li>
</ul>
<div id="goal-강의-목표" class="section level2">
<h2 number="1.1"><span class="header-section-number">1.1</span> Goal 강의 목표</h2>
<ul>
<li>이공계열 대학원생의 원활한 실험 설계와 데이터 분석을 위한 범용 프로그램 언어인 R의 사용법과 프로그래밍 기술의 습득이 목표. 특히 Data scientist를 위해 개발된 tidyverse와 ggplot2 패키지 사용법을 위주로 강의와 실습을 진행하며 후반부 대규모 서열 데이터를 이용한 실습을 통해 R의 활용 기술을 학습함</li>
</ul>
</div>
<div id="this-course" class="section level2">
<h2 number="1.2"><span class="header-section-number">1.2</span> This course</h2>
<ul>
<li>R 사용에 대한 기본 개념과 프로그래밍을 중심으로 필요시 기초 통계지식 강의</li>
<li>실습 데이터로는 교제에서 제공되는 예제 데이터와 생물학 서열 등 대규모 데이터를 사용한 분석 진행</li>
<li>모든 강의 시간 실습을 위한 개인 노트북 지참 필수</li>
<li>강의 자료는 강의 웹사이트에 수업 전 업데이트됨<br />
</li>
<li>상황에 따라 강의 일정이 조정될 수 있음</li>
<li>과제물은 필요에 따라 수업 후 제공되며 다음 수업 전까지 메일로 제출</li>
</ul>
</div>
<div id="tips" class="section level2">
<h2 number="1.3"><span class="header-section-number">1.3</span> Tips</h2>
<ul>
<li>눈으로 이해하지 않고 스스로 실습 필수</li>
<li>각 명령줄이 어떻게/왜 작동하는지 이해하기</li>
<li>인터넷 검색을 통한 다른사람의 코드를 적극적으로 이해하고 적용 필요</li>
</ul>
</div>
<div id="references-books-참고-교제" class="section level2">
<h2 number="1.4"><span class="header-section-number">1.4</span> References books 참고 교제</h2>
<ul>
<li>Using R for Introductory Statistics by John Verzani
<ul>
<li>Free version of 1st Edition
<ul>
<li><a href="https://cran.r-project.org/doc/contrib/Verzani-SimpleR.pdf" class="uri">https://cran.r-project.org/doc/contrib/Verzani-SimpleR.pdf</a></li>
<li><a href="http://cbb.sjtu.edu.cn/~mywu/bi217/usingR.pdf" class="uri">http://cbb.sjtu.edu.cn/~mywu/bi217/usingR.pdf</a></li>
</ul></li>
<li>Second edition
<ul>
<li><a href="https://www.crcpress.com/Using-R-for-Introductory-Statistics-Second-Edition/Verzani/p/book/9781466590731" class="uri">https://www.crcpress.com/Using-R-for-Introductory-Statistics-Second-Edition/Verzani/p/book/9781466590731</a></li>
</ul></li>
</ul></li>
<li>R for Data Science (<a href="https://r4ds.had.co.nz" class="uri">https://r4ds.had.co.nz</a>, <a href="https://github.com/hadley" class="uri">https://github.com/hadley</a>)</li>
<li>Bioinformatics Data Skills by Vince Buffalo (<a href="http://2.droppdf.com/files/5aTvl/bioinformatics-data-skills.pdf" class="uri">http://2.droppdf.com/files/5aTvl/bioinformatics-data-skills.pdf</a>)</li>
<li>First Course in Statistical Programming with R by Braun and
Murdoch (<a href="https://www.cambridge.org/core/books/first-course-in-statistical-programming-with-r/C9F088122AB40517B07FA77F2F0FDE2F" class="uri">https://www.cambridge.org/core/books/first-course-in-statistical-programming-with-r/C9F088122AB40517B07FA77F2F0FDE2F</a>)</li>
<li>Introductory Statistics with R by Dalgaard (<a href="http://www.academia.dk/BiologiskAntropologi/Epidemiologi/PDF/Introductory_Statistics_with_R__2nd_ed.pdf" class="uri">http://www.academia.dk/BiologiskAntropologi/Epidemiologi/PDF/Introductory_Statistics_with_R__2nd_ed.pdf</a>)</li>
<li>Modern Applied Statistics with S by Venables and Ripley (<a href="http://www.bagualu.net/wordpress/wp-content/uploads/2015/10/Modern_Applied_Statistics_With_S.pdf" class="uri">http://www.bagualu.net/wordpress/wp-content/uploads/2015/10/Modern_Applied_Statistics_With_S.pdf</a>)</li>
<li>일반통계학 (영지문화사, 김우철 외)</li>
</ul>
</div>
<div id="references-참고-자료" class="section level2">
<h2 number="1.5"><span class="header-section-number">1.5</span> References 참고 자료</h2>
<ul>
<li><a href="https://resources.rstudio.com/" class="uri">https://resources.rstudio.com/</a></li>
<li><a href="http://shiny.rstudio.com/tutorial/" class="uri">http://shiny.rstudio.com/tutorial/</a></li>
<li>R 홈페이지 <a href="https://www.r-project.org/" class="uri">https://www.r-project.org/</a></li>
<li>Rstudio 홈페이지 <a href="https://www.rstudio.com/" class="uri">https://www.rstudio.com/</a></li>
<li>Packages for biologists <a href="https://www.bioconductor.org/" class="uri">https://www.bioconductor.org/</a></li>
<li>R 기본 문서들 (소개, 사용, 설치, 운영) <a href="https://cran.r-project.org/manuals.html" class="uri">https://cran.r-project.org/manuals.html</a></li>
<li>R ebooks <a href="https://bookdown.org/" class="uri">https://bookdown.org/</a></li>
<li>Cheat Sheets <a href="https://www.rstudio.com/resources/cheatsheets/" class="uri">https://www.rstudio.com/resources/cheatsheets/</a></li>
</ul>
</div>
<div id="evaluation-평가-세부-항목" class="section level2">
<h2 number="1.6"><span class="header-section-number">1.6</span> Evaluation 평가 세부 항목</h2>
<ul>
<li>출석 50% / 과제 50% / 80점 이상 S, 80점 미만 U 부여</li>
</ul>
</div>
<div id="schedule-강의-계획" class="section level2">
<h2 number="1.7"><span class="header-section-number">1.7</span> Schedule 강의 계획</h2>
<ul>
<li>1주차 - Introduction and installation of R/Rstudio</li>
<li>2주차 - R language basics I – Interface, operations, packages, help, NULL, NA, and NaN</li>
<li>3주차 - R language basics II - data type and structure</li>
<li>4주차 - R language basics III – if, for, while</li>
<li>5주차 - R programming – Maze Robot (function, matrix) I</li>
<li>6주차 - R programming – Maze Robot (function, matrix) II</li>
<li>7주차 - Data manipulation I - read, write, rbind, cbind, split, subset</li>
<li>8주차 - Data manipulation II - dplyr, apply, reshape</li>
<li>9주차 - Visualizing data in R I – plot, hist</li>
<li>10주차 - Visualizing data in R II – ggplot2</li>
<li>11주차 - Visualizing data in R III – ggplot2</li>
<li>12주차 - Shiny for interactive applications in R I</li>
<li>13주차 - Shiny for interactive applications in R II</li>
<li>14주차 - Data analysis #1</li>
<li>15주차 - Data analysis #2</li>
<li>16주차 - Data analysis #3</li>
</ul>
</div>
<div id="r-lecture-youtube-link" class="section level2">
<h2 number="1.8"><span class="header-section-number">1.8</span> R Lecture Youtube Link</h2>
<div id="lecture-chapter-3" class="section level3">
<h3 number="1.8.1"><span class="header-section-number">1.8.1</span> Lecture Chapter 3</h3>
<ul>
<li>강의 Chapter 3-1 (vector) <a href="https://youtu.be/Fif5LnalvUE" class="uri">https://youtu.be/Fif5LnalvUE</a></li>
<li>강의 Chapter 3-2 (vector) <a href="https://youtu.be/7-qVYzrKIlU" class="uri">https://youtu.be/7-qVYzrKIlU</a></li>
<li>강의 Chapter 3-3 (matrix) <a href="https://youtu.be/t3-NaiMuaYs" class="uri">https://youtu.be/t3-NaiMuaYs</a></li>
<li>강의 Chapter 3-4 (data.frame, list) <a href="https://youtu.be/w10jHp8A128" class="uri">https://youtu.be/w10jHp8A128</a></li>
<li>강의 Chapter 3-5 (missing) <a href="https://youtu.be/tItpzjBMeDI" class="uri">https://youtu.be/tItpzjBMeDI</a></li>
<li>강의 Chapter 3-6 (useful functions I) <a href="https://youtu.be/3AaZ0vqgNHk" class="uri">https://youtu.be/3AaZ0vqgNHk</a></li>
<li>강의 Chapter 3-7 추가 (factor) <a href="https://youtu.be/Xxd38TM3XBs" class="uri">https://youtu.be/Xxd38TM3XBs</a></li>
</ul>
</div>
<div id="lecture-chapter-4" class="section level3">
<h3 number="1.8.2"><span class="header-section-number">1.8.2</span> Lecture Chapter 4</h3>
<ul>
<li>강의 Chapter 4-1 (function) <a href="https://youtu.be/NrGe3V_UpAc" class="uri">https://youtu.be/NrGe3V_UpAc</a></li>
<li>강의 Chapter 4-2 (function) <a href="https://youtu.be/vfaqzso883k" class="uri">https://youtu.be/vfaqzso883k</a></li>
<li>강의 Chapter 4-3 (if) <a href="https://youtu.be/SMHFFYi7Akc" class="uri">https://youtu.be/SMHFFYi7Akc</a></li>
<li>강의 Chapter 4-4 (for) <a href="https://youtu.be/I9BZqbQCTiE" class="uri">https://youtu.be/I9BZqbQCTiE</a></li>
<li>강의 Chapter 4-5 (while repeat) <a href="https://youtu.be/fZj0ZAm2TPk" class="uri">https://youtu.be/fZj0ZAm2TPk</a></li>
<li>강의 Chapter 4-6 (functions2) <a href="https://youtu.be/CYQO_k4qcU4" class="uri">https://youtu.be/CYQO_k4qcU4</a></li>
<li>강의 Chapter 4-7 (read write) <a href="https://youtu.be/I9BZqbQCTiE" class="uri">https://youtu.be/I9BZqbQCTiE</a></li>
<li>강의 Chapter 4-8 (readxl) <a href="https://youtu.be/_6ZzjvotTww" class="uri">https://youtu.be/_6ZzjvotTww</a></li>
<li>강의 Chapter 4-9 (readxl2) <a href="https://youtu.be/7YLNrq5vFiw" class="uri">https://youtu.be/7YLNrq5vFiw</a></li>
<li>강의 Chapter 4-10 (readxl3) <a href="https://youtu.be/_1X3AGhCsCw" class="uri">https://youtu.be/_1X3AGhCsCw</a></li>
</ul>
</div>
<div id="lecture-chapter-5" class="section level3">
<h3 number="1.8.3"><span class="header-section-number">1.8.3</span> Lecture Chapter 5</h3>
<ul>
<li>강의 Chapter 5-1 (graph) <a href="https://youtu.be/KdlAqVVFxoI" class="uri">https://youtu.be/KdlAqVVFxoI</a></li>
<li>강의 Chapter 5-2 (graph) <a href="https://youtu.be/NXZlV-xnRTY" class="uri">https://youtu.be/NXZlV-xnRTY</a></li>
<li>강의 Chapter 5-3 (graph) <a href="https://youtu.be/NYwxIqC2kjU" class="uri">https://youtu.be/NYwxIqC2kjU</a></li>
<li>강의 Chapter 5-4 (graph) <a href="https://youtu.be/VBbPkvdd3K0" class="uri">https://youtu.be/VBbPkvdd3K0</a></li>
<li>강의 Chapter 5-5 (graph) <a href="https://youtu.be/5Nurf1z2JTo" class="uri">https://youtu.be/5Nurf1z2JTo</a></li>
</ul>
</div>
<div id="lecture-chapter-6" class="section level3">
<h3 number="1.8.4"><span class="header-section-number">1.8.4</span> Lecture Chapter 6</h3>
<ul>
<li>강의 Chapter 6-1 (ggplot2 basics) <a href="https://youtu.be/551gss8ffuI" class="uri">https://youtu.be/551gss8ffuI</a></li>
<li>강의 Chapter 6-2 (ggplot2 facet and barplot) <a href="https://youtu.be/DdiXq9juBpQ" class="uri">https://youtu.be/DdiXq9juBpQ</a></li>
<li>강의 Chapter 6-3 (ggplot2 bar and line graph) <a href="https://youtu.be/mCF-iU6XZxw" class="uri">https://youtu.be/mCF-iU6XZxw</a></li>
<li>강의 Chapter 6-4 (ggplot2 smoothing) <a href="https://youtu.be/ACvVxKJ1mOc" class="uri">https://youtu.be/ACvVxKJ1mOc</a></li>
<li>강의 Chapter 6-5 (ggplot2 statistics and positions) <a href="https://youtu.be/NCQdwLrhlkI" class="uri">https://youtu.be/NCQdwLrhlkI</a></li>
<li>강의 Chapter 6-6 (ggplot2 theme) <a href="https://youtu.be/u-XcIHSFu9Q" class="uri">https://youtu.be/u-XcIHSFu9Q</a></li>
<li>강의 Chapter 6-7 (ggplot2 theme and ex) <a href="https://youtu.be/NTAjYPVVH1c" class="uri">https://youtu.be/NTAjYPVVH1c</a></li>
</ul>
</div>
<div id="lecture-chapter-7" class="section level3">
<h3 number="1.8.5"><span class="header-section-number">1.8.5</span> Lecture Chapter 7</h3>
<ul>
<li>강의 Chapter 7-1 (Data transformation basics) <a href="https://youtu.be/loG82uC89nQ" class="uri">https://youtu.be/loG82uC89nQ</a></li>
<li>강의 Chapter 7-2 (Data transformation basics) <a href="https://youtu.be/Arbz7Nt_eKE" class="uri">https://youtu.be/Arbz7Nt_eKE</a></li>
<li>강의 Chapter 7-3 (Data transformation basics) <a href="https://youtu.be/r9Q_P-n0gLI" class="uri">https://youtu.be/r9Q_P-n0gLI</a></li>
</ul>
</div>
<div id="lecture-chapter-8" class="section level3">
<h3 number="1.8.6"><span class="header-section-number">1.8.6</span> Lecture Chapter 8</h3>
<ul>
<li>강의 Chapter 8-1 (dplyr) <a href="https://youtu.be/geXHum2wwns" class="uri">https://youtu.be/geXHum2wwns</a></li>
<li>강의 Chapter 8-2 (dplyr) <a href="https://youtu.be/eioDf3oA4AE" class="uri">https://youtu.be/eioDf3oA4AE</a></li>
<li>강의 Chapter 8-3 (dplyr) <a href="https://youtu.be/WOLotZYhZeE" class="uri">https://youtu.be/WOLotZYhZeE</a></li>
<li>강의 Chapter 8-4 (dplyr) <a href="https://youtu.be/BOFAxazZv60" class="uri">https://youtu.be/BOFAxazZv60</a></li>
</ul>
<!--chapter:end:index.Rmd-->
</div>
</div>
</div>
<div id="r-basics" class="section level1">
<h1 number="2"><span class="header-section-number">2</span> R basics</h1>
<div id="what-is-r-rstudio" class="section level2">
<h2 number="2.1"><span class="header-section-number">2.1</span> What is R / Rstudio</h2>
<p><img src="images/01/r.jpg" /></p>
<p>R은 통계나 생물통계, 유전학을 연구하는 사람들 사이에서 널리 사용되는 오픈소스 프로그래밍 언어 입니다. Bell Lab에서 개발한 S 언어에서 유래했으며 엄청나게 많은 라이브러리 (다른 사람들이 만들어 놓은 코드)가 있어서 쉽게 가져다 사용할 수 있습니다. R은 복잡한 수식이나 통계 알고리즘을 간단히 구현하고 사용할 수 있으며 C, C++, Python 등 다른 언어들과의 병행 사용도 가능합니다. 2019년 top five language에 랭크 되었으며 이는 빅데이터 증가에 따라 인기가 높아진 것으로 볼 수 있습니다 (참고로 2018년에는 7위).</p>
<p><img src="images/01/topproglang.jpeg" width="450" /></p>
<p>Despite being a much more specialized language than the others, it’s maintained its popularity in recent years due to the world being awash in an ever-growing pile of big data.
<a href="https://spectrum.ieee.org/computing/software/the-top-programming-languages-2019" class="uri">https://spectrum.ieee.org/computing/software/the-top-programming-languages-2019</a></p>
<p>R은 데이터를 통계분석에 널리 사용되는데 이는 데이터를 눈으로 확인하기 위한 visualization 이나 벡터 연산 등의 강력한 기능 때문에 점점 더 많은 사람들이 사용하고 있습니다. 기존에는 속도나 확장성이 다른 언어들에 비해 단점으로 지적되었으나 R 언어의 계속적인 개발과 업데이트로 이러한 단점들이 빠르게 보완되고 있습니다. R 사용을 위해서는 R 언어의 코어 프로그램을 먼저 설치하고 그 다음 R 언어용 IDE인 RStudio 설치가 필요합니다.</p>
<p><img src="images/01/22.PNG" /></p>
<p><img src="images/01/23.PNG" /></p>
</div>
<div id="r-rstudio-installation" class="section level2">
<h2 number="2.2"><span class="header-section-number">2.2</span> R / Rstudio installation</h2>
<ul>
<li><p>R 사이트에 접속 후 (<a href="https://www.r-project.org/" class="uri">https://www.r-project.org/</a>) 좌측 메뉴 상단에 위치한 CRAN 클릭.
<img src="images/01/01-01.PNG" /></p></li>
<li><p>미러 사이트 목록에서 Korea의 아무 사이트나 들어감
<img src="images/01/01-02.PNG" /></p></li>
<li><p>Download R for Windows를 클릭 후 base 링크 들어가서
<img src="images/01/01-03.PNG" /><br />
<img src="images/01/01-04.PNG" /></p></li>
<li><p>Download R 3.6.3 for Windows 링크로 실행 프로그램 다운로드 (2020.3 현재 R 버전은 3.6.3). 로컬 컴퓨터에 Download 된 R-3.6.3-win.exe 를 실행하고 설치 프로그램의 지시에 따라 R 언어 소프트웨어 설치를 완료합니다.</p></li>
</ul>
<p><img src="images/01/01-05.PNG" /></p>
<ul>
<li><p>Rstudio는 R 언어를 위한 오픈소스 기반 통합개발환경(IDE)으로 R 프로그래밍을 위한 편리한 기능들을 제공해 줍니다. 다음 사이트에 접속 (<a href="https://www.rstudio.com/" class="uri">https://www.rstudio.com/</a>), 상단의 Products &gt; RStudio 클릭
<img src="images/01/01-06.PNG" /></p></li>
<li><p>RStudio Desktop 선택
<img src="images/01/01-07.PNG" /></p></li>
<li><p>Download RStudio Desktop 클릭
<img src="images/01/01-08.PNG" /></p></li>
<li><p>RStudio Desktop Free 버전의 Download를 선택하고
<img src="images/01/01-09.PNG" /></p></li>
<li><p>Download RStudio for Windows (2020.03현재 version 1.2.5033) 클릭, 다운로드. 로컬 컴퓨터에 다운로드된 RStudio-1.2.5033.exe를 실행하고 설치 가이드에 따라 설치 완료합니다.
<img src="images/01/01-10.PNG" /></p></li>
</ul>
</div>
<div id="rstudio-interface" class="section level2">
<h2 number="2.3"><span class="header-section-number">2.3</span> Rstudio interface</h2>
<ul>
<li>아래 그림의 좌측 상단의 공간은 코드편집창, 좌측 하단은 콘솔창 입니다.
<img src="images/01/01-11.PNG" /></li>
</ul>
</div>
<div id="keyboard-shortcuts" class="section level2">
<h2 number="2.4"><span class="header-section-number">2.4</span> Keyboard shortcuts</h2>
<ul>
<li>참고사이트
<ul>
<li><a href="https://support.rstudio.com/hc/en-us/articles/200711853-Keyboard-Shortcuts" class="uri">https://support.rstudio.com/hc/en-us/articles/200711853-Keyboard-Shortcuts</a></li>
<li>Tools –&gt; Keyboard shortcut Quick Reference (<code>Alt + Shift + K</code>)</li>
</ul></li>
<li>코드편집창 이동 (<code>Ctrl+1</code>) 콘솔창 이동(<code>Ctrl+2</code>)</li>
<li>한 줄 실행 (<code>Ctrl+Enter</code>)</li>
<li>주석처리 (<code>Ctrl + Shift + C</code>)
<ul>
<li>또는 <code>#</code>으로 시작하는 라인</li>
</ul></li>
<li>실습
<ul>
<li>코드편집창에서 다음 입력</li>
<li><img src="images/01/01-14.PNG" /><br />
</li>
<li>단축키 <code>Ctrl + enter</code>로 코드 실행</li>
<li>단축키 <code>Ctrl + 2</code>로 커서 콘솔창으로 이동</li>
<li><code>x</code>값 <code>x+y</code>값 확인</li>
<li>단축키 <code>Ctrl + 1</code>로 코드편집창 이동</li>
<li>단축키 <code>Ctrl + Shift + C</code> 사용</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># x &lt;- 10</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="co"># y &lt;- 20</span></span></code></pre></div>
</div>
<div id="set-working-directory" class="section level2">
<h2 number="2.5"><span class="header-section-number">2.5</span> Set working directory</h2>
<p>시작 전 항상 작업 디렉토리 설정. 예를 들어 c: 아래 새로운 디렉토리 rprog2020 을 만들고 작업공간으로 설정</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw">getwd</span>()</span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="kw">dir</span>()</span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="kw">setwd</span>(<span class="st">&quot;C:</span><span class="ch">\\</span><span class="st">rprog2020&quot;</span>)</span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="kw">getwd</span>()</span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="kw">dir</span>()</span></code></pre></div>
<p>또는 아래와 같이 RStudio 메뉴 에서 설정</p>
<p><img src="images/01/01-12.PNG" /></p>
</div>
<div id="hello-world" class="section level2">
<h2 number="2.6"><span class="header-section-number">2.6</span> Hello world</h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>mystring &lt;-<span class="st"> &quot;Hello </span><span class="ch">\n</span><span class="st"> world!&quot;</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="kw">cat</span>(mystring)</span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="kw">print</span>(mystring)</span></code></pre></div>
</div>
<div id="help" class="section level2">
<h2 number="2.7"><span class="header-section-number">2.7</span> Help</h2>
<p>R의 장점 중 하나로 방대한 양의 도움말 페이지가 제공됩니다. <code>?</code> 명령을 사용하면 되며 구글이나 웹에서도 도움을 얻을 수 있습니다.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>?cat</span>
<span id="cb4-2"><a href="#cb4-2"></a>?print</span>
<span id="cb4-3"><a href="#cb4-3"></a>?mean</span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="kw">help</span>(<span class="st">&quot;mean&quot;</span>)</span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="kw">example</span>(<span class="st">&quot;mean&quot;</span>)</span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="kw">help.search</span>(<span class="st">&quot;mean&quot;</span>)</span>
<span id="cb4-7"><a href="#cb4-7"></a><span class="kw">help</span>(<span class="dt">package=</span><span class="st">&quot;MASS&quot;</span>)</span></code></pre></div>
</div>
<div id="rstudio-workspace" class="section level2">
<h2 number="2.8"><span class="header-section-number">2.8</span> RStudio workspace</h2>
<p><img src="images/01/01-17.PNG" />
<img src="images/01/rstudio-ide-1.png" />
<img src="images/01/rstudio-ide-2.png" /></p>
</div>
<div id="r-packages" class="section level2">
<h2 number="2.9"><span class="header-section-number">2.9</span> R packages</h2>
<p>R은 “package”라 불리우는 다양한 함수 라이브러리를 사용할 수 있습니다. 예를 들어 <code>sum()</code> 이나 <code>sd()</code>와 같은 함수는 <code>stats</code>이라는 패키지에서 구현된 함수 입니다. 이러한 패키지는 인터넷의 <code>repository</code>에서 구할 수 있으며 대표적으로 The Comprehensive R Archive Network (CRAN) <a href="http://cran.r-project.org/web/views/" class="uri">http://cran.r-project.org/web/views/</a> 와 생물학자를 위한 Bioconductor specialised in genomics <a href="http://www.bioconductor.org/packages/release/BiocViews.html#___Software" class="uri">http://www.bioconductor.org/packages/release/BiocViews.html#___Software</a> 가 있습니다. 이러한 패키지의 설치는 아래와 같이 RStudio를 이용하거나 콘솔창에서 <code>install.packages()</code> 함수를 이용할 수 있습니다.</p>
<p><img src="images/01/01-18.PNG" /></p>
<ul>
<li>UsingR package installation</li>
</ul>
<p><img src="images/01/01-19.PNG" /></p>
<p>패키지를 설치하고 사용하기 위해서는 <code>library()</code> 함수를 사용해서 미리 loading 해 두어야 합니다. 한 번 로딩으로 작업 세션이 끝날때까지 관련된 함수를 사용할 수 있으나 R 세션이나 RStudio를 재시작 할 경우 다시 로딩해야 사용할 수 있습니다.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="kw">library</span>(UsingR)</span></code></pre></div>
<ul>
<li>R 설치 디렉토리</li>
<li>R 패키지 설치 디렉토리</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="kw">.libPaths</span>()</span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="kw">path.package</span>()</span></code></pre></div>
<p><img src="images/01/01-20.PNG" /></p>
</div>
<div id="data-sets" class="section level2">
<h2 number="2.10"><span class="header-section-number">2.10</span> Data sets</h2>
<p>대부분의 패키지는 함수와 함께 관련된 도움말, 예제, 그리고 데이터셋을 같이 제공해 줍니다. <code>library()</code> 함수를 사용할 때 자동으로 같이 로딩이 되며 <code>data()</code> 함수를 사용해서 사용자 작업공간에 복사본을 만들어서 사용할 수 있습니다.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="kw">head</span>(rivers)</span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="kw">length</span>(rivers)</span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="kw">class</span>(rivers)</span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="kw">data</span>(rivers)</span>
<span id="cb7-5"><a href="#cb7-5"></a><span class="kw">data</span>(<span class="dt">package=</span><span class="st">&quot;UsingR&quot;</span>)</span>
<span id="cb7-6"><a href="#cb7-6"></a><span class="kw">library</span>(HistData)</span>
<span id="cb7-7"><a href="#cb7-7"></a><span class="kw">head</span>(Cavendish)</span>
<span id="cb7-8"><a href="#cb7-8"></a><span class="kw">str</span>(Cavendish)</span>
<span id="cb7-9"><a href="#cb7-9"></a><span class="kw">head</span>(Cavendish<span class="op">$</span>density2)</span>
<span id="cb7-10"><a href="#cb7-10"></a><span class="kw">data</span>(<span class="dt">package=</span><span class="st">&quot;HistData&quot;</span>)</span></code></pre></div>
</div>
<div id="cheatsheet" class="section level2">
<h2 number="2.11"><span class="header-section-number">2.11</span> Cheatsheet</h2>
<p><img src="images/01/base-r_1.png" />
<img src="images/01/base-r_2.png" /></p>
<hr />
<p><a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="크리에이티브 커먼즈 라이선스" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/88x31.png" /></a><br />이 저작물은 <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/">크리에이티브 커먼즈 저작자표시-비영리-변경금지 4.0 국제 라이선스</a>에 따라 이용할 수 있습니다.</p>
<!--chapter:end:02-Rintro.Rmd-->
</div>
</div>
<div id="r-programming-basics-i" class="section level1">
<h1 number="3"><span class="header-section-number">3</span> R programming basics I</h1>
<div id="terminology" class="section level2">
<h2 number="3.1"><span class="header-section-number">3.1</span> Terminology</h2>
<ul>
<li>Session: R 언어 실행 환경</li>
<li>Console: 명령어 입력하는 창</li>
<li>Code: R 프로그래밍 변수/제어문 모음</li>
<li>Objects (개체, variable): 데이터(값, value)가 저장되는 장소</li>
<li>Object (variable) types:
<ul>
<li>Vectors: 값들의 모임 combine function <code>c()</code> EX: c(6, 11, 13, 31, 90, 92)</li>
<li>Factors: 범주형 데이터 저장 장소</li>
<li>Data frames: 2D matrix 형태 데이터 자장 장소</li>
</ul></li>
<li>Data (value) types: Integers, doubles/numerics, logicals, and characters.</li>
<li>Conditionals (조건, 제어):
<ul>
<li><code>if</code>, <code>==</code>, <code>&amp;</code> (AND), <code>|</code> (OR) Ex: <code>(2 + 1 == 3) &amp; (2 + 1 == 4)</code></li>
<li><code>for</code>, <code>while</code>: 반복 수</li>
</ul></li>
<li>Functions (함수, commands): 특정 일 수행, 함수이름 - 입력값 (arguments) - 출력값 (output) 으로 구성</li>
</ul>
</div>
<div id="r-console-script" class="section level2">
<h2 number="3.2"><span class="header-section-number">3.2</span> R console script</h2>
<p>콘솔에서 바로 계산을 수행할 수 있습니다. 참고로 이전에 수행한 명령은 콘솔에 커서가 있는 상태에서 위 아래 화살표를 누르면 볼 수 있고 엔터를 눌러 재사용 할 수 있습니다. <code>;</code>을 사용하면 두 개의 명령을 동시에 수행할 수 있습니다.</p>
<p><span class="math display">\[ 2 + 2 \]</span>
<span class="math display">\[ ((2 - 1)^2 + (1 - 3)^2)^{1/2} \]</span></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>((<span class="dv">2</span> – <span class="dv">1</span>)<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> – <span class="dv">3</span>)<span class="op">^</span><span class="dv">2</span> )<span class="op">^</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">2</span>)</span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span>; <span class="dv">2</span> <span class="op">-</span><span class="st"> </span><span class="dv">2</span></span></code></pre></div>
</div>
<div id="what-is-a-programming-language" class="section level2">
<h2 number="3.3"><span class="header-section-number">3.3</span> What is a programming language</h2>
<p><img src="images/01/24.PNG" />
<img src="images/01/25.PNG" /></p>
</div>
<div id="variables-and-values" class="section level2">
<h2 number="3.4"><span class="header-section-number">3.4</span> Variables and values</h2>
<ul>
<li>R is a programming language</li>
<li>Assignment operator ( <code>&lt;-</code> OR <code>=</code> )
<ul>
<li>Valid object name <code>&lt;-</code> value</li>
<li>단축키: <code>Alt + -</code> (the minus sign)</li>
</ul></li>
<li>내장 변수 Built-in variables</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>x &lt;-<span class="st"> </span><span class="dv">2</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>y &lt;-<span class="st"> </span>x<span class="op">^</span><span class="dv">2</span> – <span class="dv">2</span><span class="op">*</span>x <span class="op">+</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb9-3"><a href="#cb9-3"></a>y</span>
<span id="cb9-4"><a href="#cb9-4"></a>x &lt;-<span class="st"> &quot;two&quot;</span>  </span>
<span id="cb9-5"><a href="#cb9-5"></a>some_data &lt;-<span class="st"> </span><span class="fl">9.8</span></span>
<span id="cb9-6"><a href="#cb9-6"></a>pi</span></code></pre></div>
<ul>
<li>변수이름 작명법
<ul>
<li>Characters (letters), numbers, “_”, “.”</li>
<li>A and a are different symbols</li>
<li>Names are effectively unlimited in length</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>i_use_snake_case &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>otherPeopleUseCamelCase &lt;-<span class="st"> </span><span class="dv">2</span></span>
<span id="cb10-3"><a href="#cb10-3"></a>some.people.use.periods &lt;-<span class="st"> </span><span class="dv">3</span></span>
<span id="cb10-4"><a href="#cb10-4"></a>And_aFew.People_RENOUNCEconvention &lt;-<span class="st"> </span><span class="dv">4</span></span></code></pre></div>
<ul>
<li>자동 완성 기능 (Tab completion) in RStudio</li>
</ul>
</div>
<div id="object-variable-type-of-storage-mode" class="section level2">
<h2 number="3.5"><span class="header-section-number">3.5</span> Object (variable) type of (storage) mode</h2>
<p><img src="images/01/01-13.PNG" /></p>
</div>
<div id="levels-of-measurement" class="section level2">
<h2 number="3.6"><span class="header-section-number">3.6</span> Levels of measurement</h2>
<ul>
<li>Nominal (명목형) – 사람 이름</li>
<li>Ordinal (순서형) – 달리기 도착 순서</li>
<li>Interval (구간형) – 선수1, 선수2 종점통과 시간</li>
<li>Ratio (비율형) – 출발시간 기준 종점 통과 시간</li>
</ul>
<p><img src="images/02/01.png" /></p>
<ul>
<li>Numeric data types
<ul>
<li>Discrete (이산형) data - 카운트, 횟수</li>
<li>Continuous (연속형) data - 키, 몸무게, Cannot be shared</li>
</ul></li>
<li>Factors data - Categories to group the data</li>
<li>Character data - Identifiers</li>
<li>Date and time</li>
</ul>
</div>
<div id="object---vectors" class="section level2">
<h2 number="3.7"><span class="header-section-number">3.7</span> Object - Vectors</h2>
<p><code>vector</code>는 R의 기본 데이터 구조입니다. numeric vector, logical vector, character vector 등 저장되는 값의 타입에 따라 크게 세가지로 나눌 수 있습니다. <code>class()</code> 함수를 이용해서 값의 타입을 알아낼 수 있습니다. Combine function인 <code>c()</code>를 활용하여 만들며 값을 순차적으로 붙여갈 수 있습니다.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">10.4</span>, <span class="fl">5.6</span>, <span class="fl">3.1</span>, <span class="fl">6.4</span>, <span class="fl">21.7</span>) </span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="kw">class</span>(x)</span>
<span id="cb11-3"><a href="#cb11-3"></a>y &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;X1&quot;</span>, <span class="st">&quot;Y2&quot;</span>,  <span class="st">&quot;X3&quot;</span>,  <span class="st">&quot;Y4&quot;</span>)</span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="kw">class</span>(y)</span>
<span id="cb11-5"><a href="#cb11-5"></a>z &lt;-<span class="st"> </span><span class="kw">c</span>(T, F, F, T)</span>
<span id="cb11-6"><a href="#cb11-6"></a><span class="kw">class</span>(z)</span></code></pre></div>
<p>이 중 특히 numeric 형식의 벡터를 만드는 다양한 편의 함수들이 존재합니다.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="dv">1</span><span class="op">:</span><span class="dv">5</span></span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="kw">seq</span>(<span class="dv">1</span>,<span class="dv">5</span>, <span class="dt">by=</span><span class="dv">1</span>)</span>
<span id="cb12-3"><a href="#cb12-3"></a><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">100</span>, <span class="dt">by=</span><span class="dv">10</span>)</span>
<span id="cb12-4"><a href="#cb12-4"></a><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">100</span>, <span class="dt">length.out=</span><span class="dv">11</span>)</span>
<span id="cb12-5"><a href="#cb12-5"></a>?seq</span>
<span id="cb12-6"><a href="#cb12-6"></a></span>
<span id="cb12-7"><a href="#cb12-7"></a><span class="kw">rep</span>(<span class="dv">5</span>, <span class="dt">times=</span><span class="dv">10</span>)</span>
<span id="cb12-8"><a href="#cb12-8"></a><span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dt">times=</span><span class="dv">4</span>)</span>
<span id="cb12-9"><a href="#cb12-9"></a><span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dt">each=</span><span class="dv">3</span>)</span></code></pre></div>
<div id="exercise-3-1" class="section level3">
<h3 number="3.7.1"><span class="header-section-number">3.7.1</span> Exercise 3-1</h3>
<p>odds라는 이름의 변수에 1부터 100까지의 홀수만을 저장하시오 (<code>seq()</code> 함수 사용)</p>
<hr />
</div>
<div id="exercise-3-2" class="section level3">
<h3 number="3.7.2"><span class="header-section-number">3.7.2</span> Exercise 3-2</h3>
<p><code>1, 2, 3, 4, 5</code> 다섯 숫자에 대해서 두 개의 수를 뽑은 후 더해서 나올 수 있는 모든 수를 구하시오 즉, 1+1, 1+2, 1+3, …, 2+1, 2+2, …, 5+1, 5+2, …, 5+5 의 모든 경우에 대한 결과값을 구함 (<code>rep()</code> 함수 사용)</p>
<hr />
<p>Logical 벡터는 <code>True</code> 또는 <code>False</code>를 원소로 갖는 벡터 입니다. 앞글자가 대분자로 시작하는 것을 기억하시고 <code>T</code> 또는 <code>F</code>와 같이 한 문자로 표현할 수도 있습니다. 특정 조건에 대한 판단 결과를 반환할 경우에도 논리값을 사용합니다. 이 경우 조건을 판단 후 인덱싱 방법으로 해당 값들을 뽑아내기도 합니다.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="kw">is.na</span>(<span class="dv">1</span>)</span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="kw">is.numeric</span>(<span class="dv">1</span>)</span>
<span id="cb13-3"><a href="#cb13-3"></a><span class="kw">is.logical</span>(<span class="ot">TRUE</span>)</span>
<span id="cb13-4"><a href="#cb13-4"></a></span>
<span id="cb13-5"><a href="#cb13-5"></a>x &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">20</span></span>
<span id="cb13-6"><a href="#cb13-6"></a>x <span class="op">&gt;</span><span class="st"> </span><span class="dv">13</span></span>
<span id="cb13-7"><a href="#cb13-7"></a>temp &lt;-<span class="st"> </span>x <span class="op">&gt;</span><span class="st"> </span><span class="dv">13</span></span>
<span id="cb13-8"><a href="#cb13-8"></a><span class="kw">class</span>(temp)</span>
<span id="cb13-9"><a href="#cb13-9"></a></span>
<span id="cb13-10"><a href="#cb13-10"></a>ages &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">66</span>, <span class="dv">57</span>, <span class="dv">60</span>, <span class="dv">41</span>,  <span class="dv">6</span>, <span class="dv">85</span>, <span class="dv">48</span>, <span class="dv">34</span>, <span class="dv">61</span>, <span class="dv">12</span>)</span>
<span id="cb13-11"><a href="#cb13-11"></a>ages <span class="op">&lt;</span><span class="st"> </span><span class="dv">30</span></span>
<span id="cb13-12"><a href="#cb13-12"></a><span class="kw">which</span>(ages <span class="op">&lt;</span><span class="st"> </span><span class="dv">30</span>)</span>
<span id="cb13-13"><a href="#cb13-13"></a>i &lt;-<span class="st"> </span><span class="kw">which</span>(ages <span class="op">&lt;</span><span class="st"> </span><span class="dv">30</span>)</span>
<span id="cb13-14"><a href="#cb13-14"></a>ages[i]</span>
<span id="cb13-15"><a href="#cb13-15"></a><span class="kw">any</span>(ages <span class="op">&lt;</span><span class="st"> </span><span class="dv">30</span>)</span>
<span id="cb13-16"><a href="#cb13-16"></a><span class="kw">all</span>(ages <span class="op">&lt;</span><span class="st"> </span><span class="dv">30</span>)</span></code></pre></div>
</div>
<div id="exercise-3-3" class="section level3">
<h3 number="3.7.3"><span class="header-section-number">3.7.3</span> Exercise 3-3</h3>
<p>1부터 100까지의 수를 n이라는 이름의 변수에 저장하고 이 중 짝수만을 뽑아내서 출력하시오 (<code>which()</code>함수 사용)</p>
<hr />
<p>Character(문자형) 벡터의 경우 문자열을 다루는데 자주 쓰이는 <code>paste()</code> 함수의 사용법을 알아두면 편리합니다. <code>paste()</code> 함수는 서로 다른 문자열을 붙이는데 주로 사용됩니다. 참고로 문자열을 나누는 함수는 <code>strsplit()</code> 입니다. <code>paste()</code>에서 붙이는 문자 사이에 들어가는 문자를 지정하는 파라메터는 <code>sep</code> 이고 <code>strsplit()</code>함수에서 자르는 기준이 되는 문자는<code>split</code> 파라메터로 지정해 줍니다 (<code>?split</code> 또는 <code>?paste</code> 확인).</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="kw">paste</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;Y&quot;</span>, <span class="st">&quot;Z&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;_&quot;</span>)</span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="kw">paste</span>(<span class="kw">c</span>(<span class="st">&quot;Four&quot;</span>,<span class="st">&quot;The&quot;</span>), <span class="kw">c</span>(<span class="st">&quot;Score&quot;</span>,<span class="st">&quot;quick&quot;</span>), <span class="kw">c</span>(<span class="st">&quot;and&quot;</span>,<span class="st">&quot;fox&quot;</span>), <span class="dt">sep=</span><span class="st">&quot;_&quot;</span>)</span>
<span id="cb14-3"><a href="#cb14-3"></a><span class="kw">paste</span>(<span class="st">&quot;X&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb14-4"><a href="#cb14-4"></a><span class="kw">paste</span>(<span class="kw">c</span>(<span class="st">&quot;X&quot;</span>,<span class="st">&quot;Y&quot;</span>), <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb14-5"><a href="#cb14-5"></a></span>
<span id="cb14-6"><a href="#cb14-6"></a>x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;X1&quot;</span>, <span class="st">&quot;Y2&quot;</span>, <span class="st">&quot;X3&quot;</span>, <span class="st">&quot;Y4&quot;</span>, <span class="st">&quot;X5&quot;</span>)</span>
<span id="cb14-7"><a href="#cb14-7"></a><span class="kw">paste</span>(x[<span class="dv">1</span>], x[<span class="dv">2</span>])</span>
<span id="cb14-8"><a href="#cb14-8"></a><span class="kw">paste</span>(x[<span class="dv">1</span>], x[<span class="dv">2</span>], <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb14-9"><a href="#cb14-9"></a><span class="kw">paste</span>(x, <span class="dt">collapse=</span><span class="st">&quot;_&quot;</span>)</span>
<span id="cb14-10"><a href="#cb14-10"></a></span>
<span id="cb14-11"><a href="#cb14-11"></a><span class="kw">strsplit</span>(<span class="st">&quot;XYZ&quot;</span>, <span class="dt">split=</span><span class="st">&quot;&quot;</span>)</span></code></pre></div>
<p>Factor형은 범주형데이터를 저장하기 위한 object 이며 R 언어에서 특별히 만들어져 사용되고 있습니다. <code>factor()</code> 함수를 이용해 생성하며 생성된 객체는 다음과 같이 <code>level</code>이라는 범주를 나타내는 특성값을 가지고 있습니다.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Red&quot;</span>, <span class="st">&quot;Blue&quot;</span>, <span class="st">&quot;Yellow&quot;</span>, <span class="st">&quot;Green&quot;</span>, <span class="st">&quot;Blue&quot;</span>, <span class="st">&quot;Green&quot;</span>)</span>
<span id="cb15-2"><a href="#cb15-2"></a>y &lt;-<span class="st"> </span><span class="kw">factor</span>(x)</span>
<span id="cb15-3"><a href="#cb15-3"></a>y</span></code></pre></div>
<p>새로운 범주의 데이터를 추가할 경우 다음과 같이 해당되는 level을 먼저 추가하고 값을 저장해야 합니다.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="kw">levels</span>(y)</span>
<span id="cb16-2"><a href="#cb16-2"></a>y[<span class="dv">1</span>] &lt;-<span class="st"> &quot;Gold&quot;</span></span>
<span id="cb16-3"><a href="#cb16-3"></a>y</span>
<span id="cb16-4"><a href="#cb16-4"></a></span>
<span id="cb16-5"><a href="#cb16-5"></a><span class="kw">levels</span>(y) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">levels</span>(y), <span class="st">&quot;Gold&quot;</span>)</span>
<span id="cb16-6"><a href="#cb16-6"></a><span class="kw">levels</span>(y)</span>
<span id="cb16-7"><a href="#cb16-7"></a>y</span>
<span id="cb16-8"><a href="#cb16-8"></a>y[<span class="dv">1</span>] &lt;-<span class="st"> &quot;Gold&quot;</span></span>
<span id="cb16-9"><a href="#cb16-9"></a>y</span></code></pre></div>
<p><code>factor</code>는 기본적으로 <code>level</code>에 표시된 순서가 위치 (정렬) 순서입니다. 이를 바꾸기 위해서는 다음과 같이 <code>levels</code> 함수를 이용해서 순서를 바꿀 수 있습니다.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="co">#library(UsingR)</span></span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="kw">str</span>(Cars93)</span>
<span id="cb17-3"><a href="#cb17-3"></a>x &lt;-<span class="st"> </span>Cars93<span class="op">$</span>Origin</span>
<span id="cb17-4"><a href="#cb17-4"></a><span class="kw">plot</span>(x)</span>
<span id="cb17-5"><a href="#cb17-5"></a><span class="kw">levels</span>(x) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;non-USA&quot;</span>, <span class="st">&quot;USA&quot;</span>)</span>
<span id="cb17-6"><a href="#cb17-6"></a><span class="kw">levels</span>(x)</span>
<span id="cb17-7"><a href="#cb17-7"></a><span class="kw">plot</span>(x)</span></code></pre></div>
<p>vector 들은 다음과 같은 builtin 함수들을 사용해서 해당 변수의 attribute를 알아낼 수 있습니다. attribute에는 원소 이름, 타입, 길이 등 vector형 변수가 가질 수 있는 특성을 말합니다.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="kw">head</span>(precip)</span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="kw">class</span>(precip)</span>
<span id="cb18-3"><a href="#cb18-3"></a><span class="kw">length</span>(precip)</span>
<span id="cb18-4"><a href="#cb18-4"></a><span class="kw">names</span>(precip)</span>
<span id="cb18-5"><a href="#cb18-5"></a></span>
<span id="cb18-6"><a href="#cb18-6"></a>test_scores &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">100</span>, <span class="dv">90</span>, <span class="dv">80</span>)</span>
<span id="cb18-7"><a href="#cb18-7"></a><span class="kw">names</span>(test_scores) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Alice&quot;</span>, <span class="st">&quot;Bob&quot;</span>, <span class="st">&quot;Shirley&quot;</span>)</span>
<span id="cb18-8"><a href="#cb18-8"></a>test_scores</span></code></pre></div>
<p>인덱싱은 vector 데이터의 일부 데이터를 참조할 때 사용하는 방법입니다.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>x[<span class="dv">1</span>]</span>
<span id="cb19-2"><a href="#cb19-2"></a>x[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>]</span>
<span id="cb19-3"><a href="#cb19-3"></a>i &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">3</span></span>
<span id="cb19-4"><a href="#cb19-4"></a>x[i]</span>
<span id="cb19-5"><a href="#cb19-5"></a>x[<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">4</span>)]</span>
<span id="cb19-6"><a href="#cb19-6"></a>y[<span class="dv">3</span>]</span>
<span id="cb19-7"><a href="#cb19-7"></a></span>
<span id="cb19-8"><a href="#cb19-8"></a><span class="kw">head</span>(precip)</span>
<span id="cb19-9"><a href="#cb19-9"></a>precip[<span class="dv">1</span>]</span>
<span id="cb19-10"><a href="#cb19-10"></a>precip[<span class="dv">2</span><span class="op">:</span><span class="dv">10</span>]</span>
<span id="cb19-11"><a href="#cb19-11"></a>precip[<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>)]</span>
<span id="cb19-12"><a href="#cb19-12"></a>precip[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb19-13"><a href="#cb19-13"></a>precip[<span class="st">&quot;Seattle Tacoma&quot;</span>]</span>
<span id="cb19-14"><a href="#cb19-14"></a>precip[<span class="kw">c</span>(<span class="st">&quot;Seattle Tacoma&quot;</span>, <span class="st">&quot;Portland&quot;</span>)]</span>
<span id="cb19-15"><a href="#cb19-15"></a>precip[<span class="dv">2</span>] &lt;-<span class="st"> </span><span class="dv">10</span></span></code></pre></div>
</div>
</div>
<div id="object---matrix" class="section level2">
<h2 number="3.8"><span class="header-section-number">3.8</span> Object - matrix</h2>
<p>매트릭스는 2차원 행렬로 같은 형식의 데이터 값 (numberic, character, logical) 으로만 채워진 행렬을 말합니다. 메트릭스를 만드는 방법은 아래와 같으며 <code>nrow</code> 와 <code>ncol</code> 파라메터에 행과 열의 수를 넣고 각 셀에 들어갈 값은 가장 앞에 위치한 data 파라메터에 넣어 줍니다 (<code>?matrix</code>로 파라메터 이름 확인). 메트릭스 인덱싱은 메트릭스 안의 값을 저장하거나 참조할때 (빼올때) 사용하는 방법입니다. 메트릭스 변수이름 바로 뒤에 대괄호를 이용해서 제어를 하며 대괄호 안에 콤마로 구분된 앞쪽은 row, 뒷쪽은 column 인덱스를 나타냅니다.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>mymat &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">0</span>, <span class="dt">nrow=</span><span class="dv">100</span>, <span class="dt">ncol=</span><span class="dv">3</span>) <span class="co"># 1</span></span>
<span id="cb20-2"><a href="#cb20-2"></a>mymat[,<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">100</span> <span class="co"># 2</span></span>
<span id="cb20-3"><a href="#cb20-3"></a>mymat[,<span class="dv">2</span>] &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">1</span>,<span class="dv">200</span>,<span class="dv">2</span>) <span class="co"># 3</span></span>
<span id="cb20-4"><a href="#cb20-4"></a>mymat[,<span class="dv">3</span>] &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">2</span>,<span class="dv">200</span>,<span class="dv">2</span>) <span class="co"># 4</span></span></code></pre></div>
<p>매트릭스의 row나 column에 이름이 주어져 있을 경우 이름을 따옴표(")로 묶은 후 참조가 가능합니다. row나 column의 이름은 <code>rownames()</code> 또는 <code>colnames()</code>로 생성하거나 변경할 수 있습니다. row나 column의 개수는 <code>nrow()</code> 또는 <code>ncol()</code> 함수를 사용합니다.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="kw">colnames</span>(mymat)</span>
<span id="cb21-2"><a href="#cb21-2"></a><span class="kw">colnames</span>(mymat) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>)</span>
<span id="cb21-3"><a href="#cb21-3"></a><span class="kw">colnames</span>(mymat)</span>
<span id="cb21-4"><a href="#cb21-4"></a><span class="kw">colnames</span>(mymat)[<span class="dv">2</span>] &lt;-<span class="st"> &quot;D&quot;</span></span>
<span id="cb21-5"><a href="#cb21-5"></a><span class="kw">colnames</span>(mymat)</span>
<span id="cb21-6"><a href="#cb21-6"></a><span class="kw">rownames</span>(mymat) &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;No&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(mymat), <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb21-7"><a href="#cb21-7"></a><span class="kw">rownames</span>(mymat)</span></code></pre></div>
<p>여러 row나 column을 참조할 경우 아래와 같이 combine 함수를 사용하여 묶어줘야 하며 스칼라값을 (임의의 숫자 하나) 더하거나 뺄 경우 vector / matrix 연산을 기본으로 수행합니다.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>mymat[<span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>),<span class="dv">2</span>] <span class="co"># 5</span></span>
<span id="cb22-2"><a href="#cb22-2"></a>mymat<span class="dv">-1</span> <span class="co"># 6</span></span>
<span id="cb22-3"><a href="#cb22-3"></a>mysub &lt;-<span class="st"> </span>mymat[,<span class="dv">2</span>] <span class="op">-</span><span class="st"> </span>mymat[,<span class="dv">1</span>] <span class="co">#7</span></span>
<span id="cb22-4"><a href="#cb22-4"></a><span class="kw">sum</span>(mysub) <span class="co">#8</span></span>
<span id="cb22-5"><a href="#cb22-5"></a><span class="kw">sum</span>(mysub<span class="op">^</span><span class="dv">2</span>) <span class="co">#8</span></span></code></pre></div>
<div id="exercise-3-4" class="section level3">
<h3 number="3.8.1"><span class="header-section-number">3.8.1</span> Exercise 3-4</h3>
<p>column이 3개이고 row가 3인 0으로 채워진 m이라는 이름의 matrix를 만들고 m의 각 원소를 1로 채우시오.</p>
<hr />
</div>
</div>
<div id="object---data.frame" class="section level2">
<h2 number="3.9"><span class="header-section-number">3.9</span> Object - data.frame</h2>
<p>데이터프레임은 형태는 매트릭스와 같으나 컬럼 하나가 하나의 변수로서 각 변수들이 다른 모드의 값을 저장할 수 있다는 차이가 있습니다. <code>$</code> 기호를 이용하여 각 구성 변수를 참조할 수 있습니다. 컬럼 한 줄이 하나의 변수 이므로 새로운 변수도 컬럼 형태로 붙여 넣을 수 있습니다. 즉, 각 row는 샘플을 나타내고 각 column은 변수를 나타내며 각 변수들이 갖는 샘플의 개수 (row의 길이, vector 의 길이)는 같아야 합니다. R 기반의 데이터 분석에서는 가장 선호되는 데이터 타입이라고 볼 수 있습니다.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="co">## data.frame</span></span>
<span id="cb23-2"><a href="#cb23-2"></a>ids &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span></span>
<span id="cb23-3"><a href="#cb23-3"></a>ids</span>
<span id="cb23-4"><a href="#cb23-4"></a>idnames &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;Name&quot;</span>, ids, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb23-5"><a href="#cb23-5"></a>idnames</span>
<span id="cb23-6"><a href="#cb23-6"></a>students &lt;-<span class="st"> </span><span class="kw">data.frame</span>(ids, idnames)</span>
<span id="cb23-7"><a href="#cb23-7"></a>students</span>
<span id="cb23-8"><a href="#cb23-8"></a><span class="kw">class</span>(students<span class="op">$</span>ids)</span>
<span id="cb23-9"><a href="#cb23-9"></a><span class="kw">class</span>(students<span class="op">$</span>idnames)</span>
<span id="cb23-10"><a href="#cb23-10"></a>students<span class="op">$</span>idnames</span>
<span id="cb23-11"><a href="#cb23-11"></a><span class="kw">str</span>(students)</span>
<span id="cb23-12"><a href="#cb23-12"></a></span>
<span id="cb23-13"><a href="#cb23-13"></a>students &lt;-<span class="st"> </span><span class="kw">data.frame</span>(ids, idnames, <span class="dt">stringsAsFactors =</span> F)</span>
<span id="cb23-14"><a href="#cb23-14"></a><span class="kw">class</span>(students<span class="op">$</span>idnames)</span>
<span id="cb23-15"><a href="#cb23-15"></a>students<span class="op">$</span>idnames</span>
<span id="cb23-16"><a href="#cb23-16"></a>students[<span class="dv">1</span>,]</span>
<span id="cb23-17"><a href="#cb23-17"></a><span class="kw">str</span>(students)</span></code></pre></div>
<p>데이터프레임에서도 변수 이름으로 인덱싱이 가능합니다.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="co">## data frame indexing </span></span>
<span id="cb24-2"><a href="#cb24-2"></a>students<span class="op">$</span>ids</span>
<span id="cb24-3"><a href="#cb24-3"></a>students[,<span class="dv">1</span>]</span>
<span id="cb24-4"><a href="#cb24-4"></a>students[,<span class="st">&quot;ids&quot;</span>]</span></code></pre></div>
</div>
<div id="object---list" class="section level2">
<h2 number="3.10"><span class="header-section-number">3.10</span> Object - list</h2>
<p>리스트는 변수들의 모임이라는 점에서 데이터프레임과 같으나 구성 변수들의 길이가 모두 같아야 하는 데이터프레임과는 달리 다른 길이의 변수를 모아둘 수 있는 점이 다릅니다. 즉, R언어에서 두 변수를 담을 수 있는 데이터 타입은 <code>list</code>와 <code>data frame</code> 두 종류가 있는데 <code>list</code> 변수 타입은 <code>vector</code> 형태의 여러개의 element를 가질 수 있으며 각 <code>vector의</code> 길이가 모두 달라도 됩니다. list의 인덱싱에서 <code>[</code> <code>]</code>는 리스트를 반환하고 <code>[[</code> <code>]]</code>는 vector element들을 반환합니다.</p>
<p><img src="images/03/05.PNG" /></p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="co">## list</span></span>
<span id="cb25-2"><a href="#cb25-2"></a>parent_names &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Fred&quot;</span>, <span class="st">&quot;Mary&quot;</span>)</span>
<span id="cb25-3"><a href="#cb25-3"></a>number_of_children &lt;-<span class="st"> </span><span class="dv">2</span></span>
<span id="cb25-4"><a href="#cb25-4"></a>child_ages &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">9</span>)</span>
<span id="cb25-5"><a href="#cb25-5"></a><span class="kw">data.frame</span>(parent_names, number_of_children, child_ages)</span>
<span id="cb25-6"><a href="#cb25-6"></a>lst &lt;-<span class="st"> </span><span class="kw">list</span>(parent_names, number_of_children, child_ages)</span>
<span id="cb25-7"><a href="#cb25-7"></a>lst[<span class="dv">1</span>]</span>
<span id="cb25-8"><a href="#cb25-8"></a>lst[[<span class="dv">1</span>]]</span>
<span id="cb25-9"><a href="#cb25-9"></a><span class="kw">class</span>(lst[<span class="dv">1</span>])</span>
<span id="cb25-10"><a href="#cb25-10"></a><span class="kw">class</span>(lst[[<span class="dv">1</span>]])</span>
<span id="cb25-11"><a href="#cb25-11"></a>lst[[<span class="dv">1</span>]][<span class="dv">1</span>]</span>
<span id="cb25-12"><a href="#cb25-12"></a>lst[[<span class="dv">1</span>]][<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)]</span></code></pre></div>
<p><img src="images/03/06.PNG" /></p>
</div>
<div id="missing-values" class="section level2">
<h2 number="3.11"><span class="header-section-number">3.11</span> Missing values</h2>
<p>특정 값이 “Not available” 이거나 “Missing value” 일 경우 벡터의 해당 원소 자리에 데이터의 이상을 알리기 위해 <code>NA</code>를 사용합니다. 따라서 일반적인 연산에서 <code>NA</code>가 포함되어 있는 경우 데이터의 불완전성을 알리기 위해 연산의 결과는 <code>NA</code>가 됩니다. <code>is.na()</code> 함수는 해당 변수에 <code>NA</code> 값이 있는지를 검사해주는 함수이며 R에는 이 외에도 다음과 같은 특수 값들이 사용되고 있습니다.</p>
<ul>
<li>NA: Not available, The value is missing</li>
<li>NULL: a reserved value</li>
<li>NaN: Not a number (0/0)</li>
<li>Inf: (1/0)</li>
</ul>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a>hip_cost &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">10500</span>, <span class="dv">45000</span>, <span class="dv">74100</span>, <span class="ot">NA</span>, <span class="dv">83500</span>)</span>
<span id="cb26-2"><a href="#cb26-2"></a><span class="kw">sum</span>(hip_cost)</span>
<span id="cb26-3"><a href="#cb26-3"></a><span class="kw">sum</span>(hip_cost, <span class="dt">na.rm=</span><span class="ot">TRUE</span>)</span>
<span id="cb26-4"><a href="#cb26-4"></a>?sum</span></code></pre></div>
</div>
<div id="useful-functions-i" class="section level2">
<h2 number="3.12"><span class="header-section-number">3.12</span> Useful functions I</h2>
<p>다음은 벡터형 변수와 같이 쓰이는 유용한 함수들입니다.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a>z &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">100</span>, T)</span>
<span id="cb27-2"><a href="#cb27-2"></a><span class="kw">head</span>(z)</span>
<span id="cb27-3"><a href="#cb27-3"></a><span class="kw">sort</span>(z)</span>
<span id="cb27-4"><a href="#cb27-4"></a><span class="kw">order</span>(z)</span>
<span id="cb27-5"><a href="#cb27-5"></a><span class="kw">table</span>(z)</span>
<span id="cb27-6"><a href="#cb27-6"></a>p &lt;-<span class="st"> </span>z<span class="op">/</span><span class="kw">sum</span>(z)</span>
<span id="cb27-7"><a href="#cb27-7"></a><span class="kw">round</span>(p, <span class="dt">digits=</span><span class="dv">1</span>)</span>
<span id="cb27-8"><a href="#cb27-8"></a>digits &lt;-<span class="st"> </span><span class="kw">as.character</span>(z)</span>
<span id="cb27-9"><a href="#cb27-9"></a>n &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(digits)</span>
<span id="cb27-10"><a href="#cb27-10"></a>d &lt;-<span class="st"> </span><span class="kw">as.integer</span>(digits)</span></code></pre></div>
<div id="exercise-3-5" class="section level3">
<h3 number="3.12.1"><span class="header-section-number">3.12.1</span> Exercise 3-5</h3>
<ul>
<li>score 라는 변수에 1부터 100까지 중 랜덤하게 선택된 20개의 수로 10 x 2 matrix를 만드시오</li>
<li>score의 row 이름을 문자형으로 Name1, Name2, …, Name10으로 지정하시오 (<code>paste()</code>변수 사용)</li>
<li>score의 column 이름을 문자형으로 math와 eng로 지정하시오</li>
<li>이 matrix의 첫번째 컬럼과 두 번째 컬럼의 수를 각각 더한 후 total_score라는 변수에 저장 하시오</li>
<li>total_score 오름차순 순서를 나타내는 인덱스 (<code>order()</code>함수 사용)를 o라는 변수에 저장 하시오</li>
<li>score를 o순서로 재 배치 하고 score_ordered 변수에 저장 하시오</li>
</ul>
<hr />
<p><a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="크리에이티브 커먼즈 라이선스" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/88x31.png" /></a><br />이 저작물은 <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/">크리에이티브 커먼즈 저작자표시-비영리-변경금지 4.0 국제 라이선스</a>에 따라 이용할 수 있습니다.</p>
<!--chapter:end:03-Rprogbasics.Rmd-->
</div>
</div>
</div>
<div id="r-programming-basics-ii" class="section level1">
<h1 number="4"><span class="header-section-number">4</span> R programming basics II</h1>
<div id="a-script-in-r" class="section level2">
<h2 number="4.1"><span class="header-section-number">4.1</span> A script in R</h2>
<p>R 프로그래밍을 통해서 사용자가 원하는 기능을 수행하는 방법은 다음과 같이 스크립트를 만들어서 실행하는 것 입니다. 일반적으로 R을 이용한 스크립트 명령을 어떻게 실행하는지 알아보겠습니다. 다음 예제는 입력 값들의 평균을 계산해서 출력해 주는 스크립트 명령입니다. R base 패키지에서 기본으로 제공되는 <code>mean()</code>이라는 함수가 있지만 사용하지 않고 <code>sum()</code>과 <code>length()</code> 함수를 사용했습니다.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a>numbers &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.452</span>, <span class="fl">1.474</span>, <span class="fl">0.22</span>, <span class="fl">0.545</span>, <span class="fl">1.205</span>, <span class="fl">3.55</span>)</span>
<span id="cb28-2"><a href="#cb28-2"></a><span class="kw">cat</span>(<span class="st">&quot;Input numbers are&quot;</span>, numbers, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb28-3"><a href="#cb28-3"></a>numbers_mean &lt;-<span class="st"> </span><span class="kw">sum</span>(numbers)<span class="op">/</span><span class="kw">length</span>(numbers)</span>
<span id="cb28-4"><a href="#cb28-4"></a>out &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;The average is &quot;</span>, numbers_mean, <span class="st">&quot;.</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb28-5"><a href="#cb28-5"></a><span class="kw">cat</span>(out)</span></code></pre></div>
<p>상황에 따라 다르긴 하지만 보통 위 스크립트를 실행할 때 R 파일을 하나 만들고 <code>source()</code>라는 함수를 사용해서 파일 전체를 한번에 읽어들이고 실행을 시킵니다. 위 코드를 <code>myscript.R</code> 이라는 새로운 R 파일을 하나 만들고 저장 후 다음과 같이 실행할 수 있습니다. 참고로 위 파일은 현재 working directory와 같은 위치에 저장해야 합니다.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="kw">source</span>(<span class="st">&quot;myscript.R&quot;</span>)</span></code></pre></div>
<p>그러나 위와 같은 식으로 실행할 경우 다음 몇 가지 문제가 있습니다. 하나는 입력 값이 바뀔 때마나 파일을 열어 바뀐 값을 저장해 줄 필요가 있습니다. 결과 값에 대해서 다른 처리를 하고 싶을 경우 또한 파일을 직접 수정해 주어야 합니다. 또한 모든 변수들이 전역변수로 사용되어 코드가 복잡해질 경우 변수간 간섭이 생길 가능성이 높습니다.</p>
</div>
<div id="functions" class="section level2">
<h2 number="4.2"><span class="header-section-number">4.2</span> Functions</h2>
<p>함수를 사용하면 위와같은 문제를 극복할 수 있습니다. 함수(Function)는 다음과 같은 포멧으로 구현할 수 있습니다.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a>myfunction.name &lt;-<span class="st"> </span><span class="cf">function</span>(parameter1, parameter2, ... ){</span>
<span id="cb30-2"><a href="#cb30-2"></a>  statements</span>
<span id="cb30-3"><a href="#cb30-3"></a>  <span class="kw">return</span>(object)</span>
<span id="cb30-4"><a href="#cb30-4"></a>}</span></code></pre></div>
<p>예를 들어 다음과 같은 <code>my_sine</code> 함수를 만들 수 있으며 parameter (매개변수)는 <code>x</code>이고 <code>y</code>는 반환값을 저장하는 지역변수 입니다.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a>my_sine &lt;-<span class="st"> </span><span class="cf">function</span>(x){</span>
<span id="cb31-2"><a href="#cb31-2"></a>    y &lt;-<span class="st"> </span><span class="kw">sin</span>(x)</span>
<span id="cb31-3"><a href="#cb31-3"></a>    <span class="kw">return</span>(y)</span>
<span id="cb31-4"><a href="#cb31-4"></a>}</span></code></pre></div>
<p>만들어진 함수는 다음과 같이 사용할 수 있습니다. 만들어진 함수는 처음에 한 번 실행해 주어 실행중인 R session에 등록한 후 사용할 수 있습니다. 여기서 함수로 전달되는 값 <code>pi</code>는 argument (전달인자) 라고 합니다. 전달인자는 함수에서 정의된 매개변수의 갯수와 같은 수의 전달인자를 입력해 주어야 합니다.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="kw">my_sine</span>(pi)</span></code></pre></div>
<ul>
<li>Terminology
<ul>
<li>function name: <code>my_sine</code></li>
<li>parameter: <code>x</code></li>
<li>argument: <code>pi</code></li>
<li>return value: <code>y</code></li>
</ul></li>
</ul>
<p>이제 위 스크립트에서 사용된 코드를 함수로 바꿔봅니다. numbers (전달인자)를 받는 매개변수를 x로 하고 함수 이름은 <code>mymean</code> 이고 평균값 (numbers_mean)을 반환하는 합수입니다.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a>numbers &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.452</span>, <span class="fl">1.474</span>, <span class="fl">0.22</span>, <span class="fl">0.545</span>, <span class="fl">1.205</span>, <span class="fl">3.55</span>)</span>
<span id="cb33-2"><a href="#cb33-2"></a></span>
<span id="cb33-3"><a href="#cb33-3"></a>mymean &lt;-<span class="st"> </span><span class="cf">function</span>(x){</span>
<span id="cb33-4"><a href="#cb33-4"></a>  <span class="kw">cat</span>(<span class="st">&quot;Input numbers are&quot;</span>, x, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb33-5"><a href="#cb33-5"></a>  numbers_mean &lt;-<span class="st"> </span><span class="kw">sum</span>(x)<span class="op">/</span><span class="kw">length</span>(x)</span>
<span id="cb33-6"><a href="#cb33-6"></a>  out &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;The average is &quot;</span>, numbers_mean, <span class="st">&quot;.</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb33-7"><a href="#cb33-7"></a>  <span class="kw">cat</span>(out)</span>
<span id="cb33-8"><a href="#cb33-8"></a>  <span class="kw">return</span>(numbers_mean)</span>
<span id="cb33-9"><a href="#cb33-9"></a>}</span>
<span id="cb33-10"><a href="#cb33-10"></a></span>
<span id="cb33-11"><a href="#cb33-11"></a>retval &lt;-<span class="st"> </span><span class="kw">mymean</span>(numbers)</span>
<span id="cb33-12"><a href="#cb33-12"></a><span class="kw">cat</span>(retval)</span></code></pre></div>
<p><code>myscript.R</code>이라는 파일을 열고 작성된 스크립트에 더해서 아래처럼 함수 코드를 만들 경우 <code>source()</code> 함수로 함수를 세션으로 읽어오고 바로 사용할 수 있습니다. 위와 같이 함수를 만들 경우 입력 값을 언제든 바꿔서 사용할 수 있고 반환값에 대한 추가적인 연산도 쉽게 수행 할 수 있습니다.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a>new_values &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)</span>
<span id="cb34-2"><a href="#cb34-2"></a>retval &lt;-<span class="st"> </span><span class="kw">mymean</span>(new_values)</span>
<span id="cb34-3"><a href="#cb34-3"></a>retval</span></code></pre></div>
<div id="exercise-4-1" class="section level3">
<h3 number="4.2.1"><span class="header-section-number">4.2.1</span> Exercise 4-1</h3>
<ol style="list-style-type: decimal">
<li><code>mysd</code>라는 이름의 (표본)표준편차를 구하는 함수를 <code>myscript.R</code> 파일에 구현하시오 (<code>sd()</code>함수 사용 불가, 다음 표준편차 공식 이용)</li>
</ol>
<p><span class="math display">\[ 
\sigma = \sqrt{\frac{\sum(x-mean(x))^2}{length(x)-1}} 
\]</span></p>
<p>코드는 아래와 같음</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a>numbers_sd &lt;-<span class="st"> </span><span class="kw">sqrt</span>(((x <span class="op">-</span><span class="st"> </span><span class="kw">mymean</span>(x))<span class="op">^</span><span class="dv">2</span>)<span class="op">/</span>(<span class="kw">length</span>(x)<span class="op">-</span><span class="dv">1</span>))</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li><p>1부터 100까지의 값을 <code>x</code>에 저장하고 mysd 함수를 사용해서 표준편차를 구하시오</p></li>
<li><p>앞서 작성한 <code>mymean</code> 함수와 <code>mysd</code> 함수를 같이 사용하여 <code>x</code>를 표준화 하고 <code>y</code>로 저장하시오. 표준화 공식은 다음과 같음</p></li>
</ol>
<p><span class="math display">\[ 
y = \frac{x - mean(x)}{sd(x)}
\]</span></p>
<ol start="4" style="list-style-type: decimal">
<li><code>x</code> 와 <code>y</code>를 갖는 <code>z</code>라는 이름의 <code>data.frame</code>을 생성하시오</li>
</ol>
<hr />
<p>다음 코드를 보면 전역변수 <code>x</code>, <code>y</code>는 지역변수 <code>x</code>, <code>y</code>와 독립적으로 사용됨을 알 수 있습니다.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a>my_half &lt;-<span class="st"> </span><span class="cf">function</span>(x){</span>
<span id="cb36-2"><a href="#cb36-2"></a>  y &lt;-<span class="st"> </span>x<span class="op">/</span><span class="dv">2</span></span>
<span id="cb36-3"><a href="#cb36-3"></a>  <span class="kw">cat</span>(<span class="st">&quot;local variable x:&quot;</span>, x, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb36-4"><a href="#cb36-4"></a>  <span class="kw">cat</span>(<span class="st">&quot;local variable y:&quot;</span>, y, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb36-5"><a href="#cb36-5"></a>  <span class="kw">return</span>(y)</span>
<span id="cb36-6"><a href="#cb36-6"></a>}</span>
<span id="cb36-7"><a href="#cb36-7"></a>y &lt;-<span class="st"> </span><span class="dv">100</span></span>
<span id="cb36-8"><a href="#cb36-8"></a>x &lt;-<span class="st"> </span><span class="dv">20</span></span>
<span id="cb36-9"><a href="#cb36-9"></a><span class="kw">cat</span>(<span class="st">&quot;Global variable x:&quot;</span>, x, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb36-10"><a href="#cb36-10"></a><span class="kw">cat</span>(<span class="st">&quot;Global variable y:&quot;</span>, y, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb36-11"><a href="#cb36-11"></a><span class="kw">my_half</span>(<span class="dv">5</span>)</span></code></pre></div>
<p><code>log</code>, <code>sin</code>등의 함수들은 Built-in function으로 같은 이름의 함수를 만들지 않도록 주의합니다.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a>x &lt;-<span class="st"> </span>pi</span>
<span id="cb37-2"><a href="#cb37-2"></a><span class="kw">sin</span>(x)</span>
<span id="cb37-3"><a href="#cb37-3"></a><span class="kw">sqrt</span>(x)</span>
<span id="cb37-4"><a href="#cb37-4"></a><span class="kw">log</span>(x)</span>
<span id="cb37-5"><a href="#cb37-5"></a><span class="kw">log</span>(x, <span class="dv">10</span>)</span>
<span id="cb37-6"><a href="#cb37-6"></a>x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>)</span>
<span id="cb37-7"><a href="#cb37-7"></a>x <span class="op">+</span><span class="st"> </span>x</span>
<span id="cb37-8"><a href="#cb37-8"></a><span class="kw">mean</span>(x)</span>
<span id="cb37-9"><a href="#cb37-9"></a><span class="kw">sum</span>(x)<span class="op">/</span><span class="kw">length</span>(x)</span></code></pre></div>
</div>
</div>
<div id="vectorized-functions" class="section level2">
<h2 number="4.3"><span class="header-section-number">4.3</span> Vectorized functions</h2>
<p>초기에 R이 다른 프로그래밍 언어에 비해서 경쟁력을 갖는 이유 중 하나가 바로 이 벡터 연산 기능 이였습니다. <code>vector</code> 변수에 들어있는 각 원소들에 대해서 특정 함수나 연산을 적용하고 싶을 경우 전통 방식의 <code>C</code>나 <code>Java</code>등의 언어에서는 원소의 개수만큼 반복문을 돌면서 원하는 작업을 수행 했습니다. 그러나 R의 벡터 연산 기능은 별도의 반복문 없이 vector 안에 있는 원소들에 대한 함수 실행 또는 연산을 수행할 수 있습니다.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a>x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>)</span>
<span id="cb38-2"><a href="#cb38-2"></a>x <span class="op">+</span><span class="st"> </span>x</span>
<span id="cb38-3"><a href="#cb38-3"></a><span class="kw">sqrt</span>(x)</span>
<span id="cb38-4"><a href="#cb38-4"></a><span class="kw">sin</span>(x)</span>
<span id="cb38-5"><a href="#cb38-5"></a><span class="kw">log</span>(x)</span>
<span id="cb38-6"><a href="#cb38-6"></a>x<span class="op">-</span><span class="kw">mean</span>(x)</span>
<span id="cb38-7"><a href="#cb38-7"></a></span>
<span id="cb38-8"><a href="#cb38-8"></a><span class="kw">length</span>(x)</span>
<span id="cb38-9"><a href="#cb38-9"></a>test_scores &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">Alice =</span> <span class="dv">87</span>, <span class="dt">Bob =</span> <span class="dv">72</span>, <span class="dt">James=</span> <span class="dv">99</span>)</span>
<span id="cb38-10"><a href="#cb38-10"></a><span class="kw">names</span>(test_scores)</span></code></pre></div>
<div id="exercise-4-2" class="section level3">
<h3 number="4.3.1"><span class="header-section-number">4.3.1</span> Exercise 4-2</h3>
<p>다음은 한 다이어트 프로그램의 수행 전 후의 다섯 명의 몸무게이다.</p>
<p><img src="images/01/01-21.PNG" /></p>
<ol style="list-style-type: decimal">
<li><p>각각을 before 와 after 이름의 변수에 저장 후 몸무게 값의 변화량을 계산하여 diff 라는 변수에 저장하고 diff에 저장된 값들의 평균을 구하시오</p></li>
<li><p>my_mean 이라는 이름의 함수로 평균을 구하는 코드를 작성 하시오 (빌트인 함수 사용하지 않음)</p></li>
</ol>
<ul>
<li>함수이름: my_mean</li>
<li>parameter: x</li>
<li>return 값: y</li>
<li>(x[1]+x[2]+x[3]+x[4]+x[5])/5</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>빌트인 함수 sum()과 length()를 이용해 동일한 기능을 하는 함수를 작성하시오</li>
</ol>
<ul>
<li>함수이름 my_mean2</li>
<li>sum(), length() 사용</li>
</ul>
</div>
<div id="exercise-4-3" class="section level3">
<h3 number="4.3.2"><span class="header-section-number">4.3.2</span> Exercise 4-3</h3>
<p>다음 네 학생이 있으며 “John”,“James”,“Sara”, “Lilly” 각 나이는 21, 55, 23, 53 이다. ages 라는 변수를 생성하고 각 나이를 저장한 후 who라는 이름의 함수를 만들어서 50살 이상인 사람의 이름을 출력하는 함수를 만드시오.</p>
<ul>
<li>ages라는 변수에 나이 저장, c() 함수 이용, vector 형태 저장</li>
<li>names() 함수 이용해서 각 ages 벡터의 각 요소에 이름 붙이기</li>
<li>which() 함수 사용해서 나이가 50보다 큰 인덱스 찾고 해당 인덱스 값 출력 하기</li>
<li>ages를 메개변수로 받아서 나이가 50보다 큰 인덱스 찾고 해당 인덱스의 값을 반환해 주는 who 함수 만들고 사용</li>
</ul>
</div>
</div>
<div id="if-statements" class="section level2">
<h2 number="4.4"><span class="header-section-number">4.4</span> if statements</h2>
<p>R에서의 제어문의 사용은 다른 프로그래밍 언어와 거의 유사합니다. 먼저 <code>if</code> 는 다음과 같은 형식으로 사용되며 <code>()</code> 안에 특정 조건 판단을 위한 표현이 들어갑니다.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a><span class="cf">if</span>(condition){</span>
<span id="cb39-2"><a href="#cb39-2"></a>  expr_<span class="dv">1</span></span>
<span id="cb39-3"><a href="#cb39-3"></a>}<span class="cf">else</span>{</span>
<span id="cb39-4"><a href="#cb39-4"></a>  expr_<span class="dv">2</span></span>
<span id="cb39-5"><a href="#cb39-5"></a>}</span></code></pre></div>
<p>특히 <code>condition</code>은 하나의 원소에 대한 조건 판단문으로 <code>T</code> 또는 <code>F</code> 값 하나만을 반환하는 문장이어야 합니다. 위 코드는 만약 <code>condition</code> 조건이 <code>True</code> 이면 expr_1를 실행하고 <code>False</code>이면 expr_2를 실행하라는 명령입니다. <code>condition</code> 안에서 사용되는 비교 연산자들은 다음과 같습니다.</p>
<p><img src="images/04/01.PNG" /></p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a>x &lt;-<span class="st"> </span><span class="dv">2</span></span>
<span id="cb40-2"><a href="#cb40-2"></a><span class="cf">if</span>(x<span class="op">%%</span><span class="dv">2</span> <span class="op">==</span><span class="st"> </span><span class="dv">1</span>){</span>
<span id="cb40-3"><a href="#cb40-3"></a>  <span class="kw">cat</span>(<span class="st">&quot;Odd&quot;</span>)</span>
<span id="cb40-4"><a href="#cb40-4"></a>}<span class="cf">else</span>{</span>
<span id="cb40-5"><a href="#cb40-5"></a>  <span class="kw">cat</span>(<span class="st">&quot;Even&quot;</span>)</span>
<span id="cb40-6"><a href="#cb40-6"></a>} </span>
<span id="cb40-7"><a href="#cb40-7"></a></span>
<span id="cb40-8"><a href="#cb40-8"></a>x &lt;-<span class="st"> </span><span class="dv">5</span></span>
<span id="cb40-9"><a href="#cb40-9"></a><span class="cf">if</span>(x <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>x <span class="op">&lt;</span><span class="st"> </span><span class="dv">4</span>){</span>
<span id="cb40-10"><a href="#cb40-10"></a>   <span class="kw">print</span>(<span class="st">&quot;Positive number less than four&quot;</span>)</span>
<span id="cb40-11"><a href="#cb40-11"></a>}</span>
<span id="cb40-12"><a href="#cb40-12"></a><span class="cf">if</span>(x <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="kw">print</span>(<span class="st">&quot;Positive number&quot;</span>)</span>
<span id="cb40-13"><a href="#cb40-13"></a></span>
<span id="cb40-14"><a href="#cb40-14"></a></span>
<span id="cb40-15"><a href="#cb40-15"></a>x &lt;-<span class="st"> </span><span class="dv">-5</span></span>
<span id="cb40-16"><a href="#cb40-16"></a><span class="cf">if</span>(x <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>){</span>
<span id="cb40-17"><a href="#cb40-17"></a>    <span class="kw">print</span>(<span class="st">&quot;Non-negative number&quot;</span>)</span>
<span id="cb40-18"><a href="#cb40-18"></a>} <span class="cf">else</span> <span class="cf">if</span>(x <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>x <span class="op">&gt;</span><span class="st"> </span><span class="dv">-5</span>){</span>
<span id="cb40-19"><a href="#cb40-19"></a>    <span class="kw">print</span>(<span class="st">&quot;Negative number greater than -5&quot;</span>)</span>
<span id="cb40-20"><a href="#cb40-20"></a>} <span class="cf">else</span> {</span>
<span id="cb40-21"><a href="#cb40-21"></a>  <span class="kw">print</span>(<span class="st">&quot;Negative number less than -5&quot;</span>)</span>
<span id="cb40-22"><a href="#cb40-22"></a>}</span>
<span id="cb40-23"><a href="#cb40-23"></a></span>
<span id="cb40-24"><a href="#cb40-24"></a><span class="cf">if</span>(x <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</span>
<span id="cb40-25"><a href="#cb40-25"></a>    <span class="kw">print</span>(<span class="st">&quot;Non-negative number&quot;</span>)</span>
<span id="cb40-26"><a href="#cb40-26"></a><span class="cf">else</span></span>
<span id="cb40-27"><a href="#cb40-27"></a>    <span class="kw">print</span>(<span class="st">&quot;Negative number&quot;</span>)</span></code></pre></div>
<div id="exercise-4-4" class="section level3">
<h3 number="4.4.1"><span class="header-section-number">4.4.1</span> Exercise 4-4</h3>
<ol style="list-style-type: decimal">
<li><p>1부터 100까지 수 중 랜덤하게 1 개의 값을 골라 n 변수에 저장하고 다시 1부터 100까지 랜덤하게 n개의 수를 중복을 허용해서 골라 x 변수에 저장 하시오 (랜덤 생성: <code>sample()</code>함수 사용)</p></li>
<li><p>다음은 median (중간값)을 구하는 공식이며 x의 길이가 (n이) 홀수일 경우와 짝수일 경우에 따라서 다른 공식이 사용된다. 다음 공식과 코드를 이용하여 mymedian 이라는 이름의 함수를 만들고 입력 값들의 중간값을 구해서 반환하는 함수를 만드시오. (<code>%%</code> 나머지 연산, <code>if</code>문 사용, 아래 중간값 코드 참고)</p></li>
</ol>
<p><span class="math display">\[
median(X) =
\begin{cases}
\frac{1}{2} X[\frac{n}{2}] + \frac{1}{2} X[1+\frac{n}{2}] &amp; \mbox{if } n \mbox{ is even} \\
X[\frac{n+1}{2}] &amp; \mbox{if } n \mbox{ is odd}
\end{cases}
\]</span></p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a>sorted_x &lt;-<span class="st"> </span><span class="kw">sort</span>(x)</span>
<span id="cb41-2"><a href="#cb41-2"></a>retval &lt;-<span class="st"> </span>sort_x[n<span class="op">/</span><span class="dv">2</span>]<span class="op">/</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>sort_x[<span class="dv">1</span><span class="op">+</span>(n<span class="op">/</span><span class="dv">2</span>)]<span class="op">/</span><span class="dv">2</span></span>
<span id="cb41-3"><a href="#cb41-3"></a>retval &lt;-<span class="st"> </span>sort_x[(n<span class="op">+</span><span class="dv">1</span>)<span class="op">/</span><span class="dv">2</span>]</span></code></pre></div>
</div>
</div>
<div id="for-while-repeat" class="section level2">
<h2 number="4.5"><span class="header-section-number">4.5</span> for, while, repeat</h2>
<p><code>for</code> 문은 반복적으로 특정 코드를 실행하고자 할 때 사용됩니다. 다음과 같은 형식으로 사용할 수 있습니다. <code>var</code>는 반복을 돌 때마다 바뀌는 변수로 <code>{}</code> 안에서 사용되는 지역 변수 입니다. <code>seq</code>는 vector 형식의 변수로 반복을 돌 때마다 순차적으로 <code>var</code>에 저장되는 값들 입니다.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a><span class="cf">for</span>(var <span class="cf">in</span> seq){</span>
<span id="cb42-2"><a href="#cb42-2"></a>  expression</span>
<span id="cb42-3"><a href="#cb42-3"></a>}</span>
<span id="cb42-4"><a href="#cb42-4"></a></span>
<span id="cb42-5"><a href="#cb42-5"></a>x &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span></span>
<span id="cb42-6"><a href="#cb42-6"></a><span class="cf">for</span>(i <span class="cf">in</span> x){</span>
<span id="cb42-7"><a href="#cb42-7"></a>  <span class="kw">cat</span>(i, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb42-8"><a href="#cb42-8"></a>  <span class="kw">flush.console</span>()</span>
<span id="cb42-9"><a href="#cb42-9"></a>}</span>
<span id="cb42-10"><a href="#cb42-10"></a></span>
<span id="cb42-11"><a href="#cb42-11"></a>sum_of_i &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb42-12"><a href="#cb42-12"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>){</span>
<span id="cb42-13"><a href="#cb42-13"></a>  sum_of_i &lt;-<span class="st"> </span>sum_of_i <span class="op">+</span><span class="st"> </span>i</span>
<span id="cb42-14"><a href="#cb42-14"></a>  <span class="kw">cat</span>(i, <span class="st">&quot; &quot;</span>, sum_of_i, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>);<span class="kw">flush.console</span>()</span>
<span id="cb42-15"><a href="#cb42-15"></a>}</span></code></pre></div>
<p><code>while</code>문도 <code>for</code>문과 같이 반복적으로 특정 코드를 수행하고자 할 때 사용합니다. 사용하는 문법은 다음과 같으며 <code>cond</code>는 <code>True</code> 또는 <code>False</code> 로 반환되는 조건문을 넣고 <code>True</code> 일 경우 계속해서 반복하면서 <code>expressions</code>를 수행하며 이 반복은 <code>cond</code>가 <code>False</code>로 될 때 까지 계속됩니다.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a><span class="cf">while</span>(cond){</span>
<span id="cb43-2"><a href="#cb43-2"></a>  expression</span>
<span id="cb43-3"><a href="#cb43-3"></a>}</span></code></pre></div>
<p><code>while</code>문을 사용할 경우 다음과 같이 <code>indicator</code>라 불리우는 변수를 하나 정해서 반복 할 때마다 값이 바뀌도록 해 주어야 합니다. 그렇지 않으면 무한 루프를 돌게 되는 문제가 발생합니다.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a>i &lt;-<span class="st"> </span><span class="dv">10</span></span>
<span id="cb44-2"><a href="#cb44-2"></a>f &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb44-3"><a href="#cb44-3"></a><span class="cf">while</span>(i<span class="op">&gt;</span><span class="dv">1</span>){</span>
<span id="cb44-4"><a href="#cb44-4"></a>  f &lt;-<span class="st"> </span>i<span class="op">*</span>f</span>
<span id="cb44-5"><a href="#cb44-5"></a>  i &lt;-<span class="st"> </span>i<span class="dv">-1</span></span>
<span id="cb44-6"><a href="#cb44-6"></a>  <span class="kw">cat</span>(i, f, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb44-7"><a href="#cb44-7"></a>}</span>
<span id="cb44-8"><a href="#cb44-8"></a>f</span>
<span id="cb44-9"><a href="#cb44-9"></a><span class="kw">factorial</span>(<span class="dv">10</span>)</span></code></pre></div>
<p><code>repeat</code> 명령은 조건 없이 블럭 안에 있는 코드를 무조건 반복하라는 명령 입니다. 따라서 블럭 중간에 멈추기 위한 코드가 필요하고 이 명령이 <code>break</code> 입니다.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a><span class="cf">repeat</span>{</span>
<span id="cb45-2"><a href="#cb45-2"></a>  expressions</span>
<span id="cb45-3"><a href="#cb45-3"></a>  <span class="cf">if</span>(cond) <span class="cf">break</span></span>
<span id="cb45-4"><a href="#cb45-4"></a>}</span>
<span id="cb45-5"><a href="#cb45-5"></a></span>
<span id="cb45-6"><a href="#cb45-6"></a>i &lt;-<span class="st"> </span><span class="dv">10</span></span>
<span id="cb45-7"><a href="#cb45-7"></a>f &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb45-8"><a href="#cb45-8"></a><span class="cf">repeat</span> {</span>
<span id="cb45-9"><a href="#cb45-9"></a>  f &lt;-<span class="st"> </span>i<span class="op">*</span>f</span>
<span id="cb45-10"><a href="#cb45-10"></a>  i &lt;-<span class="st"> </span>i<span class="dv">-1</span></span>
<span id="cb45-11"><a href="#cb45-11"></a>  <span class="kw">cat</span>(i, f, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb45-12"><a href="#cb45-12"></a>  <span class="cf">if</span>(i<span class="op">&lt;</span><span class="dv">1</span>) <span class="cf">break</span></span>
<span id="cb45-13"><a href="#cb45-13"></a>}</span>
<span id="cb45-14"><a href="#cb45-14"></a>f</span>
<span id="cb45-15"><a href="#cb45-15"></a><span class="kw">factorial</span>(<span class="dv">10</span>)</span></code></pre></div>
</div>
<div id="avoiding-loops" class="section level2">
<h2 number="4.6"><span class="header-section-number">4.6</span> Avoiding Loops</h2>
<p>R에서는 가능하면 loop문을 사용하지 않는 것이 좋습니다. 이는 다른 언어들 보다 반복문이 느리게 수행된다는 이유 때문이기도 합니다. 그러나 R에서는 반복문을 수행하는 것 보다 훨씬 더 빠르게 반복문을 수행 한 것과 같은 결과를 얻을 수 있는 다양한 방법들이 제공되고 있습니다. 차차 그런 기법들에 대한 학습을 진행하도록 하겠습니다.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a>x &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="fl">1E7</span></span>
<span id="cb46-2"><a href="#cb46-2"></a><span class="kw">sum</span>(x)</span>
<span id="cb46-3"><a href="#cb46-3"></a><span class="kw">system.time</span>(<span class="kw">sum</span>(x))</span>
<span id="cb46-4"><a href="#cb46-4"></a></span>
<span id="cb46-5"><a href="#cb46-5"></a>st &lt;-<span class="st"> </span><span class="kw">proc.time</span>()</span>
<span id="cb46-6"><a href="#cb46-6"></a>total &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb46-7"><a href="#cb46-7"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(x)){</span>
<span id="cb46-8"><a href="#cb46-8"></a>  total &lt;-<span class="st"> </span>total <span class="op">+</span><span class="st"> </span>x[i]</span>
<span id="cb46-9"><a href="#cb46-9"></a>}</span>
<span id="cb46-10"><a href="#cb46-10"></a>ed &lt;-<span class="st"> </span><span class="kw">proc.time</span>()</span>
<span id="cb46-11"><a href="#cb46-11"></a>ed<span class="op">-</span>st</span></code></pre></div>
</div>
<div id="object-oriented-programming-advanced" class="section level2">
<h2 number="4.7"><span class="header-section-number">4.7</span> Object Oriented Programming (Advanced)</h2>
<p>OOP는 객체지향 프로그래밍 이라고 합니다. OOP를 이용해서 프로그래밍으로 풀고자 하는 문제를 좀 더 명확하게 개념을 수립하고 복잡한 코드를 명료하게 만들 수 있습니다. 그런데 R에서 OOP는 다른 언어보다는 좀 더 어려운 개념적인 이해가 필요합니다. <code>S3</code>, <code>S4</code>, 그리고 <code>Reference class</code> 가 있으며 <code>S3</code>, <code>S4</code>는 <code>Generic function</code>을 이용하며 다른 언어에서 사용하는 OOP 개념과는 다릅니다. <code>Reference class</code>는 다른 언어에서 사용하는 OOP 개념과 유사하며 <code>R6</code> 패키지를 이용해서 사용할 수 있습니다.</p>
</div>
<div id="usuful-functions-ii" class="section level2">
<h2 number="4.8"><span class="header-section-number">4.8</span> Usuful functions II</h2>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a><span class="co">#match(), %in%, intersect()</span></span>
<span id="cb47-2"><a href="#cb47-2"></a></span>
<span id="cb47-3"><a href="#cb47-3"></a>x &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span></span>
<span id="cb47-4"><a href="#cb47-4"></a>y &lt;-<span class="st"> </span><span class="dv">5</span><span class="op">:</span><span class="dv">15</span></span>
<span id="cb47-5"><a href="#cb47-5"></a><span class="kw">match</span>(x, y)</span>
<span id="cb47-6"><a href="#cb47-6"></a>x <span class="op">%in%</span><span class="st"> </span>y</span>
<span id="cb47-7"><a href="#cb47-7"></a><span class="kw">intersect</span>(x, y)</span>
<span id="cb47-8"><a href="#cb47-8"></a></span>
<span id="cb47-9"><a href="#cb47-9"></a><span class="co">#unique()</span></span>
<span id="cb47-10"><a href="#cb47-10"></a><span class="kw">unique</span>(<span class="kw">c</span>(x, y))</span>
<span id="cb47-11"><a href="#cb47-11"></a></span>
<span id="cb47-12"><a href="#cb47-12"></a><span class="co">#substr()</span></span>
<span id="cb47-13"><a href="#cb47-13"></a>x &lt;-<span class="st"> &quot;Factors, raw vectors, and lists, are converted&quot;</span></span>
<span id="cb47-14"><a href="#cb47-14"></a><span class="kw">substr</span>(x, <span class="dv">1</span>, <span class="dv">6</span>)</span>
<span id="cb47-15"><a href="#cb47-15"></a></span>
<span id="cb47-16"><a href="#cb47-16"></a><span class="co">#grep()</span></span>
<span id="cb47-17"><a href="#cb47-17"></a><span class="kw">grep</span>(<span class="st">&quot;raw&quot;</span>, x)</span>
<span id="cb47-18"><a href="#cb47-18"></a></span>
<span id="cb47-19"><a href="#cb47-19"></a><span class="co">#grepl()</span></span>
<span id="cb47-20"><a href="#cb47-20"></a><span class="kw">grepl</span>(<span class="st">&quot;raw&quot;</span>, x)</span>
<span id="cb47-21"><a href="#cb47-21"></a><span class="cf">if</span>(<span class="kw">grepl</span>(<span class="st">&quot;raw&quot;</span>, x)){</span>
<span id="cb47-22"><a href="#cb47-22"></a>  <span class="kw">cat</span>(<span class="st">&quot;I found raw!&quot;</span>)</span>
<span id="cb47-23"><a href="#cb47-23"></a>}</span>
<span id="cb47-24"><a href="#cb47-24"></a></span>
<span id="cb47-25"><a href="#cb47-25"></a>x &lt;-<span class="st"> </span><span class="kw">paste</span>(LETTERS, <span class="dv">1</span><span class="op">:</span><span class="dv">100</span>, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb47-26"><a href="#cb47-26"></a><span class="kw">grep</span>(<span class="st">&quot;A&quot;</span>, x)</span>
<span id="cb47-27"><a href="#cb47-27"></a>x[<span class="kw">grep</span>(<span class="st">&quot;A&quot;</span>, x)]</span>
<span id="cb47-28"><a href="#cb47-28"></a></span>
<span id="cb47-29"><a href="#cb47-29"></a><span class="kw">grepl</span>(<span class="st">&quot;A&quot;</span>, x)</span>
<span id="cb47-30"><a href="#cb47-30"></a>r &lt;-<span class="st"> </span><span class="kw">grepl</span>(<span class="st">&quot;A&quot;</span>, x)</span>
<span id="cb47-31"><a href="#cb47-31"></a><span class="cf">if</span>(r){</span>
<span id="cb47-32"><a href="#cb47-32"></a>  <span class="kw">cat</span>(<span class="st">&quot;Yes, I found A&quot;</span>)</span>
<span id="cb47-33"><a href="#cb47-33"></a>}<span class="cf">else</span>{</span>
<span id="cb47-34"><a href="#cb47-34"></a>  <span class="kw">cat</span>(<span class="st">&quot;No A&quot;</span>)</span>
<span id="cb47-35"><a href="#cb47-35"></a>}</span>
<span id="cb47-36"><a href="#cb47-36"></a></span>
<span id="cb47-37"><a href="#cb47-37"></a><span class="co">#strsplit()</span></span>
<span id="cb47-38"><a href="#cb47-38"></a>x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Factors, raw vectors, and lists, are converted&quot;</span>, <span class="st">&quot;vectors, or for, strings with&quot;</span>)</span>
<span id="cb47-39"><a href="#cb47-39"></a>y &lt;-<span class="st"> </span><span class="kw">strsplit</span>(x, <span class="dt">split=</span><span class="st">&quot;, &quot;</span>)</span>
<span id="cb47-40"><a href="#cb47-40"></a></span>
<span id="cb47-41"><a href="#cb47-41"></a><span class="co">#unlist()</span></span>
<span id="cb47-42"><a href="#cb47-42"></a><span class="kw">unlist</span>(y)</span>
<span id="cb47-43"><a href="#cb47-43"></a></span>
<span id="cb47-44"><a href="#cb47-44"></a>y &lt;-<span class="st"> </span><span class="kw">strsplit</span>(x, <span class="dt">split=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb47-45"><a href="#cb47-45"></a>ychar &lt;-<span class="st"> </span><span class="kw">unlist</span>(y)</span>
<span id="cb47-46"><a href="#cb47-46"></a>ycount &lt;-<span class="st"> </span><span class="kw">table</span>(y2)</span>
<span id="cb47-47"><a href="#cb47-47"></a>ycount_sort &lt;-<span class="st"> </span><span class="kw">sort</span>(ycount)</span>
<span id="cb47-48"><a href="#cb47-48"></a>ycount_sort &lt;-<span class="st"> </span><span class="kw">sort</span>(ycount, <span class="dt">decreasing =</span> T)</span>
<span id="cb47-49"><a href="#cb47-49"></a>ycount_top &lt;-<span class="st"> </span>ycount_sort[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</span>
<span id="cb47-50"><a href="#cb47-50"></a>ycount_top_char &lt;-<span class="st"> </span><span class="kw">names</span>(ycount_top)</span>
<span id="cb47-51"><a href="#cb47-51"></a></span>
<span id="cb47-52"><a href="#cb47-52"></a><span class="co">#toupper(), tolower()</span></span>
<span id="cb47-53"><a href="#cb47-53"></a><span class="kw">toupper</span>(ycount_top_char)</span></code></pre></div>
<div id="exercise-4-5" class="section level3">
<h3 number="4.8.1"><span class="header-section-number">4.8.1</span> Exercise 4-5</h3>
<p>built-in 데이터셋 중 <code>state.abb</code> 은 미국의 50개 주에대한 축약어임.</p>
<ol style="list-style-type: decimal">
<li><p>이 중 문자 A 가 들어가는 주를 뽑아 x에 저장 하시오 (<code>grep</code> 또는 <code>grepl</code> 사용)</p></li>
<li><p>state.abb 중 위 x에 저장된 이름들을 빼고 y에 저장 하시오 (<code>match()</code> 또는 <code>%in%</code>사용)</p></li>
<li><p>state.abb에 사용된 알파벳의 갯수를 구하고 가장 많이 쓰인 알파벳을 구하시오 (<code>strsplit()</code>, <code>table()</code> 등 사용)</p></li>
</ol>
</div>
</div>
<div id="file-read-and-write" class="section level2">
<h2 number="4.9"><span class="header-section-number">4.9</span> File read and write</h2>
<p>텍스트 파일의 경우 아래와 같이 csv 또는 txt 파일로 저장하여 메모장으로 열어 확인할 수 있으며 읽어올 경우 구분자 (sep 파라메터) 나 header를 (header 파라메터) 읽을지 읽지 않을지 등을 옵션으로 지정할 수 있습니다.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a>x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>)</span>
<span id="cb48-2"><a href="#cb48-2"></a>y &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>)</span>
<span id="cb48-3"><a href="#cb48-3"></a>xy&lt;-<span class="kw">data.frame</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>y)</span>
<span id="cb48-4"><a href="#cb48-4"></a></span>
<span id="cb48-5"><a href="#cb48-5"></a><span class="kw">write.table</span>(xy, <span class="dt">file=</span><span class="st">&quot;table_write.txt&quot;</span>)</span>
<span id="cb48-6"><a href="#cb48-6"></a><span class="kw">write.table</span>(xy, <span class="dt">file=</span><span class="st">&quot;table_write.txt&quot;</span>, <span class="dt">quote=</span>F)</span>
<span id="cb48-7"><a href="#cb48-7"></a><span class="kw">write.table</span>(xy, <span class="dt">file=</span><span class="st">&quot;table_write.txt&quot;</span>, <span class="dt">quote=</span>F, <span class="dt">row.names=</span>F)</span>
<span id="cb48-8"><a href="#cb48-8"></a><span class="kw">write.table</span>(xy, <span class="dt">file=</span><span class="st">&quot;table_write.txt&quot;</span>, <span class="dt">quote=</span>F, <span class="dt">row.names=</span>F, <span class="dt">sep=</span><span class="st">&quot;,&quot;</span>)</span>
<span id="cb48-9"><a href="#cb48-9"></a><span class="kw">write.table</span>(xy, <span class="dt">file=</span><span class="st">&quot;table_write.csv&quot;</span>, <span class="dt">quote=</span>F, <span class="dt">row.names=</span>F, <span class="dt">sep=</span><span class="st">&quot;,&quot;</span>)</span>
<span id="cb48-10"><a href="#cb48-10"></a></span>
<span id="cb48-11"><a href="#cb48-11"></a>mydata&lt;-<span class="kw">read.table</span>(<span class="dt">file=</span><span class="st">&quot;table_write.csv&quot;</span>)</span>
<span id="cb48-12"><a href="#cb48-12"></a>mydata&lt;-<span class="kw">read.table</span>(<span class="dt">file=</span><span class="st">&quot;table_write.csv&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;,&quot;</span>)</span>
<span id="cb48-13"><a href="#cb48-13"></a>mydata&lt;-<span class="kw">read.table</span>(<span class="dt">file=</span><span class="st">&quot;table_write.csv&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;,&quot;</span>, <span class="dt">header=</span>T)</span>
<span id="cb48-14"><a href="#cb48-14"></a><span class="kw">plot</span>(mydata<span class="op">$</span>x, mydata<span class="op">$</span>z)</span></code></pre></div>
<div id="exercise-4-6" class="section level3">
<h3 number="4.9.1"><span class="header-section-number">4.9.1</span> Exercise 4-6</h3>
<p><code>iris</code> 데이터셋을 <code>iris.csv</code>에 <code>,</code>를 구분 기호로 저장하고 myiris 라는 변수로 다시 읽어 들이시오</p>
</div>
</div>
<div id="excel-file-read-and-data-plotting" class="section level2">
<h2 number="4.10"><span class="header-section-number">4.10</span> Excel file read and data plotting</h2>
<p>엑셀파일은 readxl 이라는 R 패키지를 활용하여 읽거나 쓸 수 있습니다.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a><span class="kw">install.packages</span>(<span class="st">&quot;readxl&quot;</span>)</span></code></pre></div>
<p>실습 파일은 형광 세포를 배양하여 형광리더기를 이용해 얻어진 실제 데이터이며 <a href="https://github.com/greendaygh/Rprog2020/blob/master/Exp_data.xls">Exp_data.xls</a> 에서 다운로드 받을 수 있습니다. read_excel 함수를 이용하여 파일의 내용을 읽어오면 기본 자료형이 tibble 입니다. tibble은 최근 많이 쓰이는 R object로 data.frame과 유사하나 입력값의 type, name, rowname을 임으로 바꿀 수 없다는 점이 다릅니다.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a><span class="kw">library</span>(readxl)</span>
<span id="cb50-2"><a href="#cb50-2"></a>mydata &lt;-<span class="st"> </span><span class="kw">read_excel</span>(<span class="st">&quot;Exp_data.xls&quot;</span>, <span class="dt">sheet=</span><span class="dv">1</span>, <span class="dt">skip =</span> <span class="dv">0</span>, <span class="dt">col_names=</span>T)</span></code></pre></div>
<p>엑셀파일에는 두 종류의 (OD600nm, fluorescence) 데이터가 저장되어 있습니다. 첫 번째 sheet에는 다음처럼 wide형 데이터가 저장되어 있습니다 (참고로 wide형 데이터는 일반적인 <code>data.frame</code> 형태의 데이터로 column은 변수, row는 샘플이 저장된 형태로 새로운 변수가 추가 되면 column 오른쪽에 붙어 wide하게 확장되는 것을 말합니다. long 형 데이터는 추후 강의에서 설명 드리겠습니다).</p>
<p><img src="images/04/excelfile01.PNG" /></p>
<p><code>str</code> 함수를 이용해서 데이터의 구조를 보면 8개의 변수가 있고 각 변수의 이름과 값의 타입 (mode of storage type) 그리고 실제 데이터들의 일부를 보여 줍니다. 이제 관심있는 변수만 뽑아서 가공을 해보겠습니다. 관심있는 변수는 594nm 으로 시작하는 OD 데이터와 EGFP로 시작하는 형광 데이터 그리고 well plate의 위치에 대한 label이 되겠습니다.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a><span class="kw">str</span>(mydata)</span>
<span id="cb51-2"><a href="#cb51-2"></a>mydf &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">well=</span>mydata<span class="op">$</span>Well, <span class="dt">od=</span>mydata<span class="op">$</span><span class="st">`</span><span class="dt">595nm_kk (A)</span><span class="st">`</span>, <span class="dt">gfp=</span>mydata<span class="op">$</span><span class="st">`</span><span class="dt">EGFP_sulim (Counts)</span><span class="st">`</span>)</span>
<span id="cb51-3"><a href="#cb51-3"></a><span class="kw">head</span>(mydf)</span></code></pre></div>
<p>아래 그림은 96 well plate의 각 well 마다 해당되는 위치와 label 값을 보여줍니다. 간단히 데이터를 설명하면 각 컬럼은 다른 종류의 cell 이고 row에 특정 화학물질의 농도별 측정 값을 나타냅니다. (1, 2), (3, 4), (5, 6), (7, 8), (9, 10), (11, 12) 각 pair는 같은 세포이고 반복 측정을 나타냅니다. 즉, 1과 2는 같은 종류의 세포이지만 반복을 2회 수행 한 것 입니다.</p>
<p><img src="images/04/excelfile02.PNG" /></p>
<p>보통 데이터가 주어져 있을 때 가장 먼저 하는 일은 눈으로 직접 데이터 값을 보는 것 입니다. excel 파일을 열었을 경우 위 그림과 같은 형태의 값을 보고 대략적으로 세포별로 농도별로 값이 다르게 측정된 것을 확인합니다. 데이터 분석에서 그 다음 하는 일은 그래프 등을 통해서 raw데이터의 요약된 정보를 한 눈에 확인하는 작업 입니다. 이 후 데이터를 가공하거나 분석을 통해서 원하는 정보를 뽑아냅니다. 지금은 간단히 raw 데이터를 눈으로 확인하는 작업을 해 보겠습니다. 위 그림의 데이터를 그래프로 그릴 경우 가장 쉽게 생각할 수 있는 그림은 세포별 농도를 막대그래프로 그려보는 것 입니다.</p>
<p>가장 쉽게 1번 세포의 첫 번째 반복에 대해서 농도 B부터 G까지를 그리기 위해 해당하는 값을 뽑아서 데이터 세트를 만들어 봅니다. 먼저 well 이름을 이용해서 해당 값을 추출합니다.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1"></a>mydf<span class="op">$</span>well</span>
<span id="cb52-2"><a href="#cb52-2"></a><span class="kw">class</span>(mydf<span class="op">$</span>well)</span>
<span id="cb52-3"><a href="#cb52-3"></a>well_labels &lt;-<span class="st"> </span><span class="kw">as.character</span>(mydf<span class="op">$</span>well)</span>
<span id="cb52-4"><a href="#cb52-4"></a><span class="kw">strsplit</span>(well_labels, <span class="dt">split=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb52-5"><a href="#cb52-5"></a>well_concentration &lt;-<span class="st"> </span><span class="kw">substr</span>(well_labels, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb52-6"><a href="#cb52-6"></a>cell_number &lt;-<span class="st"> </span><span class="kw">substr</span>(well_labels, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb52-7"><a href="#cb52-7"></a>mydf2 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(well_concentration, cell_number, mydf<span class="op">$</span>od, mydf<span class="op">$</span>gfp)</span>
<span id="cb52-8"><a href="#cb52-8"></a><span class="kw">str</span>(mydf2)</span>
<span id="cb52-9"><a href="#cb52-9"></a>mydf2 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(well_concentration, cell_number, mydf<span class="op">$</span>od, mydf<span class="op">$</span>gfp, <span class="dt">stringsAsFactors =</span> F)</span>
<span id="cb52-10"><a href="#cb52-10"></a><span class="kw">str</span>(mydf2)</span>
<span id="cb52-11"><a href="#cb52-11"></a></span>
<span id="cb52-12"><a href="#cb52-12"></a>mydf2<span class="op">$</span>cell_number<span class="op">==</span><span class="st">&quot;01&quot;</span></span>
<span id="cb52-13"><a href="#cb52-13"></a>idx &lt;-<span class="st"> </span>mydf2<span class="op">$</span>cell_number<span class="op">==</span><span class="st">&quot;01&quot;</span></span>
<span id="cb52-14"><a href="#cb52-14"></a>mydf2_<span class="dv">01</span> &lt;-<span class="st"> </span>mydf2[idx,]</span>
<span id="cb52-15"><a href="#cb52-15"></a>mydf2_<span class="dv">01</span><span class="op">$</span>mydf.gfp</span>
<span id="cb52-16"><a href="#cb52-16"></a></span>
<span id="cb52-17"><a href="#cb52-17"></a><span class="kw">plot</span>(mydf2_<span class="dv">01</span><span class="op">$</span>mydf.gfp)</span>
<span id="cb52-18"><a href="#cb52-18"></a><span class="kw">barplot</span>(mydf2_<span class="dv">01</span><span class="op">$</span>mydf.gfp)</span>
<span id="cb52-19"><a href="#cb52-19"></a><span class="kw">barplot</span>(mydf2_<span class="dv">01</span><span class="op">$</span>mydf.gfp, <span class="dt">names.arg =</span> mydf2_<span class="dv">01</span><span class="op">$</span>well_concentration)</span></code></pre></div>
<p>그런데 위 데이터는 반복이 있는 데이터 입니다. 즉 반복 측정 값의 평균과 표준편차를 구해서 에러바와 같이 그려 주는 것이 보통 입니다. 1, 2 샘플에 대해서 농도별 평균과 표준편차를 구해봅니다. <code>mydf2</code>에서 1, 2 샘플만을 뽑고 작업을 시작 합니다.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a>seli1 &lt;-<span class="st"> </span><span class="kw">which</span>(mydf2<span class="op">$</span>cell_number<span class="op">==</span><span class="st">&quot;01&quot;</span>)</span>
<span id="cb53-2"><a href="#cb53-2"></a>sample1 &lt;-<span class="st"> </span>mydf2[seli1,]</span>
<span id="cb53-3"><a href="#cb53-3"></a>seli2 &lt;-<span class="st"> </span><span class="kw">which</span>(mydf2<span class="op">$</span>cell_number<span class="op">==</span><span class="st">&quot;02&quot;</span>)</span>
<span id="cb53-4"><a href="#cb53-4"></a>sample2 &lt;-<span class="st"> </span>mydf2[seli2,]</span>
<span id="cb53-5"><a href="#cb53-5"></a></span>
<span id="cb53-6"><a href="#cb53-6"></a>sample_means &lt;-<span class="st"> </span>(sample1<span class="op">$</span>mydf.gfp <span class="op">+</span><span class="st"> </span>sample2<span class="op">$</span>mydf.gfp)<span class="op">/</span><span class="dv">2</span></span>
<span id="cb53-7"><a href="#cb53-7"></a>sample_std &lt;-<span class="st"> </span><span class="kw">sqrt</span>(((sample1<span class="op">$</span>mydf.gfp<span class="op">-</span>sample_means)<span class="op">^</span><span class="dv">2</span><span class="op">+</span>(sample2<span class="op">$</span>mydf.gfp<span class="op">-</span>sample_means)<span class="op">^</span><span class="dv">2</span>)<span class="op">/</span>(<span class="dv">2-1</span>))</span>
<span id="cb53-8"><a href="#cb53-8"></a><span class="kw">sd</span>(<span class="kw">c</span>(sample1<span class="op">$</span>mydf.gfp[<span class="dv">1</span>], sample2<span class="op">$</span>mydf.gfp[<span class="dv">1</span>]))</span>
<span id="cb53-9"><a href="#cb53-9"></a>sample1df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">conc=</span>sample1<span class="op">$</span>well_concentration, sample_means, sample_std)</span>
<span id="cb53-10"><a href="#cb53-10"></a>sample1df</span></code></pre></div>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1"></a><span class="kw">barplot</span>(sample1df<span class="op">$</span>sample_means, <span class="dt">names.arg=</span>sample1df<span class="op">$</span>conc, <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">80000</span>))</span>
<span id="cb54-2"><a href="#cb54-2"></a><span class="kw">arrows</span>(<span class="fl">0.7</span>, sample_means[<span class="dv">1</span>], <span class="fl">0.7</span>, sample_means[<span class="dv">1</span>]<span class="op">+</span>sample_std[<span class="dv">1</span>], <span class="dt">length=</span><span class="fl">0.1</span>, <span class="dt">angle=</span><span class="dv">90</span>)</span>
<span id="cb54-3"><a href="#cb54-3"></a><span class="kw">arrows</span>(<span class="fl">0.7</span>, sample_means[<span class="dv">1</span>], <span class="fl">0.7</span>, sample_means[<span class="dv">1</span>]<span class="op">-</span>sample_std[<span class="dv">1</span>], <span class="dt">length=</span><span class="fl">0.1</span>, <span class="dt">angle=</span><span class="dv">90</span>)</span>
<span id="cb54-4"><a href="#cb54-4"></a>lab &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;SD:&quot;</span>, <span class="kw">round</span>(sample_means[<span class="dv">1</span>]<span class="op">+</span>sample_std[<span class="dv">1</span>],<span class="dv">1</span>))</span>
<span id="cb54-5"><a href="#cb54-5"></a><span class="kw">text</span>(<span class="fl">0.5</span>, sample_means[<span class="dv">1</span>]<span class="op">+</span>sample_std[<span class="dv">1</span>]<span class="op">*</span><span class="dv">2</span>, <span class="dt">labels =</span> lab)</span></code></pre></div>
<div id="exercise-4-7-barplot-with-error-bars" class="section level3">
<h3 number="4.10.1"><span class="header-section-number">4.10.1</span> Exercise 4-7 barplot with error bars</h3>
<p>앞서 그려본 막대그래프의 B, C, D, E, F, G 모두에 에러바를 넣으시오 (for 문 사용)</p>
<hr />
<p>지금까지는 첫 번째 컬럼과 두 번째 컬럼의 데이터만을 읽어와서 그래프를 그려 보았습니다. 그러나 위 코드와 같은 방식으로 모든 데이터를 읽어오는 것은 비효율적입니다. 다음 강좌에서는 이러한 데이터를 좀 더 효율적으로 가공하는 방법과 R에서 제공하는 기본 그래프 함수에 대한 내용을 소개하도록 하겠습니다.</p>
<hr />
<p><a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="크리에이티브 커먼즈 라이선스" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/88x31.png" /></a><br />이 저작물은 <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/">크리에이티브 커먼즈 저작자표시-비영리-변경금지 4.0 국제 라이선스</a>에 따라 이용할 수 있습니다.</p>
<!--chapter:end:04-Rprogbasics.Rmd-->
</div>
</div>
</div>
<div id="r-graphics-basics" class="section level1">
<h1 number="5"><span class="header-section-number">5</span> R graphics basics</h1>
<p>이번 시간에는 R에서 제공하는 기본 그래프 함수들을 간략하게 알아보고 지난 강의에서 간략하게 실습했던 multiple plate reader (<span class="math inline">\(Victor^{TM}\)</span>, PerkinElmer, Inc.) 장비를 통해 측정된 데이터를 읽어와서 분석하기 위한 함수를 작성해 보겠습니다.</p>
<div id="scatter-plot" class="section level2">
<h2 number="5.1"><span class="header-section-number">5.1</span> scatter plot</h2>
<p>R에서 plot 함수는 가장 기본이 되는 그래프 함수 입니다. 아래는 산포도를 그려주는 코드로서 myxy가 두 개의 변수(x1과 y1)를 가지고 있으므로 아래 명령들은 모두 같은 그림을 그려주게 됩니다. 가장 마지막 명령은 <code>formula</code>를 사용한 plot으로 첫번째 파라메터 인자로 <code>formula</code> 타입이 전달되면 plot.formula 함수가 실행되며 x, y 값이 전달될 경우 <code>plot.default</code> 함수가 수행됩니다. R에서는 이렇게 전달되는 파라메터의 타입에 따라서 다른 기능을 하는 함수를 <code>Generic function</code> 이라고 합니다. 만약 기존 그림에 추가 데이터의 산포를 그리고 싶은 경우 <code>points</code>라는 함수를 사용합니다.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1"></a>x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>)</span>
<span id="cb55-2"><a href="#cb55-2"></a>y &lt;-<span class="st"> </span>x<span class="op">*</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">100</span>)</span>
<span id="cb55-3"><a href="#cb55-3"></a>myxy &lt;-<span class="st"> </span><span class="kw">data.frame</span>(x,y)</span>
<span id="cb55-4"><a href="#cb55-4"></a><span class="kw">plot</span>(myxy)</span>
<span id="cb55-5"><a href="#cb55-5"></a><span class="kw">plot</span>(myxy<span class="op">$</span>x, myxy<span class="op">$</span>y)</span>
<span id="cb55-6"><a href="#cb55-6"></a><span class="kw">plot</span>(<span class="dt">x=</span>myxy<span class="op">$</span>x, <span class="dt">y=</span>myxy<span class="op">$</span>y)</span>
<span id="cb55-7"><a href="#cb55-7"></a><span class="kw">plot</span>(y<span class="op">~</span>x, <span class="dt">data=</span>myxy)</span>
<span id="cb55-8"><a href="#cb55-8"></a></span>
<span id="cb55-9"><a href="#cb55-9"></a>z &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>, <span class="dv">100</span>, <span class="dt">replace =</span>T)</span>
<span id="cb55-10"><a href="#cb55-10"></a><span class="kw">points</span>(x, z)</span>
<span id="cb55-11"><a href="#cb55-11"></a><span class="kw">points</span>(x, z, <span class="dt">col=</span><span class="st">&quot;red&quot;</span>)</span></code></pre></div>
</div>
<div id="histogram" class="section level2">
<h2 number="5.2"><span class="header-section-number">5.2</span> histogram</h2>
<p><code>hist</code> 함수는 데이터들의 분포를 히스토그램으로 그려주는 함수입니다. 히스토그램은 데이터들이 갖는 값을 특정 구간으로 나누고 각 구간에 해당하는 데이터가 몇 개인지 빈도수를 계산하여 막대그래프로 보여줍니다.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1"></a>x &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">100</span>)</span>
<span id="cb56-2"><a href="#cb56-2"></a><span class="kw">hist</span>(x, <span class="dt">br=</span><span class="dv">20</span>, <span class="dt">xlim=</span><span class="kw">c</span>(<span class="op">-</span><span class="dv">3</span>,<span class="dv">3</span>), <span class="dt">main=</span><span class="st">&quot;Main text&quot;</span>, <span class="dt">xlab=</span><span class="st">&quot;X label&quot;</span>)</span></code></pre></div>
</div>
<div id="boxplot" class="section level2">
<h2 number="5.3"><span class="header-section-number">5.3</span> boxplot</h2>
<p>boxplot은 데이터의 여러가지 대표값 (중간값 median, 첫번째 사분위수 1st quantile, 세번째 사분위수 3rd quantile, 최소 minimum, 최대값 maximum) 등을 한눈에 볼 수 있도록 만들어놓은 그래프 입니다.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1"></a>x &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">100</span>)</span>
<span id="cb57-2"><a href="#cb57-2"></a><span class="kw">boxplot</span>(x)</span></code></pre></div>
<p>data.frame 타입의 오브젝트에 대해서 boxplot을 그릴 경우 여러 변수의 데이터들의 분포를 한눈에 비교할 수 있읍니다.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1"></a>y &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">100</span>, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb58-2"><a href="#cb58-2"></a><span class="co">#boxplot(y)</span></span>
<span id="cb58-3"><a href="#cb58-3"></a>xy &lt;-<span class="st"> </span><span class="kw">data.frame</span>(x, y)</span>
<span id="cb58-4"><a href="#cb58-4"></a><span class="kw">boxplot</span>(xy)</span>
<span id="cb58-5"><a href="#cb58-5"></a><span class="kw">class</span>(xy)</span></code></pre></div>
</div>
<div id="barplot" class="section level2">
<h2 number="5.4"><span class="header-section-number">5.4</span> barplot</h2>
<p>막대그래프는 기존 수업에서도 실습을 진행한 그래프로 각 값들을 막대 형태로 나란히 배치하여 서로 비교가 용이하도록 만든 그래프 입니다. <code>table</code> 함수는 같은 값을 갖는 데이터들이 몇 개나 있는지 테이블을 만들어주는 함수 입니다. rbind는 두 변수를 row를 기준으로 붙여주는 역할의 함수입니다.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1"></a>x &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">12</span>, <span class="dv">200</span>, <span class="dt">replace =</span> T)</span>
<span id="cb59-2"><a href="#cb59-2"></a>tab_x &lt;-<span class="st"> </span><span class="kw">table</span>(x)</span>
<span id="cb59-3"><a href="#cb59-3"></a>y &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">12</span>, <span class="dv">200</span>, <span class="dt">replace =</span> T)</span>
<span id="cb59-4"><a href="#cb59-4"></a>tab_y &lt;-<span class="st"> </span><span class="kw">table</span>(y)</span>
<span id="cb59-5"><a href="#cb59-5"></a>tab_xy &lt;-<span class="st"> </span><span class="kw">rbind</span>(tab_x, tab_y)</span>
<span id="cb59-6"><a href="#cb59-6"></a><span class="co">#barplot(tab_xy)</span></span>
<span id="cb59-7"><a href="#cb59-7"></a><span class="co">#barplot(tab_xy, beside = T)</span></span>
<span id="cb59-8"><a href="#cb59-8"></a><span class="co">#barplot(tab_xy, beside = T, col=c(&quot;darkblue&quot;,&quot;red&quot;))</span></span>
<span id="cb59-9"><a href="#cb59-9"></a><span class="kw">barplot</span>(tab_xy, <span class="dt">beside =</span> T, <span class="dt">col=</span><span class="kw">c</span>(<span class="st">&quot;darkblue&quot;</span>,<span class="st">&quot;red&quot;</span>), <span class="dt">xlab=</span><span class="st">&quot;Month&quot;</span>)</span>
<span id="cb59-10"><a href="#cb59-10"></a><span class="kw">barplot</span>(tab_xy, <span class="dt">beside =</span> T, <span class="dt">col=</span><span class="kw">c</span>(<span class="st">&quot;darkblue&quot;</span>,<span class="st">&quot;red&quot;</span>), <span class="dt">xlab=</span><span class="st">&quot;Month&quot;</span>, <span class="dt">horiz=</span><span class="ot">TRUE</span>)</span></code></pre></div>
<div id="exercise-5-1" class="section level3">
<h3 number="5.4.1"><span class="header-section-number">5.4.1</span> Exercise 5-1</h3>
<ol style="list-style-type: decimal">
<li><code>iris</code> 데이터의 꽃받침 (Sepal) 길이와 넓이를 각각 x와 y축으로 하는 산포도를 그리시오</li>
<li><code>iris</code> 데이터에서 setosa 품종의 꽃받침의 길이와 넓이 데이터만 빨간 점으로 나타내시오</li>
<li><code>iris</code> 데이터에서 꽃받침과 꽃잎의 길이의 분포를 그리시오 (<code>hist</code> 사용)</li>
<li><code>iris</code> 데이터에서 꽃받침과 꽃잎의 넓이의 분포를 그리시오 (<code>boxplot</code> 사용)</li>
<li><code>iris</code> 데이터에서 품종별 꽃받침 길이의 분포를 그리시오 (<code>boxplot</code> 사용)</li>
</ol>
</div>
</div>
<div id="draw-multiple-graphs-in-the-same-plot" class="section level2">
<h2 number="5.5"><span class="header-section-number">5.5</span> Draw multiple graphs in the same plot</h2>
<p>위 예제들에서 사용한 high level function들을 low level function (<code>lines</code>, <code>points</code>, <code>ablines</code>, <code>axis</code> 등)들과 함께 사용함으로써 원하는 도표 대부분을 그려낼 수 있습니다. 최근 널리 사용되는 <code>ggplot2</code> 패키지를 이용한 그래프 사용법 강의에서는 오늘 배우는 그래픽 명령어는 거의 사용하지 않습니다. 그러나 위 함수들은 R의 기본 그래프 함수들로서 단순한 도표에서부터 복잡한 그래픽까지 구현할 수 있는 다양한 유연성을 제공하므로 기본적인 사용법을 정확히 이해하는 것이 좋습니다.</p>
<p>아래 도표는 평균 0, 분산 1인 분포에서 500개의 랜덤한 수를 뽑아 x에 저장하고 x의 분포를 히스토그램으로 표현한 것 입니다. 그리고 x 값들과 상관성이 있는 y값들을 (x에 2를 곱하고 평균 5, 분산 1인 랜덤하게 뽑힌 수를 노이즈로 더함) 생성하고 모든 1000개 값들의 분포를 그린 히스토그램 입니다.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1"></a>x &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">500</span>)</span>
<span id="cb60-2"><a href="#cb60-2"></a><span class="kw">hist</span>(x, <span class="dv">100</span>)</span>
<span id="cb60-3"><a href="#cb60-3"></a>y &lt;-<span class="st"> </span><span class="dv">2</span><span class="op">*</span>x <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">500</span>, <span class="dt">mean=</span><span class="dv">5</span>, <span class="dt">sd=</span><span class="dv">1</span>)</span>
<span id="cb60-4"><a href="#cb60-4"></a>z &lt;-<span class="st"> </span><span class="kw">c</span>(x,y)</span>
<span id="cb60-5"><a href="#cb60-5"></a><span class="kw">hist</span>(z, <span class="dt">br=</span><span class="dv">100</span>)</span></code></pre></div>
<p>이제 위 histogram 그래프에 <code>density</code> 함수와 <code>lines</code> 함수를 조합하여 확률밀도함수 커브를 그려 넣을 수 있습니다. 이 때 <code>hist</code> 함수에 <code>probability=T</code> 옵션을 넣어 y축의 스케일을 확률밀도함수의 y 스케일과 맞춰주어 같은 화면에 그려지도록 했습니다.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1"></a><span class="kw">hist</span>(z, <span class="dt">br=</span><span class="dv">100</span>)</span>
<span id="cb61-2"><a href="#cb61-2"></a><span class="kw">hist</span>(z, <span class="dt">br=</span><span class="dv">100</span>, <span class="dt">probability =</span> T)</span>
<span id="cb61-3"><a href="#cb61-3"></a>zd &lt;-<span class="st"> </span><span class="kw">density</span>(z)</span>
<span id="cb61-4"><a href="#cb61-4"></a><span class="kw">lines</span>(zd)</span></code></pre></div>
<p>또한 아래 그래프는 위에서 생성한 x, y 값의 산포도를 그리고 x축과 y축 범위를 xlim, ylim 파라메터로 조절하는 예제 입니다. ?pch 도움말을 참고하여 다양한 포인트 모양을 선택할 수 있으며 x 값이 0 보다 작은 경우의 index를 뽑아 해당되는 x 값들과 그 값들의 짝이 되는 y값들에 대해서만 다시 포인트 그림을 red 색상으로 그려 넣었습니다. lm 은 linear model의 약자로 회귀 곡선을 구할 때 사용하는 함수이며 이 함수를 abline과 조합하여 회귀 직선을 그릴 수 있습니다.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1"></a><span class="kw">plot</span>(x,y, <span class="dt">xlim=</span><span class="kw">c</span>(<span class="op">-</span><span class="dv">5</span>, <span class="dv">5</span>), <span class="dt">ylim=</span><span class="kw">c</span>(<span class="op">-</span><span class="dv">5</span>, <span class="dv">15</span>), <span class="dt">pch=</span><span class="dv">3</span>)</span>
<span id="cb62-2"><a href="#cb62-2"></a>idx &lt;-<span class="st"> </span><span class="kw">which</span>(x<span class="op">&lt;</span><span class="dv">0</span>)</span>
<span id="cb62-3"><a href="#cb62-3"></a><span class="kw">points</span>(x[idx], y[idx], <span class="dt">col=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb62-4"><a href="#cb62-4"></a>fit &lt;-<span class="st"> </span><span class="kw">lm</span>(y<span class="op">~</span>x)</span>
<span id="cb62-5"><a href="#cb62-5"></a><span class="kw">abline</span>(fit)</span></code></pre></div>
<div id="exercise-5-2" class="section level3">
<h3 number="5.5.1"><span class="header-section-number">5.5.1</span> Exercise 5-2</h3>
<p><img src="images/05/01.png" /></p>
<ul>
<li>1부터 100까지 수 를 랜덤하게 1000개 생성해서 x좌표를 생성하고 xcoord에 저장 하시오 (중복허용)</li>
<li>1부터 100까지 수 를 랜덤하게 1000개 생성해서 y좌표를 생성하고 ycoord에 저장 하시오 (중복허용)</li>
<li>x, y 좌표 평면에 xcoord와 ycoord 값을 이용하여 좌표를 (산포도) 그리되 x와 y의 범위가 모두 -10부터 110까지 되도록 지정 하시오 (plot 이용)</li>
<li>앞서 문제와 같은 plot에 x가 50보다 크고 y가 50보다 큰 곳에 있는 좌표들에 red closed circle로 표현하시오 (which, points, pch parameter 등 이용, 아래 참고)</li>
</ul>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1"></a>idx &lt;-<span class="st"> </span><span class="kw">which</span>(xcoord<span class="op">&gt;</span><span class="dv">50</span> <span class="op">&amp;</span><span class="st"> </span>ycoord<span class="op">&gt;</span><span class="dv">50</span>)</span>
<span id="cb63-2"><a href="#cb63-2"></a><span class="kw">points</span>(<span class="dt">x=</span>xcoord[idx], <span class="dt">y=</span>ycoord[idx], <span class="dt">col=</span><span class="st">&quot;red&quot;</span>, <span class="dt">pch=</span><span class="dv">19</span>)</span></code></pre></div>
<ul>
<li>앞서 문제와 같은 plot에 x가 50보다 작고 y가 50보다 큰 곳에 있는 좌표들에 blue closed circle로 표현하시오 (which, points, pch parameter 등 이용)</li>
<li>앞서 문제와 같은 plot에 원점으로부터 거리가 50 이하인 좌표들을 green closed circle로 표현 하시오</li>
</ul>
</div>
</div>
<div id="barplot-for-multiplate-reader-data" class="section level2">
<h2 number="5.6"><span class="header-section-number">5.6</span> Barplot for multiplate reader data</h2>
<p>이번에는 지난 4장에서 사용했던 엑셀 파일의 <a href="https://github.com/greendaygh/Rprog2020/blob/master/Exp_data.xls">Exp_data.xls</a> 데이터를 읽어 들여서 barplot을 그리는 또 다른 방법을 알아보겠습니다. 데이터 설명은 지난 4.10절을 참고하시면 되겠습니다. 우선 아래와 같이 데이터를 읽어들이고 필요한 변수들을 뽑아서 새로운 데이터프레임을 만듭니다.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1"></a><span class="kw">library</span>(readxl)</span>
<span id="cb64-2"><a href="#cb64-2"></a>mydata &lt;-<span class="st"> </span><span class="kw">read_excel</span>(<span class="st">&quot;Exp_data.xls&quot;</span>, <span class="dt">sheet=</span><span class="dv">1</span>, <span class="dt">skip =</span> <span class="dv">0</span>, <span class="dt">col_names=</span>T)</span>
<span id="cb64-3"><a href="#cb64-3"></a>mydf &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">well=</span>mydata<span class="op">$</span>Well, </span>
<span id="cb64-4"><a href="#cb64-4"></a>                   <span class="dt">od=</span>mydata<span class="op">$</span><span class="st">`</span><span class="dt">595nm_kk (A)</span><span class="st">`</span>, </span>
<span id="cb64-5"><a href="#cb64-5"></a>                   <span class="dt">gfp=</span>mydata<span class="op">$</span><span class="st">`</span><span class="dt">EGFP_sulim (Counts)</span><span class="st">`</span>)</span>
<span id="cb64-6"><a href="#cb64-6"></a><span class="kw">head</span>(mydf)</span></code></pre></div>
<p>데이터 설명은 4장을 다시 참고하시면 되겠습니다. 우리가 원하는 그림은 다음 배치의 샘플들에 대해서 농도별로 bar graph를 그리는 것 입니다. 그런데 위 <code>mydf</code> 데이터에는 아래 그림에서 보이는 샘플 이름이나 처리 약물의 농도와 같은 정보는 없습니다. 보통 이러한 정보는 실험을 계획할 단계에서 만들어 집니다. 따라서 본 강의에서는 이러한 정보도 엑셀 파일로 읽어 오는 것으로 합니다. <a href="https://github.com/greendaygh/Rprog2020/blob/master/Exp_design.xlsx">Exp_design.xlsx</a> 포멧은 <code>샘플이름</code>;<code>반복횟수</code>;<code>처리약물</code>;<code>농도</code> 입니다.</p>
<p><img src="images/05/02.PNG" /></p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1"></a>designdata &lt;-<span class="st"> </span><span class="kw">read_excel</span>(<span class="st">&quot;Exp_design.xlsx&quot;</span>, <span class="dt">sheet=</span><span class="dv">1</span>, </span>
<span id="cb65-2"><a href="#cb65-2"></a>                         <span class="dt">skip =</span> <span class="dv">0</span>, <span class="dt">col_names=</span>F)</span>
<span id="cb65-3"><a href="#cb65-3"></a>designdata</span></code></pre></div>
<p>우리가 할 일은 mydf 데이터의 각 샘플(row)에 맞는 이름, 반복횟수, 약물 농도 등을 붙여 넣는 것입니다. 각 well의 position은 row가 A~H까지 column은 1~12 이고 이 well들의 label이 위 <code>mydf</code>에 well이라는 변수로 저장되어 있습니다. 우선 위 designdata 의 값들을 일렬로 나열하고 각 well 이름을 붙여놓은 데이터프레임을 만들어 봅니다. 여기서 새로 사용된 함수는 <code>melt</code> 입니다. <code>reshape2</code> 패키지를 설치해야 합니다. 이 함수를 이용하면 (wide형) 데이터를 (long형) 데이터로 쉽게 변환할 수 있습니다.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1"></a><span class="kw">library</span>(reshape2)</span>
<span id="cb66-2"><a href="#cb66-2"></a>labeldat &lt;-<span class="st"> </span><span class="kw">melt</span>(designdata, <span class="dt">measure.vars=</span><span class="dv">1</span><span class="op">:</span><span class="dv">12</span>)</span>
<span id="cb66-3"><a href="#cb66-3"></a>labnum &lt;-<span class="st"> </span><span class="kw">formatC</span>(<span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">12</span>, <span class="dt">each=</span><span class="dv">8</span>), <span class="dt">width=</span><span class="dv">2</span>, <span class="dt">format=</span><span class="st">&quot;d&quot;</span>, <span class="dt">flag=</span><span class="st">&quot;0&quot;</span>)</span>
<span id="cb66-4"><a href="#cb66-4"></a><span class="co">## add a new variable</span></span>
<span id="cb66-5"><a href="#cb66-5"></a>labeldat<span class="op">$</span>well &lt;-<span class="st"> </span><span class="kw">paste</span>(LETTERS[<span class="dv">1</span><span class="op">:</span><span class="dv">8</span>], labnum, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb66-6"><a href="#cb66-6"></a>labeldat</span></code></pre></div>
<p>그런데 위 ‘value’ 변수에 있는 값들은 문자열로서 <code>;</code> 기준으로 문자열을 나눠주어야 의미가 있습니다. 즉, 문자열 값들을 ‘이름’, ‘반복’, ‘약물’, ‘농도’ 순서로 분해해서 각각을 하나의 변수로 만들어야 합니다.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1"></a><span class="co">## remove &quot;-&quot;</span></span>
<span id="cb67-2"><a href="#cb67-2"></a>labeldat_sel &lt;-<span class="st"> </span>labeldat[labeldat<span class="op">$</span>value<span class="op">!=</span><span class="st">&quot;-&quot;</span>,]</span>
<span id="cb67-3"><a href="#cb67-3"></a><span class="co">## split</span></span>
<span id="cb67-4"><a href="#cb67-4"></a>labeldat_sel<span class="op">$</span>value[<span class="dv">2</span>]</span>
<span id="cb67-5"><a href="#cb67-5"></a><span class="kw">strsplit</span>(labeldat_sel<span class="op">$</span>value[<span class="dv">2</span>], <span class="dt">split=</span><span class="st">&quot;;&quot;</span>)</span>
<span id="cb67-6"><a href="#cb67-6"></a>mylab_list &lt;-<span class="st"> </span><span class="kw">strsplit</span>(labeldat_sel<span class="op">$</span>value, <span class="dt">split=</span><span class="st">&quot;;&quot;</span>)</span>
<span id="cb67-7"><a href="#cb67-7"></a><span class="co">## convert list to data.frame</span></span>
<span id="cb67-8"><a href="#cb67-8"></a><span class="co">## rbind(x[[1]], x[[2]], ...)</span></span>
<span id="cb67-9"><a href="#cb67-9"></a>mylab_df &lt;-<span class="st"> </span><span class="kw">do.call</span>(rbind, mylab_list) </span>
<span id="cb67-10"><a href="#cb67-10"></a><span class="kw">head</span>(mylab_df)</span>
<span id="cb67-11"><a href="#cb67-11"></a><span class="kw">colnames</span>(mylab_df) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Name&quot;</span>, <span class="st">&quot;Rep&quot;</span>, <span class="st">&quot;Chem&quot;</span>, <span class="st">&quot;Conc&quot;</span>)</span>
<span id="cb67-12"><a href="#cb67-12"></a><span class="co">## binding, selection</span></span>
<span id="cb67-13"><a href="#cb67-13"></a>mylab_df2 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">well =</span> labeldat_sel<span class="op">$</span>well, </span>
<span id="cb67-14"><a href="#cb67-14"></a>                        mylab_df, <span class="dt">stringsAsFactors =</span> F)</span>
<span id="cb67-15"><a href="#cb67-15"></a><span class="kw">str</span>(mylab_df2)</span></code></pre></div>
<p>이제 <code>mydf</code>와 <code>mylab_df2</code>를 합할 차례 입니다. <code>mydf</code>의 well 값과 <code>labeldat</code>의 well 값이 같은 것 끼리 묶이면 좋을 것 같습니다. 이런 경우 innerjoin 방법으로 <code>merge</code> 함수를 사용하면 됩니다.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1"></a><span class="co">## merge </span></span>
<span id="cb68-2"><a href="#cb68-2"></a>mydf2 &lt;-<span class="st"> </span><span class="kw">merge</span>(mydf, mylab_df2, <span class="dt">by=</span><span class="st">&#39;well&#39;</span>)</span></code></pre></div>
<p>이제 그래프를 그리기 위한 데이터가 준비 되었습니다. 지난 4장의 마지막 부분에서 그려 보았던 barplot을 그려 봅니다. A샘플의 평균과 표준편차를 이용한 막대그래프 입니다.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1"></a><span class="co">## subset</span></span>
<span id="cb69-2"><a href="#cb69-2"></a>mydf2_sub &lt;-<span class="st"> </span><span class="kw">subset</span>(mydf2, Name<span class="op">==</span><span class="st">&quot;A&quot;</span>)</span>
<span id="cb69-3"><a href="#cb69-3"></a><span class="co">## mean, sd for each group</span></span>
<span id="cb69-4"><a href="#cb69-4"></a>a_mean &lt;-<span class="st"> </span><span class="kw">aggregate</span>(mydf2_sub<span class="op">$</span>gfp, <span class="dt">by=</span><span class="kw">list</span>(mydf2_sub<span class="op">$</span>Conc), <span class="dt">FUN=</span>mean)</span>
<span id="cb69-5"><a href="#cb69-5"></a>a_sd &lt;-<span class="st">  </span><span class="kw">aggregate</span>(mydf2_sub<span class="op">$</span>gfp, <span class="dt">by=</span><span class="kw">list</span>(mydf2_sub<span class="op">$</span>Conc), <span class="dt">FUN=</span>sd)</span>
<span id="cb69-6"><a href="#cb69-6"></a>mydf2_merge &lt;-<span class="st"> </span><span class="kw">merge</span>(a_mean, a_sd, <span class="dt">by=</span><span class="st">&quot;Group.1&quot;</span>)</span>
<span id="cb69-7"><a href="#cb69-7"></a><span class="kw">colnames</span>(mydf2_merge) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Conc&quot;</span>, <span class="st">&quot;mean&quot;</span>, <span class="st">&quot;sd&quot;</span>)</span></code></pre></div>
<p>위와 같이 <code>subset</code>, <code>aggregate</code>, 그리고 <code>merge</code> 함수를 이용해서 원하는 데이터를 손쉽게 추출할 수 있고 아래와 같은 막대 그래프를 그릴 수 있습니다. 4장에서 수행한 코드들과 비교해 보면 간결하고 직관적으로 바뀐 것을 알 수 있습니다.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1"></a><span class="kw">barplot</span>(mydf2_merge<span class="op">$</span>mean, </span>
<span id="cb70-2"><a href="#cb70-2"></a>        <span class="dt">names.arg=</span>mydf2_merge<span class="op">$</span>Conc, </span>
<span id="cb70-3"><a href="#cb70-3"></a>        <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">80000</span>))</span></code></pre></div>
<p><img src="images/05/03.png" /></p>
<p>그런데 샘플 A 뿐만 아니라 모든 샘플에 대해서 한 눈에 들어오는 그래프를 그릴 필요가 있습니다. 본격적인 그래프 실습은 <code>ggplot2</code> 패키지를 이용해서 진행하기로 하고 지금은 우선 <code>barplot</code> 함수를 이용해서 간단하게 평균을 모두 그려보는 실습을 하겠습니다.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1"></a>mydf_mean &lt;-<span class="st"> </span><span class="kw">aggregate</span>(mydf2<span class="op">$</span>gfp, </span>
<span id="cb71-2"><a href="#cb71-2"></a>                       <span class="dt">by=</span><span class="kw">list</span>(mydf2<span class="op">$</span>Name, mydf2<span class="op">$</span>Conc), </span>
<span id="cb71-3"><a href="#cb71-3"></a>                       <span class="dt">FUN=</span>mean)</span>
<span id="cb71-4"><a href="#cb71-4"></a><span class="kw">colnames</span>(mydf_mean) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Name&quot;</span>, <span class="st">&quot;Conc&quot;</span>, <span class="st">&quot;mean&quot;</span>)</span>
<span id="cb71-5"><a href="#cb71-5"></a>mydf_mean</span></code></pre></div>
<p>위와 같이 <code>aggregate</code> 함수를 사용해서 Name과 Conc를 기준으로 모든 데이터에 대한 평균을 구할 수 있습니다. 그런데 위 데이터는 long형 데이터로서 ggplot에서 사용되는 데이터 형식이고 barplot을 사용하기 위해서는 wide형 데이터로 변환해 줄 필요가 있습니다.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1"></a>tmpdf &lt;-<span class="st"> </span><span class="kw">rbind</span>(mydf_mean[<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>,<span class="st">&quot;mean&quot;</span>], </span>
<span id="cb72-2"><a href="#cb72-2"></a>               mydf_mean[<span class="dv">7</span><span class="op">:</span><span class="dv">12</span>,<span class="st">&quot;mean&quot;</span>], </span>
<span id="cb72-3"><a href="#cb72-3"></a>               mydf_mean[<span class="dv">13</span><span class="op">:</span><span class="dv">18</span>,<span class="st">&quot;mean&quot;</span>],</span>
<span id="cb72-4"><a href="#cb72-4"></a>               mydf_mean[<span class="dv">19</span><span class="op">:</span><span class="dv">24</span>,<span class="st">&quot;mean&quot;</span>],</span>
<span id="cb72-5"><a href="#cb72-5"></a>               mydf_mean[<span class="dv">25</span><span class="op">:</span><span class="dv">30</span>,<span class="st">&quot;mean&quot;</span>],</span>
<span id="cb72-6"><a href="#cb72-6"></a>               mydf_mean[<span class="dv">31</span><span class="op">:</span><span class="dv">36</span>,<span class="st">&quot;mean&quot;</span>]</span>
<span id="cb72-7"><a href="#cb72-7"></a>               )</span>
<span id="cb72-8"><a href="#cb72-8"></a><span class="kw">colnames</span>(tmpdf) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>, <span class="st">&quot;D&quot;</span>, <span class="st">&quot;E&quot;</span>, <span class="st">&quot;F&quot;</span>)</span>
<span id="cb72-9"><a href="#cb72-9"></a><span class="kw">rownames</span>(tmpdf) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;0&quot;</span>, <span class="st">&quot;0.1&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;100&quot;</span>, <span class="st">&quot;1000&quot;</span>)</span>
<span id="cb72-10"><a href="#cb72-10"></a>tmpdf</span></code></pre></div>
<p>위와 같은 wide형 데이터에 대해서 barplot 함수를 사용 할 경우 아래와 같이 두 개의 그룹을 갖는 데이터를 비교할 수 있는 막대그래프를 그릴 수 있습니다.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1"></a><span class="kw">barplot</span>(tmpdf, <span class="dt">beside =</span> T)</span></code></pre></div>
<p><img src="images/05/04.png" /></p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1"></a><span class="kw">library</span>(RColorBrewer)</span>
<span id="cb74-2"><a href="#cb74-2"></a><span class="kw">display.brewer.all</span>()</span>
<span id="cb74-3"><a href="#cb74-3"></a>mycol &lt;-<span class="st"> </span><span class="kw">brewer.pal</span>(<span class="dv">6</span>, <span class="st">&quot;RdBu&quot;</span>)</span>
<span id="cb74-4"><a href="#cb74-4"></a><span class="kw">barplot</span>(tmpdf, <span class="dt">beside =</span> T, <span class="dt">col=</span>mycol)</span>
<span id="cb74-5"><a href="#cb74-5"></a><span class="kw">legend</span>(<span class="st">&#39;topleft&#39;</span>, </span>
<span id="cb74-6"><a href="#cb74-6"></a>       <span class="dt">title =</span> <span class="st">&#39;Conc&#39;</span>, </span>
<span id="cb74-7"><a href="#cb74-7"></a>       <span class="dt">legend =</span> <span class="kw">rownames</span>(tmpdf), </span>
<span id="cb74-8"><a href="#cb74-8"></a>       <span class="dt">fill=</span>mycol, <span class="dt">bty=</span><span class="st">&quot;n&quot;</span>) </span></code></pre></div>
<p><img src="images/05/05.png" /></p>
<hr />
<p><a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="크리에이티브 커먼즈 라이선스" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/88x31.png" /></a><br />이 저작물은 <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/">크리에이티브 커먼즈 저작자표시-비영리-변경금지 4.0 국제 라이선스</a>에 따라 이용할 수 있습니다.</p>
<!--chapter:end:05-basic-plot.Rmd-->
</div>
</div>
<div id="r-graphics-ggplot2" class="section level1">
<h1 number="6"><span class="header-section-number">6</span> R graphics ggplot2</h1>
<p>지난 5장에서는 R에서 기본으로 제공되는 그래프 함수를 알아보았습니다. 이번에는 <code>ggplot2</code>를 이용한 시각화에 대해서 알아봅니다. 데이터를 분석할 때 실제 데이터를 눈으로 확인하는 것은 중요합니다. 가능하면 raw 데이터를 보면서 크기 비교나 분포를 대략적으로 예측한다면 tool을 사용해서 나오는 결과를 가늠하는 척도가 될 수도 있습니다. 그러나 데이터가 커질경우 그래프를 이용해서 분포나 패턴을 확인하게되고 이를 위한 시각화 패키지 중 가장 많이 쓰이는 도구가 <code>ggplot2</code> 입니다.</p>
<p><code>ggplot2</code> ( <a href="https://ggplot2.tidyverse.org/" class="uri">https://ggplot2.tidyverse.org/</a> )는 해들리위컴이 (Hadley Wickham) 만든 데이터 시각화 패키지입니다. <code>ggplot2</code>는 <code>tidyverse</code>의 (데이터 분석을 위한 패키지모음) 핵심 패키지 중 하나로서 <code>tidyverse</code>에는 <code>ggplot2</code> 외에도 다음에 배울 <code>dplyr</code> 등의 데이터 사이언스를 위한 유용한 패키지들이 함께 관리되고 있습니다.</p>
<div id="basics" class="section level2">
<h2 number="6.1"><span class="header-section-number">6.1</span> Basics</h2>
<p><code>iris</code> 데이터를 이용해서 간단하게 barplot을 그려봅니다. <code>iris</code> 데이터는 3가지 품종별 꽃잎과 꽃받침의 길이와 넓이를 측정한 데이터 입니다. 다음은 꽃잎의 길이와 넓이의 관계를 볼 수 있는 산점도 입니다.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb75-2"><a href="#cb75-2"></a><span class="kw">head</span>(iris)</span>
<span id="cb75-3"><a href="#cb75-3"></a><span class="kw">ggplot</span>(<span class="dt">data=</span>iris) <span class="op">+</span></span>
<span id="cb75-4"><a href="#cb75-4"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping=</span><span class="kw">aes</span>(<span class="dt">x=</span>Petal.Length, <span class="dt">y=</span>Petal.Width))</span></code></pre></div>
<p>눈에 띄이는 부분은 <code>+</code>를 이용한 레이어들의 연결입니다. <code>ggplot()</code> 함수 뒤에 다양한 레이어들을 연결할 수 있고 <code>geom_point()</code> 함수는 지정한 위치에 산점도 레이어를 추가하는 기능을 합니다. 각 레이어들은 다음과 같은 다양한 기능을 갖는 함수들로 구성될 수 있습니다.</p>
<ul>
<li>데이터 지정 (ggplot)</li>
<li>색상, 크기, x축의 값, y축의 값 등 심미적 요소 지정 (aes)</li>
<li>점, 선, 면 등 기하학적 요소 지정 (geoms)</li>
<li>그릴 통계량 지정 (stats)</li>
<li>테마, 스케일 지정 (theme)</li>
</ul>
<p>일반적으로 <code>ggplot</code>을 이용하여 그래프를 그리는 순서는 다음과 같습니다.</p>
<ul>
<li>어떤 그래프를 그릴지 결정</li>
<li>ggplot의 데이터셋과 aesthetic 설정</li>
<li>geometric 요소와 적절한 statistics를 설정한 레이어 추가</li>
<li>스케일과 테마를 설정한 레이어 추가</li>
</ul>
<p>ggplot만을 실행할 경우 데이터와 x, y 축만 지정한 상태로 어떤 그래프 (히스토그램인지, 산포도인지 등)를 그릴지 명시되어 있지 않아서 아무것도 그리지 않은 상태의 빈 켄버스만 그려지게 되며 <code>geom_point()</code> 함수를 즉, 점을 그릴지 선을 그릴지 어떤 통계량을 그릴지 아니면 값 자체를 그릴지 등을 지정해 주고 나서야 비로서 그래프가 그려집니다.</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1"></a><span class="kw">ggplot</span>(<span class="dt">data=</span>iris, <span class="dt">mapping=</span><span class="kw">aes</span>(<span class="dt">x=</span>Petal.Length, <span class="dt">y=</span>Petal.Width))</span>
<span id="cb76-2"><a href="#cb76-2"></a>?ggplot</span>
<span id="cb76-3"><a href="#cb76-3"></a><span class="kw">ggplot</span>(iris, <span class="kw">aes</span>(<span class="dt">x=</span>Petal.Length, <span class="dt">y=</span>Petal.Width))</span>
<span id="cb76-4"><a href="#cb76-4"></a><span class="kw">ggplot</span>(iris, <span class="kw">aes</span>(<span class="dt">x=</span>Petal.Length, <span class="dt">y=</span>Petal.Width)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</span></code></pre></div>
<p><code>geom_point()</code>의 도움말을 보면 다음과 같이 <code>data</code>, <code>mapping</code>, <code>stat</code> 등의 파라메터들이 있습니다. 이는 <code>ggplot</code>함수에서 설정한 <code>data</code>나 <code>mapping</code> 정보를 <code>geom_point</code>에서 설정 하거나 완전히 다른 데이터를 x축과 y축에 그릴 수 있다는 뜻 이기도 합니다.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1"></a><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb77-2"><a href="#cb77-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data=</span>iris, <span class="dt">mapping=</span><span class="kw">aes</span>(<span class="dt">x=</span>Petal.Length, <span class="dt">y=</span>Petal.Width)) </span></code></pre></div>
<p>그런데 위 꽃잎의 길이와 넓이는 세 가지 다른 종류의 붓꽃에 대한 정보입니다. 따라서 각 종에 따라 다른 색이나 기호를 할당하는 것도 <code>mapping</code>에서 설정할 수 있습니다.</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1"></a><span class="kw">ggplot</span>(iris, <span class="kw">aes</span>(<span class="dt">x=</span>Petal.Length, <span class="dt">y=</span>Petal.Width, <span class="dt">color=</span>Species, <span class="dt">shape=</span>Species)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb78-2"><a href="#cb78-2"></a><span class="st">  </span><span class="kw">geom_point</span>()</span>
<span id="cb78-3"><a href="#cb78-3"></a></span>
<span id="cb78-4"><a href="#cb78-4"></a><span class="kw">ggplot</span>(iris, <span class="kw">aes</span>(<span class="dt">x=</span>Petal.Length, <span class="dt">y=</span>Petal.Width)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb78-5"><a href="#cb78-5"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color=</span>Species, <span class="dt">shape=</span>Species))</span></code></pre></div>
<p>위 산점도들의 <code>stat</code>은 <code>identity</code> 입니다. 즉, 따로 통계량을 계산할 필요 없이 값 그 자체를 사용하겠다는 것 입니다. 히스토그램의 경우 <code>geom_bar()</code> 함수로 막대그래프를 그릴 수 있습니다. <code>geom_bar</code>의 help페이지를 보면 <code>stat="count"</code>로 설정되어 있는 것을 알 수 있습니다. 꽃잎의 넓이에 대한 분포를 예로 구해봅니다. 히스토그램을 그릴경우 변수 한 개의 데이터만 필요하고 y축에는 자동으로 빈도수가 들어가게 되므로 <code>aes</code>에서 x만 mapping 해 주면 됩니다.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1"></a><span class="kw">ggplot</span>(iris, <span class="kw">aes</span>(<span class="dt">x=</span>Petal.Width)) <span class="op">+</span><span class="st">  </span></span>
<span id="cb79-2"><a href="#cb79-2"></a><span class="st">  </span><span class="kw">geom_bar</span>()</span></code></pre></div>
</div>
<div id="facets" class="section level2">
<h2 number="6.2"><span class="header-section-number">6.2</span> Facets</h2>
<p>다시 산점도의 예에서 위와 같이 다른 색이나 모양으로 그리기 보다는 종 별로 다른 켄버스에 별도의 산점도를 그려야 할 경우가 있습니다. 이럴때 사용하는 함수가 <code>facet_wrap()</code>이나 <code>facet_grid()</code> 입니다. 보통 범주형 자료에 대해서 적용할 수 있으며 위 붓꽃 예에서는 3가지 종을 나타내는 변수 <code>Species</code>를 이용하면 되겠습니다. <code>facet_wrap()</code>함수에는 <code>~</code>를 이용한 formula를 사용합니다.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1"></a><span class="kw">ggplot</span>(iris, <span class="kw">aes</span>(<span class="dt">x=</span>Petal.Length, <span class="dt">y=</span>Petal.Width)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb80-2"><a href="#cb80-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color=</span>Species, <span class="dt">shape=</span>Species)) <span class="op">+</span></span>
<span id="cb80-3"><a href="#cb80-3"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>Species, <span class="dt">nrow=</span><span class="dv">2</span>)</span></code></pre></div>
<p>만약 두 개의 범주형 변수에 대해서 x, y축 각각으로 나누고 싶을 때는 <code>facet_grid()</code>를 사용할 수 있습니다. <code>iris</code> 데이터는 하나의 범주형 변수와 네 개의 숫자형 변수로 구성되어 있습니다 (<code>str(iris)</code> 확인). 여기에 랜덤하게 0과 1을 갖는 범주형 변수 하나를 추가해 보겠습니다.</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1"></a><span class="kw">str</span>(iris)</span>
<span id="cb81-2"><a href="#cb81-2"></a>mycate &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="kw">nrow</span>(iris), <span class="dt">replace=</span>T)</span>
<span id="cb81-3"><a href="#cb81-3"></a>myiris &lt;-<span class="st"> </span><span class="kw">data.frame</span>(iris, mycate)</span>
<span id="cb81-4"><a href="#cb81-4"></a><span class="kw">str</span>(myiris)</span></code></pre></div>
<p>이제 mycate와 Species 두 범주형 변수에 대해서 facet 그래프를 그려보면 다음과 같습니다. <code>facet_grid()</code>함수를 사용하면 되며 x와 y축의 변수는 <code>~</code>를 활용한 formula를 사용합니다. 즉 <code>~</code> 왼편의 변수는 y축 오른편의 변수는 x축으로 구성되어집니다. 새로운 <code>myiris</code>라는 데이터를 만들었으므로 iris 대신 myiris를 사용합니다.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1"></a><span class="kw">ggplot</span>(myiris, <span class="kw">aes</span>(<span class="dt">x=</span>Petal.Length, <span class="dt">y=</span>Petal.Width)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb82-2"><a href="#cb82-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color=</span>Species, <span class="dt">shape=</span>Species)) <span class="op">+</span></span>
<span id="cb82-3"><a href="#cb82-3"></a><span class="st">  </span><span class="kw">facet_grid</span>(Species<span class="op">~</span>mycate)</span></code></pre></div>
<p>만약 하나의 변수에 대해서 x축이나 y축 하나에만 나열하고 싶은 경우 다음처럼 <code>.</code> 을 사용하면 됩니다.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1"></a><span class="kw">ggplot</span>(myiris, <span class="kw">aes</span>(<span class="dt">x=</span>Petal.Length, <span class="dt">y=</span>Petal.Width)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb83-2"><a href="#cb83-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color=</span>Species, <span class="dt">shape=</span>Species)) <span class="op">+</span></span>
<span id="cb83-3"><a href="#cb83-3"></a><span class="st">  </span><span class="kw">facet_grid</span>(.<span class="op">~</span>mycate)</span>
<span id="cb83-4"><a href="#cb83-4"></a></span>
<span id="cb83-5"><a href="#cb83-5"></a><span class="kw">ggplot</span>(myiris, <span class="kw">aes</span>(<span class="dt">x=</span>Petal.Length, <span class="dt">y=</span>Petal.Width)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb83-6"><a href="#cb83-6"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color=</span>Species, <span class="dt">shape=</span>Species)) <span class="op">+</span></span>
<span id="cb83-7"><a href="#cb83-7"></a><span class="st">  </span><span class="kw">facet_grid</span>(Species<span class="op">~</span>.)</span>
<span id="cb83-8"><a href="#cb83-8"></a></span>
<span id="cb83-9"><a href="#cb83-9"></a><span class="kw">ggplot</span>(myiris, <span class="kw">aes</span>(<span class="dt">x=</span>Petal.Length, <span class="dt">y=</span>Petal.Width)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb83-10"><a href="#cb83-10"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color=</span>Species, <span class="dt">shape=</span>Species)) <span class="op">+</span></span>
<span id="cb83-11"><a href="#cb83-11"></a><span class="st">  </span><span class="kw">facet_grid</span>(.<span class="op">~</span>Species)</span></code></pre></div>
<div id="exercise-6.1" class="section level3">
<h3 number="6.2.1"><span class="header-section-number">6.2.1</span> Exercise 6.1</h3>
<p><code>Orange</code> 데이터셋은 다섯 그루의 오랜지 나무에 대한 시간에(age-days) 따른 성장을(circumference) 기록한 데이터임.</p>
<ol style="list-style-type: decimal">
<li>age와 circumference 를 각각 x와 y축으로 하는 산점도를 그리는 코드를 작성하시오 (ggplot 이용, 나무별로 다른 색 사용)</li>
</ol>
<p><img src="Rprog_files/figure-html/unnamed-chunk-89-1.png" width="672" /></p>
<ol start="2" style="list-style-type: decimal">
<li>나무별로 다른 켄버스에 age와 circumference를 x와 y축으로 하는 산점도를 그리는 코드를 작성하시오 (ggplot, facet_grid이용)</li>
</ol>
<p><img src="Rprog_files/figure-html/unnamed-chunk-90-1.png" width="672" /></p>
</div>
</div>
<div id="bar-graph" class="section level2">
<h2 number="6.3"><span class="header-section-number">6.3</span> Bar graph</h2>
<p>ggplot을 이용한 막대그래프 그리는 방법에 대해서 좀 더 알아보겠습니다. 앞서와 같이 ggplot 함수로 먼저 데이터와 aes로 x축 y축 등을 명시하고 <code>+</code> 오퍼레이터를 사용하여 필요한 레이어를 차례로 추가하면서 그래프를 그릴 수 있습니다. <code>geom_bar()</code> 함수의 경우 x가 연속형일 경우는 아래와 같이 히스토그램을 그려주기 어렵습니다 (위 iris 예제에서 <code>geom_bar()</code> 그래프에서는 실제 꽃받침의 width 값은 연속형이 맞으나 관측된 iris 데이터들이 같은 값들이 많은 범주형처럼 되어 있어 히스토그램 그림이 그려졌습니다) 이럴 경우 stat을 <code>bin</code>으로 바꿔주면 해당 범위 안에 있는 값들의 빈도수를 계산하여 히스토그램을 그릴 수 있습니다.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1"></a>dat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x1=</span><span class="kw">rnorm</span>(<span class="dv">100</span>))</span>
<span id="cb84-2"><a href="#cb84-2"></a><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>x1)) <span class="op">+</span></span>
<span id="cb84-3"><a href="#cb84-3"></a><span class="st">  </span><span class="kw">geom_bar</span>()</span>
<span id="cb84-4"><a href="#cb84-4"></a></span>
<span id="cb84-5"><a href="#cb84-5"></a><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>x1)) <span class="op">+</span></span>
<span id="cb84-6"><a href="#cb84-6"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;bin&quot;</span>, <span class="dt">bins=</span><span class="dv">30</span>)</span></code></pre></div>
<p>x가 이산형인 경우는 stat을 디폴트 값인 <code>count</code>로 설정하여 해당 값들의 빈도수를 그려줄 수 있습니다. 이는 앞서 <code>iris</code>에서 배운 예제와 같습니다.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1"></a>x1 &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="dv">100</span>, <span class="dt">replace =</span> T)</span>
<span id="cb85-2"><a href="#cb85-2"></a>dat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x=</span>x1)</span>
<span id="cb85-3"><a href="#cb85-3"></a><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>x)) <span class="op">+</span></span>
<span id="cb85-4"><a href="#cb85-4"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;count&quot;</span>)</span></code></pre></div>
<p>이제 두 개의 변수가 있는 경우를 생각해 봅니다. 두 변수에 대해서 막대그래프를 그릴 경우 다음과 같이 <code>Error: stat_count() must not be used with a y aesthetic.</code> 에러가 발생할 수 있습니다.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1"></a>x1 &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">10</span>)</span>
<span id="cb86-2"><a href="#cb86-2"></a>x2 &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">10</span>)</span>
<span id="cb86-3"><a href="#cb86-3"></a>dat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(x1, x2)</span>
<span id="cb86-4"><a href="#cb86-4"></a><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>x1, <span class="dt">y=</span>x2)) <span class="op">+</span></span>
<span id="cb86-5"><a href="#cb86-5"></a><span class="st">  </span><span class="kw">geom_bar</span>()</span></code></pre></div>
<p>이는 <code>geom_bar()</code>의 <code>stat</code>이 기본적으로 <code>count</code>로 설정되어 있으므로 생기는 에러 입니다. <code>stat</code>을 <code>identity</code>로 설정하면 x1값에 해당하는 x2값을 그려주는 막대 그래프를 그릴 수 있습니다. 참고로 이 그래프는 <code>geom_point</code>와 비슷한 정보를 보여 주게 됩니다.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1"></a>x1 &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">10</span>)</span>
<span id="cb87-2"><a href="#cb87-2"></a>x2 &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">10</span>)</span>
<span id="cb87-3"><a href="#cb87-3"></a>dat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(x1, x2)</span>
<span id="cb87-4"><a href="#cb87-4"></a><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>x1, <span class="dt">y=</span>x2)) <span class="op">+</span></span>
<span id="cb87-5"><a href="#cb87-5"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>)</span>
<span id="cb87-6"><a href="#cb87-6"></a></span>
<span id="cb87-7"><a href="#cb87-7"></a><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>x1, <span class="dt">y=</span>x2)) <span class="op">+</span></span>
<span id="cb87-8"><a href="#cb87-8"></a><span class="st">  </span><span class="kw">geom_point</span>()</span></code></pre></div>
<p>다음과 같이 레이어를 추가하여 두 그래프를 같은 화면에 그릴 수도 있습니다. 여기서 <code>col</code>과 <code>size</code>는 <code>aes</code>함수안에서 쓰이지 않았음을 주의하시기 바랍니다. <code>aes</code>에서는 데이터와 특정 모양, 색깔을 mapping 해주는 역할을 하고 아래와 같이 지정해 줄 경우 데이터와 상관 없이 해당 레이어의 모든 그래프에 대해서 일괄적으로 적용되게 됩니다.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1"></a><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>x1, <span class="dt">y=</span>x2)) <span class="op">+</span></span>
<span id="cb88-2"><a href="#cb88-2"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="op">+</span></span>
<span id="cb88-3"><a href="#cb88-3"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">col=</span><span class="st">&quot;red&quot;</span>, <span class="dt">size=</span><span class="dv">5</span>)</span></code></pre></div>
<p>또한 다음과 같이 다양한 레이어를 추가하여 필요한 기능을 사용할 수 있습니다. <code>fill=x1</code> 이라는 코드는 막대그래프의 색을 채울 때 x1에 따라서 다른 값들을 채우는 역할을 한다고 보면 되겠습니다.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1"></a>x1 &lt;-<span class="st"> </span><span class="kw">as.factor</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)</span>
<span id="cb89-2"><a href="#cb89-2"></a>y1 &lt;-<span class="st"> </span><span class="kw">tabulate</span>(<span class="kw">sample</span>(x1, <span class="dv">100</span>, <span class="dt">replace=</span>T))</span>
<span id="cb89-3"><a href="#cb89-3"></a>dat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(x1, y1)</span>
<span id="cb89-4"><a href="#cb89-4"></a><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>x1, <span class="dt">y=</span>y1, <span class="dt">fill=</span>x1)) <span class="op">+</span></span>
<span id="cb89-5"><a href="#cb89-5"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="op">+</span></span>
<span id="cb89-6"><a href="#cb89-6"></a><span class="st">  </span><span class="kw">guides</span>(<span class="dt">fill=</span><span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb89-7"><a href="#cb89-7"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Discrete cases&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb89-8"><a href="#cb89-8"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Value&quot;</span>) <span class="op">+</span></span>
<span id="cb89-9"><a href="#cb89-9"></a><span class="st">  </span><span class="kw">ylim</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">50</span>))<span class="op">+</span></span>
<span id="cb89-10"><a href="#cb89-10"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Bar graph for x:discrete and y:value&quot;</span>)</span></code></pre></div>
<div id="exercise-6.2" class="section level3">
<h3 number="6.3.1"><span class="header-section-number">6.3.1</span> Exercise 6.2</h3>
<p><code>InsectSprays</code>는 제초제의 효능에 관한 데이터이다. 다음과 같은 plot을 그리는 코드를 작성 하시오</p>
<p><img src="Rprog_files/figure-html/unnamed-chunk-97-1.png" width="672" /></p>
</div>
</div>
<div id="line-graph" class="section level2">
<h2 number="6.4"><span class="header-section-number">6.4</span> Line graph</h2>
<p>다음으로 ggplot을 이용한 line graph를 그리는 방법을 알아 봅니다. Line graph는 geom_line이라는 함수를 사용해서 그릴 수 있으며 stat의 사용법은 앞서 bar graph와 같습니다.</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1"></a>x1 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">12</span>, <span class="dv">21</span>, <span class="dv">40</span>)</span>
<span id="cb90-2"><a href="#cb90-2"></a>x2 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">33</span>, <span class="dv">10</span>, <span class="dv">82</span>)</span>
<span id="cb90-3"><a href="#cb90-3"></a>dat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(x1, x2)</span>
<span id="cb90-4"><a href="#cb90-4"></a><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(x1, x2)) <span class="op">+</span></span>
<span id="cb90-5"><a href="#cb90-5"></a><span class="st">  </span><span class="kw">geom_line</span>()</span></code></pre></div>
<p>아래와 같이 그려지는 선의 두께를 조절하거나 레이어를 추가하는 방법으로 점을 추가로 그려볼 수 있습니다. <code>fill</code>의 경우 특정 도형에 채워지는 색을 의미합니다. 도형에 따라서 point의 경우 <a href="https://r4ds.had.co.nz/data-visualisation.html#aesthetic-mappings" class="uri">https://r4ds.had.co.nz/data-visualisation.html#aesthetic-mappings</a> 이 곳을 참고하세요</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1"></a><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>x1, <span class="dt">y=</span>x2)) <span class="op">+</span></span>
<span id="cb91-2"><a href="#cb91-2"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">size=</span><span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb91-3"><a href="#cb91-3"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size=</span><span class="dv">4</span>, <span class="dt">pch=</span><span class="dv">21</span>, <span class="dt">fill=</span><span class="st">&quot;white&quot;</span>) <span class="op">+</span></span>
<span id="cb91-4"><a href="#cb91-4"></a><span class="st">  </span><span class="kw">guides</span>(<span class="dt">fill=</span><span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb91-5"><a href="#cb91-5"></a><span class="st">  </span><span class="kw">ylim</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">100</span>)) <span class="op">+</span></span>
<span id="cb91-6"><a href="#cb91-6"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Continuous cases&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Value&quot;</span>) <span class="op">+</span></span>
<span id="cb91-7"><a href="#cb91-7"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Line graph for x:continuous and y:continuous&quot;</span>)</span></code></pre></div>
<p>위 경우는 x와 y가 모두 연속형 데이터일 경우 입니다. x는 이산형, y가 연속형일 경우 앞에서와 같이 bar graph를 이용하여 그래프를 그리게 됩니다. 그런데 이런 bar의 높이에 해당하는 값들을 서로 선으로 연결하고 싶은 경우가 있습니다. 이 때는 다음과 같이 <code>aes</code>의 <code>group</code> 이라는 파라미터를 설정하여 두 점 이상을 연결할 수 있습니다. 만약 group으로 나타낼 수 있는 변수가 없을 경우 <code>group=1</code>이라고 명시해 주고 선을 그릴 수 있으며 이 경우 모든 값들이 같은 <code>1</code> 그룹에 있는 것으로 간주됩니다. <code>1</code>이라는 것은 하나의 예이며 어떤 숫자나 문자가 와도 괜찮습니다.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1"></a>x1 &lt;-<span class="st"> </span><span class="kw">as.factor</span>(<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>))</span>
<span id="cb92-2"><a href="#cb92-2"></a>y1 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">33</span>, <span class="dv">10</span>, <span class="dv">82</span>)</span>
<span id="cb92-3"><a href="#cb92-3"></a>dat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(x1, y1)</span>
<span id="cb92-4"><a href="#cb92-4"></a><span class="kw">str</span>(dat)</span>
<span id="cb92-5"><a href="#cb92-5"></a><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>x1, <span class="dt">y=</span>y1, <span class="dt">group=</span><span class="dv">1</span>)) <span class="op">+</span></span>
<span id="cb92-6"><a href="#cb92-6"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="op">+</span></span>
<span id="cb92-7"><a href="#cb92-7"></a><span class="st">  </span><span class="kw">guides</span>(<span class="dt">fill=</span><span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb92-8"><a href="#cb92-8"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Discrete cases&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Value&quot;</span>) <span class="op">+</span></span>
<span id="cb92-9"><a href="#cb92-9"></a><span class="st">  </span><span class="kw">ylim</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">100</span>))<span class="op">+</span></span>
<span id="cb92-10"><a href="#cb92-10"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Line plot for x:discrete and y:continuous&quot;</span>)</span></code></pre></div>
<p>위에서와 같은 방법으로 point와 bar 등을 같이 그려줄 수 있습니다.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1"></a><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>x1, <span class="dt">y=</span>y1, <span class="dt">group=</span><span class="dv">1</span>)) <span class="op">+</span></span>
<span id="cb93-2"><a href="#cb93-2"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>, <span class="dt">fill=</span>x1) <span class="op">+</span></span>
<span id="cb93-3"><a href="#cb93-3"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">size=</span><span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb93-4"><a href="#cb93-4"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size=</span><span class="dv">4</span>, <span class="dt">pch=</span><span class="dv">21</span>, <span class="dt">fill=</span><span class="st">&quot;white&quot;</span>) <span class="op">+</span></span>
<span id="cb93-5"><a href="#cb93-5"></a><span class="st">  </span><span class="kw">guides</span>(<span class="dt">fill=</span><span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb93-6"><a href="#cb93-6"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Discrete cases&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Value&quot;</span>) <span class="op">+</span></span>
<span id="cb93-7"><a href="#cb93-7"></a><span class="st">  </span><span class="kw">ylim</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">100</span>))<span class="op">+</span></span>
<span id="cb93-8"><a href="#cb93-8"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Line for x:discrete and y:value&quot;</span>)</span></code></pre></div>
<p>여기서는 fill 옵션이 geom_bar에 하나 geom_point에 하나씩 쓰였는데 geom_bar에서 사용된 fill은 bar에 채워지는 색을 x1의 값에 따라 바꾸겠다는 것을 의미하고 <code>geom_point</code>의 fill은 데이터에 상관 없이 모두 white로 채우라는 명령 입니다. 각 geometry에 따라서 필요한 옵션이 다르므로 각각의 geom_xxx를 사용할 때 상황에 맞게 사용하시면 되겠습니다.</p>
<div id="exercise-6.3" class="section level3">
<h3 number="6.4.1"><span class="header-section-number">6.4.1</span> Exercise 6.3</h3>
<p>위 exercise 6.1의 2)에서 그려진 나무별 산점도에 다음과 같이 선분을 추가한 그래프를 그리는 코드를 작성 하시오</p>
<p><img src="Rprog_files/figure-html/unnamed-chunk-102-1.png" width="672" /></p>
</div>
</div>
<div id="smoothing" class="section level2">
<h2 number="6.5"><span class="header-section-number">6.5</span> Smoothing</h2>
<p>산포도는 앞서와 같이 데이터를 점으로 표현한 그래프입니다. Smoothing은 관측된 데이터를 이용하여 모형을 추정하는데 사용되는 통계적 방법이며 이를 그래프로 표현하여 추세선을 그릴 수 있습니다. 예를 들어 몸무게와 키라는 두 변수의 관계를 알아보고자 할 때 산포도를 그리고 Smoothing을 통해 점들의 평균값을 이어주는 방법으로 모형을 추정하고 추세선을 그릴 수 있습니다.</p>
<p><code>mtcars</code> 데이터는 1974년 미국 자동차 잡지에서 추출한 데이터로서 당시 다양한 모델의 자동차에대한 성능을 저장하고 있습니다 (<code>?mtcars</code>로 자세한 정보를 볼 수 있음). 이 데이터를 이용해서 연비와 마력 (horsepower) 두 변수의 관계를 그래프로 그려보겠습니다. 직관적으로 생각하면 두 변수는 반비례 할 것으로 기대됩니다. <code>ggplot</code>을 활용해서 두 변수의 산포도를 그리고 smoothing을 수행해 보도록 하겠습니다.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb94-2"><a href="#cb94-2"></a><span class="kw">ggplot</span>(mtcars, <span class="kw">aes</span>(<span class="dt">x=</span>mpg, <span class="dt">y=</span>hp)) <span class="op">+</span></span>
<span id="cb94-3"><a href="#cb94-3"></a><span class="st">  </span><span class="kw">geom_point</span>()</span></code></pre></div>
<p>위와 같이 <code>mtcars</code>는 <code>data.frame</code>이므로 <code>ggplot</code>으로 바로 받아서 x축과 y축 mapping에 필요한 변수들 이름을 직접 할당하고 <code>geom_point</code>함수를 이용해서 간단히 산포도를 그릴 수 있습니다. 이 산포도만으로도 mpg와 hp 두 변수간의 관계가 역함수 관계임을 알 수 있고 또한 선형이 아닌 것도 알 수 있습니다. 이제 위 그림에 <code>geom_smooth()</code>함수를 이용해서 (모형) 적합 곡선 (또는 추세선)을 그려봅니다.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1"></a><span class="kw">ggplot</span>(mtcars, <span class="kw">aes</span>(<span class="dt">x=</span>mpg, <span class="dt">y=</span>hp)) <span class="op">+</span></span>
<span id="cb95-2"><a href="#cb95-2"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb95-3"><a href="#cb95-3"></a><span class="st">  </span><span class="kw">geom_smooth</span>()</span></code></pre></div>
<p>간단히 <code>geom_smooth()</code> 한 줄을 추가하여 추세선을 그렸으며 경고 메세지에서 볼 수 있듯이 알고리즘은 <code>loess</code> 모형을 사용했고 공식은 (formula는) <code>y~x</code>로, 즉, y축 변수를 반응변수로 x축 변수를 설명변수로 설정하여 그려졌습니다. 직선의 공식 <code>y=ax+b</code>를 생각해 보시면 무슨 의미인지 이해가 더 쉬울듯 합니다. <code>?geom_smooth</code>로 보면 알 수 있듯이 모형을 적합하는 알고리즘 옵션을 <code>lm</code>, <code>glm</code>, <code>loess</code> 등 다양하게 설정할 수 있으며 <code>auto</code>로 하게 되면 데이터의 크기나 형식에 맞춰서 방법을 자동으로 선택해서 그려주게 됩니다. <code>se</code> 옵션은 기본적으로 <code>TRUE</code> 값을 가지며 위 그림에서 볼 수 있는 선분 주위의 회색 구간으로 신뢰구간을 그려주는 옵션 입니다. <code>span</code> 옵션은 loess 모형의 smoothing 정도를 조절할 수 있는데 이는 직접 바꿔가면서 실습을 해보면 이해에 도움이 되겠습니다.</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1"></a><span class="kw">ggplot</span>(mtcars, <span class="kw">aes</span>(<span class="dt">x=</span>mpg, <span class="dt">y=</span>hp)) <span class="op">+</span></span>
<span id="cb96-2"><a href="#cb96-2"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb96-3"><a href="#cb96-3"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">se=</span><span class="ot">FALSE</span>, <span class="dt">span=</span><span class="fl">0.2</span>)</span></code></pre></div>
<p>위와 같이 <code>span</code> 옵션을 작게 설정할 수록 관측된 데이터(점)에 선분(모형)이 가까이 붙게 됩니다. 이를 과대적합 (overfitting)이라고 하며 간단히 설명하면 관측된 데이터에만 너무 잘맞는 모형을 만드는 경우를 말합니다. 이럴 경우 새롭게 관측된 데이터는 모형의 예측값과 잘 맞지 않게 됩니다.</p>
<p>이번에는 모의 데이터를 생성해서 그래프를 그려보겠습니다. 네 개 학급에 있는 학생들의 키와 몸무게를 저장한 데이터를 만들어 봅니다. 이 경우 몇 개의 변수가 필요할지 생각해 보시기 바랍니다. 키와 몸무게 그리고 학급을 나타내는 변수 3개가 필요하며 키와 몸무게는 정수형, 그룹을 나타내는 변수는 문자형이나 factor형으로 나타내면 되겠습니다. 각 학급의 학생수는 50명으로 총 200명의 학생이 있는 것으로 하며 각 그룹별로 키나 몸무게의 차이는 없고 키가 큰 사람은 몸무게가 많이 나가는 것으로 합니다. 키와 몸무게 사이에는 다음과 같은 연관성을 만들어 줍니다. <span class="math inline">\(height= weight + N(100, 10)\)</span></p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1"></a>weights &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">200</span>, <span class="dv">75</span>, <span class="dv">5</span>)</span>
<span id="cb97-2"><a href="#cb97-2"></a>heights &lt;-<span class="st"> </span>weights <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">200</span>, <span class="dv">100</span>, <span class="dv">5</span>)</span>
<span id="cb97-3"><a href="#cb97-3"></a>classes &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>, <span class="st">&quot;D&quot;</span>), <span class="dt">size=</span><span class="kw">length</span>(heights), <span class="dt">replace =</span> T)</span>
<span id="cb97-4"><a href="#cb97-4"></a>mydata &lt;-<span class="st"> </span><span class="kw">data.frame</span>(heights, weights, classes)</span>
<span id="cb97-5"><a href="#cb97-5"></a><span class="kw">str</span>(mydata)</span></code></pre></div>
<p>이제 위 데이터를 이용해서 몸무게와 키의 산포도와 추세선을 그려보고 추가로 그룹별로 다른 색의 점으로 표현해 보겠습니다.</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1"></a><span class="kw">ggplot</span>(mydata, <span class="kw">aes</span>(<span class="dt">x=</span>weights, <span class="dt">y=</span>heights, <span class="dt">color=</span>classes)) <span class="op">+</span></span>
<span id="cb98-2"><a href="#cb98-2"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb98-3"><a href="#cb98-3"></a><span class="st">  </span><span class="kw">geom_smooth</span>()</span></code></pre></div>
<p>그런데 위와 같은 코드를 실행하면 그룹마다 다른 점과 smooth 선분이 그려집니다. 우리가 원하는 그림은 단지 점만 그룹별로 다른 색으로 표현하고 추세선은 전체 학생들에 대해서 하나의 선분만 그려지길 원합니다. 이제 우리가 알아야할 부분은 각 레이어마다 mapping을 지정할 수 있다는 것이고 이 원리를 이해한다면 다음과 같이 <code>geom_point</code>에서는 <code>color</code>를 mapping해 주고 <code>geom_smooth</code>에서는 지정해주지 않으면 됩니다.</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1"></a><span class="kw">ggplot</span>(mydata) <span class="op">+</span></span>
<span id="cb99-2"><a href="#cb99-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x=</span>weights, <span class="dt">y=</span>heights, <span class="dt">color=</span>classes)) <span class="op">+</span></span>
<span id="cb99-3"><a href="#cb99-3"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="kw">aes</span>(<span class="dt">x=</span>weights, <span class="dt">y=</span>heights))</span></code></pre></div>
<p>그리고 중복되는 부분을 줄여줄 수도 있습니다. 즉, ggplot에서 지정하는 mapping은 하위 layer에 모두 적용이 되며 각 layer마다 다른 mapping 특성을 부여하고 싶을 경우 해당 layer의 mapping 함수 (aes)를 이용하여 설정할 수 있다는 점을 기억하시기 바랍니다.</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1"></a><span class="kw">ggplot</span>(mydata, <span class="kw">aes</span>(<span class="dt">x=</span>weights, <span class="dt">y=</span>heights)) <span class="op">+</span></span>
<span id="cb100-2"><a href="#cb100-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color=</span>classes)) <span class="op">+</span></span>
<span id="cb100-3"><a href="#cb100-3"></a><span class="st">  </span><span class="kw">geom_smooth</span>()</span></code></pre></div>
</div>
<div id="statstics-and-positions" class="section level2">
<h2 number="6.6"><span class="header-section-number">6.6</span> Statstics and positions</h2>
<p>앞서 smoothing 곡선은 실제 데이터에서 관측된 값이 아닌 계산된 값을 그래프에 표현한 것 입니다. 또한 6.3절의 막대그래프에서도 y축 count 값은 관측된 값이 아닌 빈도수를 계산한 값이고 boxplot의 경우도 중간값 1,3사분위수 등 통계량을 표현해 주는 그래프 입니다. 이는 대부분 통계 분석용 소프트웨어에서 제공되는 기능으로 통계량을 가시화 해주는 역할을 합니다. <code>ggplot2</code>에서도 각 geom 레이어에 <code>stat</code>이라는 옵션을 통해 이러한 통계량을 그래프로 표현할 수 있습니다. 예를 들어 앞서 생성한 키, 몸무게 데이터에서 키의 분포를 보기 위한 히스토그램을 그리면 <code>geom_histogram</code>을 사용할 수 있고 이 레이어의 <code>stat</code> 옵션의 기본값은 <code>"bin"</code> 입니다 (<code>?geom_histogram</code> 참고).</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1"></a><span class="kw">ggplot</span>(mydata, <span class="kw">aes</span>(<span class="dt">x=</span>heights)) <span class="op">+</span></span>
<span id="cb101-2"><a href="#cb101-2"></a><span class="st">  </span><span class="kw">geom_histogram</span>()</span></code></pre></div>
<p>경고 문구의 <code>bins=30</code>은 기본 <code>stat</code>옵션이 <code>bin</code>인데 <code>bins</code>옵션은 null로 되어 있기 때문에 경고가 발생한 것이고 30으로 강제 할당해서 그린다는 메세지 입니다. bins 옵션을 다르게 해서 테스트 해보시기 바랍니다. 또한 앞서 6.3절의 bargraph 에서 <code>stat="identity"</code>로 그래프를 그린 경우는 데이터 값을 그대로 그린다는 것도 다시 기억해 보시기 바랍니다.</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1"></a><span class="kw">ggplot</span>(mydata, <span class="kw">aes</span>(<span class="dt">x=</span>heights)) <span class="op">+</span></span>
<span id="cb102-2"><a href="#cb102-2"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">bins=</span><span class="dv">20</span>)</span></code></pre></div>
<p>또 다른 예를위해 앞서 키 몸무게 데이터에 혈액형 변수를 추가해 보겠습니다. 혈액형은 위 4개 학급에 관계 없이 A, B, O, AB 네 그룹으로 나눌 수 있으며 200명의 학생들에게 랜덤하게 할당하도록 합니다.</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1"></a>bloodtype &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;O&quot;</span>, <span class="st">&quot;AB&quot;</span>), <span class="kw">nrow</span>(mydata), <span class="dt">replace=</span>T)</span>
<span id="cb103-2"><a href="#cb103-2"></a>mynewdata &lt;-<span class="st"> </span><span class="kw">data.frame</span>(mydata, bloodtype)</span>
<span id="cb103-3"><a href="#cb103-3"></a><span class="kw">str</span>(mynewdata)</span></code></pre></div>
<p>위와 같이 새로운 변수 bloodtype 이 <code>factor</code>형으로 추가되어 새로운 <code>data.frame</code>을 생성하도록 했습니다. 이제 각 학급별로 몇 명의 혈액형 타입을 갖는 학생들이 있는지를 막대그래프로 표현해 보도록 하겠습니다. 혈액형의 타입별로 다른 색으로 막대를 칠하도록 해봅니다. 막대그래프의 색은 <code>fill</code>옵션으로 채울수 있고 막대그래프는 <code>geom_bar</code>그리고 이 레이어의 <code>stat</code>은 기본값이 <code>count</code>이므로 따로 명시하지 않은채로 다음과 같이 코드를 작성할 수 있습니다.</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1"></a><span class="kw">ggplot</span>(mynewdata, <span class="kw">aes</span>(<span class="dt">x=</span>classes, <span class="dt">fill=</span>bloodtype)) <span class="op">+</span></span>
<span id="cb104-2"><a href="#cb104-2"></a><span class="st">  </span><span class="kw">geom_bar</span>()</span></code></pre></div>
<p>그런데 위와같이 그래프가 위로 쌓여서 보입니다. 이는 <code>geom_bar</code>의 <code>position</code> 기본값이 <code>stack</code>으로 되어있어서 보이는 현상입니다 (<code>?geom_bar</code>참고). 옆으로 나란히 막대를 위치시킨 후 크기를 비교하기 위해서 <code>position="dodge"</code>를 사용합니다. 또한 막대그래프에 칠해지는 색의 투명도를 <code>alpha</code> 옵션을 사용해 변경할 수 있습니다.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1"></a><span class="kw">ggplot</span>(mynewdata, <span class="kw">aes</span>(<span class="dt">x=</span>classes, <span class="dt">fill=</span>bloodtype)) <span class="op">+</span></span>
<span id="cb105-2"><a href="#cb105-2"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">alpha=</span><span class="fl">0.5</span>, <span class="dt">position=</span><span class="st">&quot;dodge&quot;</span>)</span></code></pre></div>
<p>다음과 같이 간단히 한 줄만 추가하여 위 막대그래프의 위치를 가로로 전환하거나 Coxcomb chart로 그릴수도 있습니다.</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1"></a><span class="kw">ggplot</span>(mynewdata, <span class="kw">aes</span>(<span class="dt">x=</span>classes, <span class="dt">fill=</span>bloodtype)) <span class="op">+</span></span>
<span id="cb106-2"><a href="#cb106-2"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">position=</span><span class="st">&quot;dodge&quot;</span>) <span class="op">+</span></span>
<span id="cb106-3"><a href="#cb106-3"></a><span class="st">  </span><span class="kw">coord_flip</span>()</span></code></pre></div>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1"></a><span class="kw">ggplot</span>(mynewdata, <span class="kw">aes</span>(<span class="dt">x=</span>classes, <span class="dt">fill=</span>bloodtype)) <span class="op">+</span></span>
<span id="cb107-2"><a href="#cb107-2"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">position=</span><span class="st">&quot;dodge&quot;</span>) <span class="op">+</span></span>
<span id="cb107-3"><a href="#cb107-3"></a><span class="st">  </span><span class="kw">coord_polar</span>()</span></code></pre></div>
<p>참고로 위 Coxcomb 그래프의 경우는 해석이 어렵거나 x, y축의 라벨링에 혼돈이 올수 있으니 정보 전달이 명확하도록 그래프의 옵션들을 추가하거나 용도에 맞게 사용할 필요가 있습니다.</p>
</div>
<div id="themes-labels-and-scales" class="section level2">
<h2 number="6.7"><span class="header-section-number">6.7</span> Themes, Labels, and Scales</h2>
<p>Theme은 data관련 요소들 외의 것들에 대한 설정을 위해서 사용됩니다. 즉, 제목이나 라벨, 배경, 범례 등의 색, 위치, 크기, 모양 등을 설정하는데 사용합니다. 주의할 부분은 해당 택스트 등 데이터를 변경하는 것이 아니고 보여지는 모습만을 바꿀 수 있다는 것 입니다. 택스트 설정은 <code>labs</code>를 사용합니다. 예제를 가지고 몇 가지 실습을 해 보겠습니다. 먼저 <code>labs</code>라는 명령어로 x축, y축, Title 등을 설정할 수 있습니다. 참고로 <code>xlab()</code>, <code>ylab()</code> 등의 함수도 x축, y축 라벨을 설정하는데 사용될 수 있지만 여기서는 <code>labs</code>만을 사용하도록 합니다.</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1"></a><span class="kw">ggplot</span>(mynewdata, <span class="kw">aes</span>(<span class="dt">x=</span>classes, <span class="dt">fill=</span>bloodtype)) <span class="op">+</span></span>
<span id="cb108-2"><a href="#cb108-2"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">position=</span><span class="st">&quot;dodge&quot;</span>) <span class="op">+</span></span>
<span id="cb108-3"><a href="#cb108-3"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="st">&#39;Four classes&#39;</span>,</span>
<span id="cb108-4"><a href="#cb108-4"></a>       <span class="dt">y=</span><span class="st">&#39;Number of students&#39;</span>,</span>
<span id="cb108-5"><a href="#cb108-5"></a>       <span class="dt">title=</span><span class="st">&#39;Blood type distribution&#39;</span>,</span>
<span id="cb108-6"><a href="#cb108-6"></a>       <span class="dt">subtitle =</span> <span class="st">&#39;Blood type distribution from the 200 students&#39;</span>,</span>
<span id="cb108-7"><a href="#cb108-7"></a>       <span class="dt">fill=</span><span class="st">&#39;Blood Types&#39;</span>) </span></code></pre></div>
<p>위 코드에서 <code>labs</code>에서 설정할 수 있는 옵션은 <code>title</code>, <code>subtitle</code>과 x축, y축 라벨 그리고 범례의 title까지 가능합니다. 특히 <code>ggplot</code> 명령에서 <code>aes(fill=bloodtype)</code>이 사용되었으므로 범례의 title은 <code>fill="Blood types"</code>로 설정해야 하며 만약 <code>aes(color=bloodtype)</code>으로 사용되었을 경우에는 <code>color="Blood types"</code>으로 설정합니다. 참고로 범례의 label을 설정하는 방법은 다음과 같이 <code>scale_fill_discrete</code> 함수의 <code>labels</code> 옵션을 사용하면 됩니다. <code>element_blank()</code>는 택스트를 공백으로 설정할 때 사용합니다. 아래 나올 <code>scale</code> 관련 내용과 함께 이해하시면 좋습니다.</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1"></a><span class="kw">ggplot</span>(mynewdata, <span class="kw">aes</span>(<span class="dt">x=</span>classes, <span class="dt">fill=</span>bloodtype)) <span class="op">+</span></span>
<span id="cb109-2"><a href="#cb109-2"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">position=</span><span class="st">&quot;dodge&quot;</span>) <span class="op">+</span></span>
<span id="cb109-3"><a href="#cb109-3"></a><span class="st">  </span><span class="kw">scale_fill_discrete</span>(<span class="dt">name=</span><span class="kw">element_blank</span>(), <span class="dt">labels=</span><span class="kw">c</span>(<span class="st">&quot;A type&quot;</span>, <span class="st">&quot;AB type&quot;</span>, <span class="st">&quot;B type&quot;</span>, <span class="st">&quot;O type&quot;</span>))</span></code></pre></div>
<p>이제 본격적으로 Theme으로 그래프를 장식해 보도록 합니다. <code>Theme</code> 관련된 옵션들은 <a href="https://ggplot2.tidyverse.org/reference/theme.html" class="uri">https://ggplot2.tidyverse.org/reference/theme.html</a> 이곳을 참고하시기 바랍니다. 여기서 mapping은 그대로인채로 모양 등의 설정을 바꿔가면서 그래프의 형태를 확인하는 작업이 반복되므로 다음과 같이 <code>myplot</code>이라는 변수에 기본이 되는 ggplot 코드를 저장하고 이후 <code>+</code> 연산자를 사용해서 옵션을 바꿔가며 편리하게 코드를 재사용 할 수도 있습니다.</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1"></a>myplot &lt;-<span class="st"> </span><span class="kw">ggplot</span>(mynewdata, <span class="kw">aes</span>(<span class="dt">x=</span>classes, <span class="dt">fill=</span>bloodtype)) <span class="op">+</span></span>
<span id="cb110-2"><a href="#cb110-2"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">position=</span><span class="st">&quot;dodge&quot;</span>) <span class="op">+</span></span>
<span id="cb110-3"><a href="#cb110-3"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="st">&#39;Four classes&#39;</span>,</span>
<span id="cb110-4"><a href="#cb110-4"></a>       <span class="dt">y=</span><span class="st">&#39;Number of students&#39;</span>,</span>
<span id="cb110-5"><a href="#cb110-5"></a>       <span class="dt">title=</span><span class="st">&#39;Blood type distribution&#39;</span>,</span>
<span id="cb110-6"><a href="#cb110-6"></a>       <span class="dt">subtitle =</span> <span class="st">&#39;Blood type distribution from the 200 students&#39;</span>,</span>
<span id="cb110-7"><a href="#cb110-7"></a>       <span class="dt">fill=</span><span class="st">&#39;Blood Types&#39;</span>) </span>
<span id="cb110-8"><a href="#cb110-8"></a>myplot <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>()</span></code></pre></div>
<p>위 <code>theme_bw()</code> 함수는 theme의 세부 사항 몇 가지를 미리 설정해 놓아서 (배경을 white 색, 눈금을 회색으로 바꾸는 등) theme 설정을 위한 일련의 과정을 한번에 수행하도록 만든 함수 입니다. theme을 이용한 설정은 plot, axis, legend, panel, facet 등에 적용할 수 있으며 따라서 다음 코드와 같이 해당하는 요소를 참고할 때 <code>.</code> 기호로 구분된 옵션 이름을 사용합니다. 값을 지정할 때에는 <code>element_xxx</code>의 패턴으로 이루어진 함수를 사용합니다. 다음은 각각 plot과 panel 배경색을 바꾸는 코드 입니다.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1"></a>myplot <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill=</span><span class="st">&quot;gray&quot;</span>))</span></code></pre></div>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1"></a>myplot <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">panel.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill=</span><span class="st">&quot;gray&quot;</span>))</span></code></pre></div>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1"></a>myplot <span class="op">+</span><span class="st"> </span></span>
<span id="cb113-2"><a href="#cb113-2"></a><span class="st">  </span><span class="kw">theme</span>(</span>
<span id="cb113-3"><a href="#cb113-3"></a>    <span class="dt">panel.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill=</span><span class="st">&quot;gray&quot;</span>),</span>
<span id="cb113-4"><a href="#cb113-4"></a>    <span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill=</span><span class="st">&quot;gray&quot;</span>)</span>
<span id="cb113-5"><a href="#cb113-5"></a>    )</span></code></pre></div>
<p>또한 축이나 라벨 택스트의 모양도 바꿀 수 있습니다.</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1"></a>myplot <span class="op">+</span><span class="st"> </span></span>
<span id="cb114-2"><a href="#cb114-2"></a><span class="st">  </span><span class="kw">theme</span>(</span>
<span id="cb114-3"><a href="#cb114-3"></a>    <span class="dt">axis.line =</span> <span class="kw">element_line</span>(<span class="dt">arrow =</span> <span class="kw">arrow</span>(<span class="dt">angle =</span> <span class="dv">15</span>, <span class="dt">length =</span> <span class="kw">unit</span>(.<span class="dv">15</span>,<span class="st">&quot;inches&quot;</span>))),</span>
<span id="cb114-4"><a href="#cb114-4"></a>    <span class="dt">axis.text =</span> <span class="kw">element_text</span>(<span class="dt">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="dt">size =</span> <span class="dv">12</span>, <span class="dt">angle =</span> <span class="dv">30</span>),</span>
<span id="cb114-5"><a href="#cb114-5"></a>    <span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">color=</span><span class="st">&quot;blue&quot;</span>, <span class="dt">size=</span><span class="dv">18</span>)</span>
<span id="cb114-6"><a href="#cb114-6"></a>    )</span></code></pre></div>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1"></a>myplot <span class="op">+</span><span class="st"> </span></span>
<span id="cb115-2"><a href="#cb115-2"></a><span class="st">  </span><span class="kw">theme</span>(</span>
<span id="cb115-3"><a href="#cb115-3"></a>    <span class="dt">plot.title=</span><span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">18</span>, <span class="dt">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="dt">color=</span><span class="st">&quot;red&quot;</span>, <span class="dt">hjust=</span><span class="fl">0.5</span>),</span>
<span id="cb115-4"><a href="#cb115-4"></a>    <span class="dt">plot.subtitle =</span> <span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">18</span>, <span class="dt">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="dt">color=</span><span class="st">&quot;gray&quot;</span>)</span>
<span id="cb115-5"><a href="#cb115-5"></a>    )</span></code></pre></div>
<p>위 예제 외에도 다양한 그래프를 그릴 수 있으며 모든 사용법을 외워서 사용하기 보다는 사용할 때 마다 필요한 함수와 옵션을 찾아서 사용하다 보면 점차 익숙해질 것 입니다. 가장 정확한 참고 자료는 공식 reference 페이지를 참고하면 좋으며 <a href="https://ggplot2.tidyverse.org/reference/index.html" class="uri">https://ggplot2.tidyverse.org/reference/index.html</a> 이 외에도 다른 사람들이 만들어 놓은 그래프를 <a href="https://exts.ggplot2.tidyverse.org/" class="uri">https://exts.ggplot2.tidyverse.org/</a> 참고해서 원하는 목적에 맞는 코드를 가져다 사용할 수 있습니다.</p>
<p>본 장에서 마지막으로 소개할 내용은 <code>Scale</code> 입니다. 앞서 어떤 데이터를 x축, y축 또는 group이나 color로 맵핑할지를 결정하는 함수가 <code>aes</code>였다면 scale은 어떻게 (위치, 색상, 크기, 모양 등) 맵핑할 것인가를 설정하는 방법입니다. 함수 형태는 <code>scale_&lt;aesthetic&gt;_&lt;type&gt;</code> 이며 <code>&lt;aesthetic&gt;</code>과 <code>&lt;type&gt;</code>에 해당하는 (미리 지정된) 단어를 넣어주면 되겠습니다. 예를 들어 앞서 예제에서 <code>fill=bloodtype</code>로 혈액형 데이터를 막대그래프의 색을 칠하는데 사용했다면 <code>scale_fill_manual</code> 함수로 어떤 색을 칠할지를 정해주는 방식입니다. 다음 몇 가지 예를 실습해 보고 이해해 봅니다.</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1"></a>myplot <span class="op">+</span><span class="st"> </span></span>
<span id="cb116-2"><a href="#cb116-2"></a><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;orange&quot;</span>, <span class="st">&quot;skyblue&quot;</span>, <span class="st">&quot;royalblue&quot;</span>, <span class="st">&quot;blue&quot;</span>))</span>
<span id="cb116-3"><a href="#cb116-3"></a></span>
<span id="cb116-4"><a href="#cb116-4"></a>myplot <span class="op">+</span><span class="st"> </span></span>
<span id="cb116-5"><a href="#cb116-5"></a><span class="st">  </span><span class="kw">scale_fill_brewer</span>(<span class="dt">palette=</span><span class="st">&quot;BrBG&quot;</span>)</span></code></pre></div>
<p>두 번째 <code>scale_fill_brewer</code>의 경우는 <code>brewer</code>라는 (<a href="https://colorbrewer2.org/" class="uri">https://colorbrewer2.org/</a>) 미리 지정된 색의 조합을 가져와 사용하는 방식입니다. <code>?scale_fill_brewer</code>의 Palettes 섹션을 보시면 사용 가능한 팔레트의 이름이 나와 있으며 위 예제 에서는 BrBG라는 이름의 팔레트를 사용했습니다. 아래는 viridis 라는 이름의 팔레트이며 (<a href="https://bids.github.io/colormap/" class="uri">https://bids.github.io/colormap/</a>) 이러한 팔레트는 R 뿐만 아니라 python, Matlab 등의 다른 프로그래밍 언어에서도 사용할 수 있도록 라이브러리를 제공하고 있습니다.</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1"></a>myplot <span class="op">+</span><span class="st"> </span></span>
<span id="cb117-2"><a href="#cb117-2"></a><span class="st">  </span><span class="kw">scale_fill_viridis_d</span>()</span></code></pre></div>
<p>참고로 앞서 설명한 바와 같이 <code>aes(fill=bloodtype)</code>이 사용되었으므로 <code>scale_fill_viridis_d</code>을 사용했으며 만약 <code>aes(color=bloodtype)</code>으로 사용되었을 경우에는 이에 맞는 <code>scale_fill_viridis_d</code>으로 설정해야 합니다. 맵핑된 데이터가 연속형일 경우에는 (위 학급 예제의 혈액형은 4개의 혈액형으로 나뉘는 범주형 데이터임) <code>scale_fill_gradient</code>, <code>scale_fill_distiller</code> 등의 연속형 데이터에 맞는 scale 함수를 사용해야 합니다. 또한 데이터의 스케일이 log나 지수 단위일 경우에도 일 때에도 <code>scale_x_log10()</code> 등의 함수를 이용해서 x축 또는 y축의 스케일을 변경해줄 수 있습니다. 다음은 간단한 형태의 로그 분포 데이터를 생성하고 히스토그램을 그리는 코드입니다.</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1"></a>mydf &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x=</span><span class="kw">rlnorm</span>(<span class="dv">1000</span>, <span class="kw">log</span>(<span class="dv">10</span>), <span class="kw">log</span>(<span class="fl">2.5</span>)))</span>
<span id="cb118-2"><a href="#cb118-2"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(mydf, <span class="kw">aes</span>(<span class="dt">x=</span>x)) <span class="op">+</span></span>
<span id="cb118-3"><a href="#cb118-3"></a><span class="st">  </span><span class="kw">geom_histogram</span>()</span>
<span id="cb118-4"><a href="#cb118-4"></a>p</span></code></pre></div>
<p>위 히스토그램의 x축을 로그 스케일로 전환하고자 할 때 다음과 같이 <code>scale_x_log10()</code> 함수를 추가하면 됩니다.</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">scale_x_log10</span>()</span></code></pre></div>
<div id="exercise-6.4" class="section level3">
<h3 number="6.7.1"><span class="header-section-number">6.7.1</span> Exercise 6.4</h3>
<p><code>mpg</code> 데이터셋은 38종 자동차의 연비 데이터임. 이 데이터셋을 이용하여 다음 그래프를 그리시오</p>
<ol style="list-style-type: decimal">
<li><p>엔진 배기량과 (displ) 도심연비 (cty)를 비교하는 산포도를 그리고 어떤 연관성이 있는지 설명하시오</p></li>
<li><p>위 산포도의 점들은 실제로는 한 개 이상의 데이터가 겹쳐셔 표현된 경우가 많음. ggplot2에서는 이러한 문제를 극복하기 위해서 <code>position="jitter"</code> 라는 옵션을 사용할 수 있음. 이 옵션을 적용한 코드를 작성하시오.</p></li>
<li><p>위 그래프에 배기량과 (displ) 고속도로연비 (hwy) 산포도를 추가하여 다음과 같이 <code>scale_color_manual()</code> 함수를 사용해서 “red”와 “blue”로 점들을 표현한 그래프를 그리시오. (참고로 이를 위해서 먼저 다음과 같이 mydf 라는 새로운 데이터프레임을 displ, cty, hwy로 만들고 <code>reshape2</code> 패키지의 <code>melt</code> 함수를 이용해서 다음과 같이 <code>mydf_mlt</code> 데이터를 만들어서 사용합니다. <code>melt</code> 함수에 대한 내용은 다음 장에서 설명될 예정입니다. 아래 코드의 <code>mydf_mlt</code> 데이터의 구조와 이들 데이터가 <code>ggplot</code>에서 어떻게 mapping이 이루어 지는지 이해 필요)</p></li>
</ol>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1"></a><span class="kw">library</span>(reshape2)</span>
<span id="cb120-2"><a href="#cb120-2"></a>mydf &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">displ=</span>mpg<span class="op">$</span>displ, <span class="dt">cty=</span>mpg<span class="op">$</span>cty, <span class="dt">hwy=</span>mpg<span class="op">$</span>hwy)</span>
<span id="cb120-3"><a href="#cb120-3"></a>mydf_mlt &lt;-<span class="st"> </span><span class="kw">melt</span>(mydf, <span class="dt">id.vars=</span><span class="st">&quot;displ&quot;</span>)</span>
<span id="cb120-4"><a href="#cb120-4"></a><span class="kw">str</span>(mydf_mlt)</span></code></pre></div>
<p><img src="images/06/ex6-4-2.png" /></p>
<ol start="4" style="list-style-type: decimal">
<li>다음과 같이 배기량과 고속도로/도심 연비의 관계를 나타내는 추세선을 추가하시오 (<code>geom_smooth</code> 이용)</li>
</ol>
<p><img src="images/06/ex6-4-4.png" /></p>
<ol start="5" style="list-style-type: decimal">
<li>아래 그림과 같이 Theme을 <code>theme_bw()</code>를 사용하고 추가로 Title, subtitle, x축, y축 라벨, 그리고 범례의 Title을 변경하시오. (범례의 라벨 설정은 <code>scale_color_manual</code>에서 <code>labels=c("City MPG", "Highway MPG")</code>으로 설정, 범례의 title을 지울때는 <code>name=element_blank()</code>, Title의 택스트 크기는 20, x축, y축의 라벨 텍스트 크기는 18로 설정)</li>
</ol>
<p><img src="images/06/ex6-4-5.png" /></p>
<hr />
<p><a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="크리에이티브 커먼즈 라이선스" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/88x31.png" /></a><br />이 저작물은 <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/">크리에이티브 커먼즈 저작자표시-비영리-변경금지 4.0 국제 라이선스</a>에 따라 이용할 수 있습니다.</p>
<!--chapter:end:06-ggplot2.Rmd-->
</div>
</div>
</div>
<div id="data-transformation-basics" class="section level1">
<h1 number="7"><span class="header-section-number">7</span> Data transformation basics</h1>
<p>일반적인 데이터 분석은 데이터 전처리(변환), 가시화, 모델링(통계분석)의 반복적인 수행으로 진행될 수 있습니다. R에서는 <code>data.frame</code> 형식의 데이터 타입이 주로 사용되며 (최근 <code>tibble</code>형식도 많이 사용됨) 따라서 <code>data.frame</code> 기반의 데이터를 다루기 위한 다양한 함수를 익힐 필요가 있습니다. 앞서 설명한 <code>ggplot2</code> 패키지는 가시화에 사용되는 대표적인 패키지이고 본 장에서는 <code>data.frame</code> 데이터의 전처리나 변환을 위한 함수들을 배워보겠습니다. 먼저 builtin 함수들을 중심으로 설명을 진행하고 이 후에 8장에서 <code>dplyr</code> 패키지에 대한 내용을 다루겠습니다. 앞 3장에서 배웠던 데이터를 저장하는 object의 종류를 먼저 간략히 정리해 봅니다.</p>
<ul>
<li>Vectors - 같은 타입의 데이터를 (Numeric, character, factor, …) 저장한 오브젝트 타입으로 인덱스는 <code>[</code>, <code>]</code> 사용.</li>
<li>Lists - 여러개의 <code>vector</code>를 원소로 가질 수 있으며 이 원소들은 문자나 숫자 어떤 데이터 타입도 가능하고 길이가 달라도 됨. list의 인덱싱에서 <code>[</code> <code>]</code>는 리스트를 반환하고 <code>[[</code> <code>]]</code>는 vector를 반환함.</li>
<li>Matrices - 같은 타입의 데이터로 채워진 2차원 행렬이며 인덱스는 <code>[i, j]</code> 형태로 i는 row, j는 column 을 나타냄. 메트릭스의 생성은 <code>matrix</code> 명령어를 사용하며 왼쪽부터 column 값을 모두 채우고 다음 컬럼 값을 채워 나가는 것이 기본 설정이며 <code>byrow=T</code> 를 통해 row를 먼저 채울수도 있음. row와 column 이름은 <code>rownames</code>와 <code>colnames</code>로 설정이 가능하며 <code>rbind</code>와 <code>cbind</code>로 두 행렬 또는 행렬과 백터를 연결할 수 있음 ( <code>rbind</code>와 <code>cbind</code>의 경우 행렬이 커지면 컴퓨터 리소스 많이 사용함)</li>
<li>data.frame - <code>list</code>와 <code>matrix</code>의 장점을 모은 오브젝트 타입으로 <code>list</code>와 같이 다른 타입의 <code>vector</code>형 변수 여러개가 컬럼에 붙어서 <code>matrix</code> 형태로 구성. 매트릭스와 같이 각 변수의 길이가 (row의 길이) 같아야 함. <code>$</code> 기호로 각 변수들을 인덱싱(접근) 할 수 있고 matrix와 같이 <code>[i,j]</code> 형태의 인덱싱도 가능.</li>
</ul>
<div id="subset-and-filter" class="section level2">
<h2 number="7.1"><span class="header-section-number">7.1</span> subset and filter</h2>
<p>R에서 데이터 저장은 <code>data.frame</code>이나 <code>matrix</code> 타입을 일반적으로 사용합니다. 이 데이터의 일부 열 또는 행의 데이터만을 가져와서 별도로 저장하거나 분석이 필요할 경우가 있습니다. 이 때 인덱싱을 사용해서 일부 데이터를 선택하고 사용할 수 있으며 <code>subset</code>과 <code>filter</code> 함수도 이러한 선별 기능을 제공합니다. <code>subset</code>은 행과 열 모두를 선별할 수 있는 함수이고 <code>filter</code>는 열 (샘플)을 선택하는 함수입니다. 다음 <code>airquality</code> 데이터는 1973년 날짜별로 뉴욕의 공기질을 측정한 데이터 입니다. <code>NA</code>를 제외한 나머지 데이터만으로 새로운 데이터셋을 만들어 봅시다. <code>is.na</code>함수를 사용하면 해당 데이터가 <code>NA</code>일 경우 <code>TRUE</code>, <code>NA</code>가 아닐 경우 <code>FALSE</code> 를 반환해 줍니다.</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1"></a><span class="kw">is.na</span>(airquality<span class="op">$</span>Ozone)</span>
<span id="cb121-2"><a href="#cb121-2"></a>ozone_complete1 &lt;-<span class="st"> </span>airquality[<span class="op">!</span><span class="kw">is.na</span>(airquality<span class="op">$</span>Ozone),]</span>
<span id="cb121-3"><a href="#cb121-3"></a>ozone_complete2 &lt;-<span class="st"> </span><span class="kw">filter</span>(airquality, <span class="op">!</span><span class="kw">is.na</span>(airquality<span class="op">$</span>Ozone))</span>
<span id="cb121-4"><a href="#cb121-4"></a>ozone_complete3 &lt;-<span class="st"> </span><span class="kw">subset</span>(airquality, <span class="op">!</span><span class="kw">is.na</span>(Ozone))</span></code></pre></div>
<p>위 ozone_complete1와 ozone_complete2, ozone_complete3는 같은 결과를 보입니다. 그러나 ozone_complete1, 2보다는 ozone_complete3 코드가 훨씬 직관적이고 가독성이 높습니다. 특히 <code>airquality$ozone</code> 로 <code>$</code>를 사용하여 변수에 접근한 반면 subset 함수는 <code>Ozone</code>이라는 변수 이름을 사용해서 접근함으로써 코드의 간결성과 가독성을 유지할 수 있습니다. 또한 <code>subset</code>의 <code>select</code> 옵션을 이용해서 변수를 선택할 수도 있으며 <code>&amp;</code>(AND)와 <code>|</code>(OR) 연산자를 사용해서 조건을 두 개 이상 설정할 수 있습니다. 아래 <code>select</code> 옵션에서 <code>-</code>는 해당 변수를 제외한다는 의미 입니다.</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1"></a>ozone_complete4 &lt;-<span class="st"> </span><span class="kw">subset</span>(airquality, <span class="op">!</span><span class="kw">is.na</span>(ozone), <span class="dt">select=</span><span class="kw">c</span>(ozone, temp, month, day))</span>
<span id="cb122-2"><a href="#cb122-2"></a>ozone_complete5 &lt;-<span class="st"> </span><span class="kw">subset</span>(airquality, <span class="op">!</span><span class="kw">is.na</span>(ozone) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(solar.r), <span class="dt">select=</span><span class="kw">c</span>(<span class="op">-</span>month, <span class="op">-</span>day))</span></code></pre></div>
<div id="exercise-7.1" class="section level3">
<h3 number="7.1.1"><span class="header-section-number">7.1.1</span> Exercise 7.1</h3>
<ol style="list-style-type: decimal">
<li><p>airquality 데이터에서 <code>Temp</code>와 <code>Ozone</code> 변수로 이루어진 df라는 이름의 <code>data.frame</code>을 만드시오 (단 <code>NA</code>가 있는 샘플(열)은 모두 제외)</p></li>
<li><p><code>ggplot</code>을 이용하여 <code>Temp</code>와 <code>Ozone</code>의 산포도와 추세선을 그리시오</p></li>
</ol>
</div>
</div>
<div id="merging-and-split" class="section level2">
<h2 number="7.2"><span class="header-section-number">7.2</span> merging and split</h2>
<p><code>merge</code> 함수는 두 개 이상의 데이터셋을 통합하는 기능을 수행하는 함수입니다. 특히 <code>rbind</code>나 <code>cbind</code>와는 다르게, 결합하는 두 데이터에 공통적이거나 한 쪽의 데이터를 기준으로 결합을 수행 합니다. <code>?merge</code>를 참고하면 <code>by</code>, <code>by.x</code>, <code>by.y</code>, <code>all</code>, <code>all.x</code>, <code>all.y</code> 등의 옵션으로 이러한 설정을 수행할 수 있습니다. 간단한 예제를 통해서 이해해 보겠습니다.</p>
<p>10명의 사람이 있고 이 사람들의 나이와 성별을 각각 나타낸 두 데이터셋이 있습니다. 그런데 df1은 나이만을 df2는 성별 정보만을 가지고 있으며 두 정보 모두 제공된 사람은 3명 (인덱스 4,5,6) 뿐입니다. 이제 merge를 이용해서 두 데이터셋을 결합해 보겠습니다.</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1"></a><span class="co">## merge</span></span>
<span id="cb123-2"><a href="#cb123-2"></a>df1 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">id=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>), <span class="dt">age=</span><span class="kw">c</span>(<span class="dv">30</span>, <span class="dv">41</span>, <span class="dv">33</span>, <span class="dv">56</span>, <span class="dv">20</span>, <span class="dv">17</span>))</span>
<span id="cb123-3"><a href="#cb123-3"></a>df2 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">id=</span><span class="kw">c</span>(<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>), <span class="dt">gender=</span><span class="kw">c</span>(<span class="st">&quot;f&quot;</span>, <span class="st">&quot;f&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;f&quot;</span>, <span class="st">&quot;m&quot;</span>))</span>
<span id="cb123-4"><a href="#cb123-4"></a></span>
<span id="cb123-5"><a href="#cb123-5"></a>df_inner &lt;-<span class="st"> </span><span class="kw">merge</span>(df1, df2, <span class="dt">by=</span><span class="st">&quot;id&quot;</span>, <span class="dt">all=</span>F)</span>
<span id="cb123-6"><a href="#cb123-6"></a>df_outer &lt;-<span class="st"> </span><span class="kw">merge</span>(df1, df2, <span class="dt">by=</span><span class="st">&quot;id&quot;</span>, <span class="dt">all=</span>T)</span>
<span id="cb123-7"><a href="#cb123-7"></a>df_left_outer &lt;-<span class="st"> </span><span class="kw">merge</span>(df1, df2, <span class="dt">by=</span><span class="st">&quot;id&quot;</span>, <span class="dt">all.x=</span>T)</span>
<span id="cb123-8"><a href="#cb123-8"></a>df_right_outer &lt;-<span class="st"> </span><span class="kw">merge</span>(df1, df2, <span class="dt">by=</span><span class="st">&quot;id&quot;</span>, <span class="dt">all.y=</span>T)</span></code></pre></div>
<p>만약 두 데이터셋의 id가 다를 경우나 각각 다른 기준으로 결합해야 하는 경우는 <code>by</code>대신 <code>by.x</code>, <code>by.y</code> 옵션을 사용할 수 있습니다.</p>
<p><code>split</code> 함수는 데이터를 특정 기준으로 나누는 역할을 하며 해당 기준은 factor 형 벡터 형태로 주어질 수 있습니다. 예를 들어 <code>airquality</code> 데이터의 <code>month</code> 변수를 기준으로 데이터를 분리해 보겠습니다.</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1"></a><span class="kw">str</span>(airquality)</span>
<span id="cb124-2"><a href="#cb124-2"></a>g &lt;-<span class="st"> </span><span class="kw">factor</span>(airquality<span class="op">$</span>Month)</span>
<span id="cb124-3"><a href="#cb124-3"></a>airq_split &lt;-<span class="st"> </span><span class="kw">split</span>(airquality, g)</span>
<span id="cb124-4"><a href="#cb124-4"></a><span class="kw">class</span>(airq_split)</span>
<span id="cb124-5"><a href="#cb124-5"></a><span class="kw">str</span>(airq_split)</span></code></pre></div>
<p>위와 같이 <code>airq_split</code>은 길이가 5인 (5, 6, 7, 8, 9월) <code>list</code>타입이 되었고 각 요소는 서로 다른 size의 <code>data.frame</code>형으로 구성 된 것을 확인할 수 있습니다.</p>
</div>
<div id="transforming-data" class="section level2">
<h2 number="7.3"><span class="header-section-number">7.3</span> transforming data</h2>
<p>R에서 기존 가지고 있는 데이터의 변경은 새로운 변수의 추가, 삭제, 변형과 샘플의 추가, 삭제, 변형을 생각해 볼 수 있습니다. 이러한 기능은 앞에서 배운 <code>merge</code>, <code>split</code>이나 <code>rbind</code>, <code>cbind</code>, 그리고 인덱싱을 활용한 값 변경 등의 방법을 이용할 수 있습니다. 또한 가장 직관적으로 필요한 변수들을 기존 데이터셋에서 추출한 후 <code>data.frame</code> 명령어를 사용해서 새로운 데이터셋으로 만들어주면 될 것 입니다.</p>
<p>이러한 방법들 외에 <code>within</code>을 사용할 경우 특정 변수의 변형과 이를 반영한 새로운 데이터셋을 어렵지 않게 만들수 있습니다. <code>with</code> 함수의 사용 예와 함께 <code>within</code> 함수를 사용하여 데이터를 변형하는 예를 살펴봅니다. <code>with</code>나 <code>within</code> 함수는 R을 활용하는데 많이 사용되는 함수들은 아닙니다. 또한 이러한 기능들은 <code>dplyr</code> 등의 패키지에서 제공하는 경우가 많아서 필수적으로 익힐 부분은 아닙니다. 그러나 개념적인 이해를 돕기위한 좋은 도구들이며 여전히 고수준의 R 사용자들이 코드에 사용하고 있는 함수들이므로 알아두는 것이 좋습니다.</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1"></a><span class="co">## without with</span></span>
<span id="cb125-2"><a href="#cb125-2"></a>ozone_complete &lt;-<span class="st"> </span>airquality[<span class="op">!</span><span class="kw">is.na</span>(airquality<span class="op">$</span>Ozone),<span class="st">&quot;Ozone&quot;</span>]</span>
<span id="cb125-3"><a href="#cb125-3"></a>temp_complete &lt;-<span class="st"> </span>airquality[<span class="op">!</span><span class="kw">is.na</span>(airquality<span class="op">$</span>Temp),<span class="st">&quot;Temp&quot;</span>]</span>
<span id="cb125-4"><a href="#cb125-4"></a><span class="kw">print</span>(<span class="kw">mean</span>(ozone_complete))</span>
<span id="cb125-5"><a href="#cb125-5"></a><span class="kw">print</span>(<span class="kw">mean</span>(temp_complete))</span>
<span id="cb125-6"><a href="#cb125-6"></a></span>
<span id="cb125-7"><a href="#cb125-7"></a><span class="co">## with</span></span>
<span id="cb125-8"><a href="#cb125-8"></a><span class="kw">with</span>(airquality, {</span>
<span id="cb125-9"><a href="#cb125-9"></a>  <span class="kw">print</span>(<span class="kw">mean</span>(Ozone[<span class="op">!</span><span class="kw">is.na</span>(Ozone)]))</span>
<span id="cb125-10"><a href="#cb125-10"></a>  <span class="kw">print</span>(<span class="kw">mean</span>(Temp[<span class="op">!</span><span class="kw">is.na</span>(Temp)]))</span>
<span id="cb125-11"><a href="#cb125-11"></a>})</span></code></pre></div>
<p>위 <code>with</code> 함수에서 보는바와 같이 <code>$</code>를 이용한 변수 접근 대신 <code>with</code>함수 내에서는 (<code>{</code>, <code>}</code> 안에서) 해당 <code>data.frame</code>에 있는 변수 이름을 직접 접근할 수 있으며 따라서 코드의 간결함과 가독성이 향상됩니다.</p>
<p><code>within</code> 함수는 <code>with</code>함수와 같이 <code>{</code>, <code>}</code> 안에서 변수의 이름만으로 해당 변수에 접근이 가능하나 입력된 데이터와 변경된 변수(들)을 반환한다는 점이 다릅니다. 아래 예는 <code>airquality</code> 데이터의 화씨 (Fahrenheit) 온도를 섭씨 (Celsius) 온도로 변환해서 새로운 데이터셋을 만드는 코드입니다. <code>data.frame</code>을 이용한 코드와 비교해 보시기 바랍니다. 데이터셋 내에서 참조할 변수들이 많아질 경우 <code>airquality$xxx</code> 식의 코드를 줄이는 것 만으로도 코드의 가독성과 간결성을 유지할 수 있습니다.</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1"></a>newairquality &lt;-<span class="st"> </span><span class="kw">within</span>(airquality, {</span>
<span id="cb126-2"><a href="#cb126-2"></a>  celsius =<span class="st"> </span><span class="kw">round</span>((<span class="dv">5</span><span class="op">*</span>(Temp<span class="dv">-32</span>))<span class="op">/</span><span class="dv">9</span>, <span class="dv">2</span>)</span>
<span id="cb126-3"><a href="#cb126-3"></a>})</span>
<span id="cb126-4"><a href="#cb126-4"></a><span class="kw">head</span>(newairquality)</span>
<span id="cb126-5"><a href="#cb126-5"></a></span>
<span id="cb126-6"><a href="#cb126-6"></a><span class="co">## data.frame</span></span>
<span id="cb126-7"><a href="#cb126-7"></a>celsius &lt;-<span class="st"> </span><span class="kw">round</span>((<span class="dv">5</span><span class="op">*</span>(airquality<span class="op">$</span>Temp<span class="dv">-32</span>))<span class="op">/</span><span class="dv">9</span>, <span class="dv">2</span>)</span>
<span id="cb126-8"><a href="#cb126-8"></a>newairquality &lt;-<span class="st"> </span><span class="kw">data.frame</span>(airquality, celsius)</span>
<span id="cb126-9"><a href="#cb126-9"></a><span class="kw">head</span>(newairquality)</span></code></pre></div>
</div>
<div id="analysis-example-babies" class="section level2">
<h2 number="7.4"><span class="header-section-number">7.4</span> Analysis example (babies)</h2>
<p><code>UsingR</code> 패키지의 <code>babies</code> 데이터를 이용해서 산모의 흡연 여부와 신생아 몸무게의 관계를 알아보는 분석을 수행해 보겠습니다. 본 강의를 통해 배우지 않은 내용들이 있지만 코드를 따라 가면서 참고하시기 바랍니다. 우선 <code>UsingR</code> 패키지를 로딩합니다. 산모의 임신 기간이 (gestation) 999로 표기된 데이터는 명백히 에러이며 이들을 <code>NA</code>로 처리합니다.</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1"></a><span class="kw">library</span>(UsingR)</span>
<span id="cb127-2"><a href="#cb127-2"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb127-3"><a href="#cb127-3"></a><span class="kw">head</span>(babies)</span>
<span id="cb127-4"><a href="#cb127-4"></a><span class="co">## a simple way to checkout the data</span></span>
<span id="cb127-5"><a href="#cb127-5"></a><span class="kw">plot</span>(babies<span class="op">$</span>gestation)  </span>
<span id="cb127-6"><a href="#cb127-6"></a><span class="co">## or using ggplot...</span></span>
<span id="cb127-7"><a href="#cb127-7"></a><span class="kw">ggplot</span>(babies, <span class="kw">aes</span>(<span class="dt">x=</span><span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(gestation), <span class="dt">y=</span>gestation)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb127-8"><a href="#cb127-8"></a><span class="st">  </span><span class="kw">geom_point</span>()</span>
<span id="cb127-9"><a href="#cb127-9"></a>babies<span class="op">$</span>gestation[babies<span class="op">$</span>gestation<span class="op">&gt;</span><span class="dv">900</span>] &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb127-10"><a href="#cb127-10"></a><span class="kw">str</span>(babies)</span></code></pre></div>
<p>아래와 같이 <code>within</code> 함수를 사용해서 <code>babies$</code> 를 반복해서 입력해주는 불편함을 줄이고 가독성을 높입니다. 똑같은 방법으로 <code>dwt</code> (아빠의 몸무게) 변수의 에러값들에 대해서도 <code>NA</code> 처리를 할 수 있습니다.</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1"></a>new_babies &lt;-<span class="st"> </span><span class="kw">within</span>(babies, {</span>
<span id="cb128-2"><a href="#cb128-2"></a>  gestation[gestation<span class="op">==</span><span class="dv">999</span>] &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb128-3"><a href="#cb128-3"></a>  dwt[dwt<span class="op">==</span><span class="dv">999</span>] &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb128-4"><a href="#cb128-4"></a>})</span>
<span id="cb128-5"><a href="#cb128-5"></a><span class="kw">str</span>(new_babies)</span></code></pre></div>
<p><code>smoke</code> 변수는 흡연 여부를 나타내는 범주형 변수로 0, 1, 2, 3 값은 의미가 없습니다. 사람이 읽을 수 있는 label을 붙인 <code>factor</code> 형 변수로 변환하는 코드도 함께 작성해 보겠습니다.</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1"></a><span class="kw">str</span>(babies<span class="op">$</span>smoke)</span>
<span id="cb129-2"><a href="#cb129-2"></a>new_babies &lt;-<span class="st"> </span><span class="kw">within</span>(babies, {</span>
<span id="cb129-3"><a href="#cb129-3"></a>  gestation[gestation<span class="op">==</span><span class="dv">999</span>] &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb129-4"><a href="#cb129-4"></a>  dwt[dwt<span class="op">==</span><span class="dv">999</span>] &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb129-5"><a href="#cb129-5"></a>  smoke =<span class="st"> </span><span class="kw">factor</span>(smoke)</span>
<span id="cb129-6"><a href="#cb129-6"></a>  <span class="kw">levels</span>(smoke) =<span class="st"> </span><span class="kw">list</span>(</span>
<span id="cb129-7"><a href="#cb129-7"></a>    <span class="st">&quot;never&quot;</span> =<span class="st"> </span><span class="dv">0</span>, </span>
<span id="cb129-8"><a href="#cb129-8"></a>    <span class="st">&quot;smoke now&quot;</span> =<span class="st"> </span><span class="dv">1</span>, </span>
<span id="cb129-9"><a href="#cb129-9"></a>    <span class="st">&quot;until current pregnancy&quot;</span> =<span class="st"> </span><span class="dv">2</span>,</span>
<span id="cb129-10"><a href="#cb129-10"></a>    <span class="st">&quot;once did, not now&quot;</span> =<span class="st"> </span><span class="dv">3</span>)</span>
<span id="cb129-11"><a href="#cb129-11"></a>  })</span>
<span id="cb129-12"><a href="#cb129-12"></a><span class="kw">str</span>(new_babies<span class="op">$</span>smoke)</span></code></pre></div>
<p>이제 임신기간과 흡연 여부를 분석해 볼 수 있습니다. 흡연 그룹별로 기간에 차이가 있는지를 알아보는 분석은 t-test나 ANOVA를 사용할 수 있습니다.</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1"></a>fit &lt;-<span class="st"> </span><span class="kw">lm</span>(gestation<span class="op">~</span>smoke, new_babies)</span>
<span id="cb130-2"><a href="#cb130-2"></a><span class="kw">summary</span>(fit) <span class="co">## t-test 결과 </span></span>
<span id="cb130-3"><a href="#cb130-3"></a><span class="kw">anova</span>(fit)</span></code></pre></div>
<p>간단히 결과를 보면 <code>summary(fit)</code>은 3가지 t-test의 결과를 보여줍니다. never vs. smoke new 의 경우 t값이 -1.657로 피우지 않은 경우에 비해서 피우는 사람의 임신 기간이 유의하게 줄어들었음을 알 수 있습니다. 그에 비해서 현재 흡연하지 않는 경우 (never vs. until current pregnancy 또는 never vs. once did, not now) 차이가 없는 것으로 나옵니다.</p>
<p>이제 smoke now 인 경우 또는 나이가 25세 미만인 경우의 샘플에 대해서 <code>newdf</code>를 만들어 봅니다 (<code>subset</code> 함수 사용, id, gestation, age, wt, smoke 변수 선택). 이 후 <code>ggplot</code>을 이용하여 몸무게와 임신기간의 산점도를 그려보면 크게 다르진 않으나 흡연하는 여성 중 몸무게가 적게 나가는 여성에게서 짧은 임신기간을 갖는 경향을 볼 수 있습니다.</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1"></a>newdf &lt;-<span class="st"> </span><span class="kw">subset</span>(new_babies, (smoke<span class="op">==</span><span class="st">&quot;smoke now&quot;</span> <span class="op">|</span><span class="st"> </span>smoke <span class="op">==</span><span class="st"> &quot;never&quot;</span>) <span class="op">&amp;</span><span class="st"> </span>age <span class="op">&lt;</span><span class="st"> </span><span class="dv">25</span>, <span class="dt">select=</span><span class="kw">c</span>(id, gestation, age, wt, smoke))</span>
<span id="cb131-2"><a href="#cb131-2"></a><span class="kw">ggplot</span>(newdf, <span class="kw">aes</span>(<span class="dt">x=</span>wt, <span class="dt">y=</span>gestation, <span class="dt">color=</span>smoke)) <span class="op">+</span></span>
<span id="cb131-3"><a href="#cb131-3"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size=</span><span class="dv">3</span>, <span class="dt">alpha=</span><span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb131-4"><a href="#cb131-4"></a><span class="st">  </span><span class="kw">facet_grid</span>(.<span class="op">~</span>smoke) <span class="op">+</span><span class="st"> </span></span>
<span id="cb131-5"><a href="#cb131-5"></a><span class="st">  </span><span class="kw">theme_bw</span>()</span></code></pre></div>
<div id="exercise-7.2" class="section level3">
<h3 number="7.4.1"><span class="header-section-number">7.4.1</span> Exercise 7.2</h3>
<p>다음 df 의 hour, minute, second로 나누어진 값들을 초 단위로 변환하여 seconds라는 변수에 저장한 후 기존 df에 추가한 df2 데이터셋을 만드시오 (<code>within</code> 함수 이용)</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">hour=</span><span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">8</span>),</span>
<span id="cb132-2"><a href="#cb132-2"></a>                 <span class="dt">minute=</span><span class="kw">c</span>(<span class="dv">46</span>, <span class="dv">56</span>, <span class="dv">44</span>, <span class="dv">37</span>, <span class="dv">39</span>),</span>
<span id="cb132-3"><a href="#cb132-3"></a>                 <span class="dt">second=</span><span class="kw">c</span>(<span class="dv">19</span>, <span class="dv">45</span>, <span class="dv">57</span>, <span class="dv">41</span>, <span class="dv">27</span>))</span></code></pre></div>
</div>
</div>
<div id="apply" class="section level2">
<h2 number="7.5"><span class="header-section-number">7.5</span> apply</h2>
<p>앞서까지는 데이터를 변형할 때 사용하는 다양한 함수들을 살펴 보았습니다. <code>apply</code>는 데이터를 변형하기 위한 함수라기 보다는 데이터를 다룰 때 각 원소별, 그룹별, row, 또는 column 별로 반복적으로 수행되는 작업을 효율적으로 수행할 수 있도록 해주는 함수입니다. <code>apply</code> 계열의 함수를 적절히 사용하면 효율성이나 편리성 뿐만 아니라 코드의 간결성 등 많은 장점이 있습니다. 쉬운 이해를 위해 <code>colMean</code> 함수를 예로 들면 <code>colMean</code>은 column 또는 row 단위로 해당하는 모든 값들에 대해 평균을 계산해주는 함수이고 <code>apply</code>를 사용할 경우 다음과 같이 <code>apply</code> 함수와 <code>mean</code> 함수를 이용해서 같은 기능을 수행할 수 있습니다. 아래는 <code>babies</code> 데이터의 clearning 된 (위에서 만들었던) <code>new_babies</code> 데이터에 이어서 수행되는 내용입니다.</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1"></a><span class="kw">head</span>(new_babies)</span>
<span id="cb133-2"><a href="#cb133-2"></a>df &lt;-<span class="st"> </span><span class="kw">subset</span>(new_babies, <span class="dt">select=</span><span class="kw">c</span>(gestation, wt, dwt))</span>
<span id="cb133-3"><a href="#cb133-3"></a><span class="kw">colMeans</span>(df, <span class="dt">na.rm=</span>T)</span>
<span id="cb133-4"><a href="#cb133-4"></a><span class="kw">apply</span>(df, <span class="dv">2</span>, mean, <span class="dt">na.rm=</span>T)</span></code></pre></div>
<p>위와 같이 <code>colMeans</code>와 <code>apply</code>가 똑같은 결과를 보여주고 있습니다. 두 번째 인자인 margin의 값으로 (<code>?apply</code>참고) 여기서는 <code>2</code>가 사용되었으며 margin 값이 1인지 2인지에 따라서 다음과 같이 작동을 합니다.</p>
<p><img src="images/07/01.png" /></p>
<p><code>mean</code>외에도 다양한 함수들이 사용될 수 있으며 아래와 같이 임의의 함수를 만들어서 사용할 수 도 있습니다. 아래 코드에서는 <code>function(x)...</code>로 바로 함수의 정의를 넣어서 사용했으나 그 아래 <code>mysd</code> 함수와 같이 미리 함수 하나를 만들고 난 후 함수 이름을 이용해서 <code>apply</code>를 적용할 수 있습니다.</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1"></a><span class="kw">apply</span>(df, <span class="dv">2</span>, sd, <span class="dt">na.rm=</span>T)</span>
<span id="cb134-2"><a href="#cb134-2"></a><span class="kw">apply</span>(df, <span class="dv">2</span>, <span class="cf">function</span>(x){ </span>
<span id="cb134-3"><a href="#cb134-3"></a>  xmean &lt;-<span class="st"> </span><span class="kw">mean</span>(x, <span class="dt">na.rm=</span>T) </span>
<span id="cb134-4"><a href="#cb134-4"></a>  <span class="kw">return</span>(xmean)</span>
<span id="cb134-5"><a href="#cb134-5"></a>  })</span></code></pre></div>
<p><code>apply</code> 함수는 특히 R에서 느리게 작동하는 loop (<code>for</code>, <code>while</code> 등) 문 대신 사용되어 큰 행렬에 대해서도 빠른 계산 속도를 보여줄 수 있습니다.</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1"></a>n &lt;-<span class="st"> </span><span class="dv">40</span></span>
<span id="cb135-2"><a href="#cb135-2"></a>m &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>, n, <span class="dt">replace=</span>T), <span class="dt">ncol=</span><span class="dv">4</span>)</span>
<span id="cb135-3"><a href="#cb135-3"></a>mysd &lt;-<span class="st"> </span><span class="cf">function</span>(x){</span>
<span id="cb135-4"><a href="#cb135-4"></a>  xmean &lt;-<span class="st"> </span><span class="kw">sum</span>(x)<span class="op">/</span><span class="kw">length</span>(x)</span>
<span id="cb135-5"><a href="#cb135-5"></a>  tmpdif &lt;-<span class="st"> </span>x<span class="op">-</span>xmean</span>
<span id="cb135-6"><a href="#cb135-6"></a>  xvar &lt;-<span class="st"> </span><span class="kw">sum</span>(tmpdif<span class="op">^</span><span class="dv">2</span>)<span class="op">/</span>(<span class="kw">length</span>(x)<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb135-7"><a href="#cb135-7"></a>  xsd &lt;-<span class="st"> </span><span class="kw">sqrt</span>(xvar)</span>
<span id="cb135-8"><a href="#cb135-8"></a>  <span class="kw">return</span>(xsd)</span>
<span id="cb135-9"><a href="#cb135-9"></a>}</span>
<span id="cb135-10"><a href="#cb135-10"></a></span>
<span id="cb135-11"><a href="#cb135-11"></a><span class="co">## for </span></span>
<span id="cb135-12"><a href="#cb135-12"></a>results &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">0</span>, <span class="kw">nrow</span>(m))</span>
<span id="cb135-13"><a href="#cb135-13"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(m)){</span>
<span id="cb135-14"><a href="#cb135-14"></a>  results[i] &lt;-<span class="st"> </span><span class="kw">mysd</span>(m[i,])</span>
<span id="cb135-15"><a href="#cb135-15"></a>}</span>
<span id="cb135-16"><a href="#cb135-16"></a><span class="kw">print</span>(results)</span>
<span id="cb135-17"><a href="#cb135-17"></a><span class="kw">apply</span>(m, <span class="dv">1</span>, mysd)</span>
<span id="cb135-18"><a href="#cb135-18"></a><span class="kw">apply</span>(m, <span class="dv">1</span>, sd)</span></code></pre></div>
<p><code>apply</code> 함수 외에도 <code>sapply</code>, <code>lapply</code>, <code>mapply</code> 등의 다양한 <code>apply</code>계열 함수가 쓰일 수 있습니다. 먼저 <code>lapply</code>는 <code>matrix</code> 형태 데이터가 아닌 <code>list</code> 데이터에 사용되어 각 <code>list</code> 원소별로 주어진 기능을 반복해서 수행하며 <code>sapply</code>는 <code>lapply</code>와 유사하나 벡터, 리스트, 데이터프레임 등에 함수를 적용할 수 있고 그 결과를 벡터 또는 행렬로 반환합니다.</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1"></a>x &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">a=</span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">b=</span><span class="kw">exp</span>(<span class="op">-</span><span class="dv">3</span><span class="op">:</span><span class="dv">3</span>), <span class="dt">logic=</span><span class="kw">c</span>(T,T,F,T))</span>
<span id="cb136-2"><a href="#cb136-2"></a><span class="kw">mean</span>(x<span class="op">$</span>a)</span>
<span id="cb136-3"><a href="#cb136-3"></a><span class="kw">lapply</span>(x, mean)</span>
<span id="cb136-4"><a href="#cb136-4"></a><span class="kw">sapply</span>(x, mean)</span>
<span id="cb136-5"><a href="#cb136-5"></a></span>
<span id="cb136-6"><a href="#cb136-6"></a>x &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">a=</span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">b=</span><span class="kw">exp</span>(<span class="op">-</span><span class="dv">4</span><span class="op">:</span><span class="dv">5</span>))</span>
<span id="cb136-7"><a href="#cb136-7"></a><span class="kw">sapply</span>(x, mean)</span>
<span id="cb136-8"><a href="#cb136-8"></a></span>
<span id="cb136-9"><a href="#cb136-9"></a>x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">9</span>, <span class="dv">16</span>)</span>
<span id="cb136-10"><a href="#cb136-10"></a><span class="kw">sapply</span>(x, sqrt)</span>
<span id="cb136-11"><a href="#cb136-11"></a><span class="kw">sqrt</span>(x)</span>
<span id="cb136-12"><a href="#cb136-12"></a></span>
<span id="cb136-13"><a href="#cb136-13"></a>y &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)</span>
<span id="cb136-14"><a href="#cb136-14"></a><span class="kw">sapply</span>(y, <span class="cf">function</span>(x){<span class="dv">2</span><span class="op">*</span>x})</span>
<span id="cb136-15"><a href="#cb136-15"></a>y<span class="op">*</span><span class="dv">2</span></span></code></pre></div>
<p>마지막 예제에서처럼 <code>sapply</code>나 <code>lapply</code>도 임의의 함수를 만들어 적용시킬 수도 있습니다. 자세히 살펴 보면 y는 10개의 값을 갖는 벡터이고 이 벡터의 각 원소 (값에) 함수를 반복해서 적용하는 것 입니다. 함수에서 <code>x</code>는 각 원소의 값을 차례차례 받는 역할을 하므로 1부터 10까지 값이 함수로 들어가 2를 곱한 수가 반환됩니다. 따라서 벡터연산을 하는 <code>y*2</code>와 결과가 같으나 원하는 함수를 정의해서 자유롭게 사용할 수 있다는 장점이 있습니다. 리스트의 경우는 다음과 같이 사용합니다.</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1"></a>y &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">a=</span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">b=</span><span class="kw">exp</span>(<span class="op">-</span><span class="dv">3</span><span class="op">:</span><span class="dv">3</span>), <span class="dt">logic=</span><span class="kw">c</span>(T,T,F,T))</span>
<span id="cb137-2"><a href="#cb137-2"></a>myfunc &lt;-<span class="st"> </span><span class="cf">function</span>(x){</span>
<span id="cb137-3"><a href="#cb137-3"></a>  <span class="kw">return</span>(<span class="kw">mean</span>(x, <span class="dt">na.rm=</span>T))</span>
<span id="cb137-4"><a href="#cb137-4"></a>}</span>
<span id="cb137-5"><a href="#cb137-5"></a><span class="kw">lapply</span>(y, myfunc)</span>
<span id="cb137-6"><a href="#cb137-6"></a><span class="kw">unlist</span>(<span class="kw">lapply</span>(y, myfunc))</span></code></pre></div>
<p>즉, <code>myfunc</code>의 <code>x</code>가 list y의 각 원소들, y[[1]], y[[2]], y[[3]]를 각각 받아서 <code>mean</code> 연산을 수행해 줍니다. 결과로 각 <code>list</code> 원소들의 평균 값이 반환되며 <code>unlist</code> 함수는 <code>list</code> 형태의 반환 값을 <code>vector</code> 형태로 전환해 줍니다.</p>
<div id="exercise-7.3" class="section level3">
<h3 number="7.5.1"><span class="header-section-number">7.5.1</span> Exercise 7.3</h3>
<p>다음은 앞에서 수행했던 <code>airquality</code> 데이터를 월별로 나눈 데이터셋임. 이 데이터셋을 이용하여 각 월별로 온도와 오존 농도의 평균값을 저장한 <code>data.frame</code> 형식의 데이터를 만들기 위하여 다음 단계별 과정에 적절한 코드를 작성하시오</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1"></a><span class="co">## dataset</span></span>
<span id="cb138-2"><a href="#cb138-2"></a>g &lt;-<span class="st"> </span><span class="kw">factor</span>(airquality<span class="op">$</span>month)</span>
<span id="cb138-3"><a href="#cb138-3"></a>airq_split &lt;-<span class="st"> </span><span class="kw">split</span>(airquality, g)</span></code></pre></div>
<ol style="list-style-type: decimal">
<li>다음 <code>df</code>의 <code>ozone</code> 평균을 구하는 <code>ozone_func</code> 함수를 작성하시오 (단 입력은 <code>data.frame</code> 형식의 오브젝트를 받고 출력은 평균값 (정수 값 하나) 출력. <code>mean</code> 함수 사용시 데이터에 <code>NA</code>가 포함되어 있을 경우 <code>na.rm=T</code> 옵션 적용)</li>
</ol>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1"></a><span class="co">## May data.frame</span></span>
<span id="cb139-2"><a href="#cb139-2"></a>df &lt;-<span class="st"> </span>airq_split[[<span class="dv">1</span>]]</span>
<span id="cb139-3"><a href="#cb139-3"></a><span class="co">#</span></span>
<span id="cb139-4"><a href="#cb139-4"></a><span class="co"># write your code here for ozone_func function</span></span>
<span id="cb139-5"><a href="#cb139-5"></a><span class="co">#</span></span>
<span id="cb139-6"><a href="#cb139-6"></a></span>
<span id="cb139-7"><a href="#cb139-7"></a><span class="co">## Usage</span></span>
<span id="cb139-8"><a href="#cb139-8"></a><span class="kw">ozone_func</span>(df)</span>
<span id="cb139-9"><a href="#cb139-9"></a><span class="co">## output</span></span>
<span id="cb139-10"><a href="#cb139-10"></a><span class="co"># 23.61538</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li><p><code>lapply</code>와 <code>ozone_func</code> 함수를 사용하여 <code>airq_split</code> list 데이터의 월별 <code>ozone</code> 평균 값을 구하고 <code>ozone_means</code>에 <code>vector</code> 형식으로 저장하시오</p></li>
<li><p>위 1), 2)와 같은 방법으로 <code>temp_func</code> 함수를 만들고 월별 <code>temp</code>의 평균값을 <code>temp_means</code>에 <code>vector</code> 형식으로 저장하시오.</p></li>
<li><p>위에서 구해진 두 변수값들을 이용하여 <code>air_means</code> 라는 이름의 <code>data.frame</code>으로 저장하시오</p></li>
</ol>
<hr />
<p><a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="크리에이티브 커먼즈 라이선스" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/88x31.png" /></a><br />이 저작물은 <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/">크리에이티브 커먼즈 저작자표시-비영리-변경금지 4.0 국제 라이선스</a>에 따라 이용할 수 있습니다.</p>
<!--chapter:end:07-dplyr.Rmd-->
</div>
</div>
</div>
<div id="data-transformation-with-dplyr" class="section level1">
<h1 number="8"><span class="header-section-number">8</span> Data transformation with dplyr</h1>
<div id="long-and-wide-data-structure" class="section level2">
<h2 number="8.1"><span class="header-section-number">8.1</span> Long and wide data structure</h2>
<p>실험을 디자인하고 데이터를 생성하는 사람과는 달리 데이터 분석 전문가의 입장에서 처음 데이터를 받은 후 분석에 필요한 변수와 값을 구분하는 일은 적절한 데이터 분석을 위해 필수적인 과정입니다. 특히 복잡하고 사이즈가 큰 데이터일 경우는 더욱 중요할 수 있으나 대부분 경험에 의존해서 구분이 진행되고 있습니다. 데이터를 Long 또는 Wide 형으로 이해하고 자유롭게 전환하는 능력은 복잡한 데이터의 성공적인 분석과 체계적인 분석 방법을 수립하는데 기여할 수 있습니다.</p>
<p>Wide형 데이터의 경우 샘플 데이터가 늘어날수록 row에 쌓이고 새로운 변수는 column에 쌓이는 방식으로 데이터가 확장되는 형태 입니다. 엑셀에서 볼 수 있는 일반적인 형식으로 다음 그림과 같습니다.</p>
<p><img src="images/07/05.png" /></p>
<p>long 형 데이터의 경우 ID, variable, value 세가지 변수만 기억하면 되겠습니다. 위 wide형 데이터 경우를 보면 ID, variable, 그리고 value 이 세가지 요인이 주요 구성 요소임을 알 수 있습니다. 샘플을 참조할 수 있는 어떤 변수 (variable)도 ID가 될 수 있으며 2개 이상의 변수가 ID로 지정될 수 있습니다. 참고로 ID를 지정할 경우 해당 ID는 가능하면 중복되지 않는 값들을 갖는 변수를 사용해야 식별자로서 기능을 적절히 수행할 수 있습니다. Long형을 사용할 경우 데이터의 변수가 늘어나도 행의 수만 늘어나므로 코딩의 일관성과 변수들의 그룹을 만들어서 분석하는 등의 장점이 있습니다.</p>
<p>일반적으로 얻어지는 데이터의 형태는 wide형이며 이를 long형으로 변환하기 위해서는 앞에서 잠깐 소개했던 <code>reshape2</code> 패키지의 <code>melt</code>함수를 사용합니다. 그 반대의 경우 <code>dcast</code> 함수를 사용하면 됩니다. <code>tidyverse</code> 패키지에 속한 <code>tidyr</code> 패키지의 <code>gather</code>와 <code>spread</code>를 사용할 수도 있습니다. 본 강의에서는 <code>reshape2</code> 패키지를 사용합니다. <code>melt</code> 함수의 data.frame 에 대한 도움말을 보면 <code>id.vars</code> 와 <code>measure.vars</code> 파라메터들을 볼 수 있으며 이들이 앞서 설명한 id가 될 변수와 value가 될 변수를 지정해 주는 옵션 입니다. <code>value.name</code>을 이용해서 value 값들을 저장하는 변수 이름을 바꿔줄 수 있으며 따로 설정하지 않는 경우 “value”라는 이름으로 저장 됩니다. 아래는 새로운 변수 F가 추가될 때 long 형 데이터에 데이터가 추가되는 경우를 나타낸 그림 입니다.</p>
<p><img src="images/07/06.png" /></p>
<p><code>airquality</code> 데이터는 전형적인 wide형 데이터로 특정 날짜에 네 개의 변수에 해당하는 값들을 측정했습니다. 이 데이터를 long형으로 바꿀 경우 ID를 날짜로 하면 데이터들을 식별 할 수 있습니다. 그런데 날짜는 변수가 Month와 Day두 개로 나누어져 있으므로 다음과 같이 두 변수를 식별 변수로 (id로) 사용 합니다. 확인을 위해 상위 5개의 데이터만 가지고 형 변환을 진행해 보겠습니다.</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1"></a><span class="kw">library</span>(reshape2)</span>
<span id="cb140-2"><a href="#cb140-2"></a>myair &lt;-<span class="st"> </span>airquality[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,]</span>
<span id="cb140-3"><a href="#cb140-3"></a>myair</span>
<span id="cb140-4"><a href="#cb140-4"></a>myair_mlt &lt;-<span class="st"> </span><span class="kw">melt</span>(myair, <span class="dt">id.vars=</span><span class="kw">c</span>(<span class="st">&quot;Month&quot;</span>, <span class="st">&quot;Day&quot;</span>))</span>
<span id="cb140-5"><a href="#cb140-5"></a>myair_mlt</span></code></pre></div>
<p><code>ggplot</code>을 이용한 그래프 작성에는 위와 같은 long형 데이터가 주로 사용됩니다. R을 이용한 데이터 가시화는 이번 장에서 배우는 <code>dplyr</code> 패키지로 wide형 데이터를 편집하고 <code>melt</code> 함수로 long형 데이터로 변환 후 <code>ggplot</code>을 이용하는 방식으로 수행합니다. 두 데이터 포멧에 대한 좀 더 구체적인 내용은 다음 링크를 참고하시기 바랍니다.
<a href="https://www.theanalysisfactor.com/wide-and-long-data/" class="uri">https://www.theanalysisfactor.com/wide-and-long-data/</a></p>
</div>
<div id="dplyr---pipe-operator" class="section level2">
<h2 number="8.2"><span class="header-section-number">8.2</span> dplyr - pipe operator</h2>
<p><code>dplyr</code> (<a href="https://dplyr.tidyverse.org/" class="uri">https://dplyr.tidyverse.org/</a>) 은 <code>ggplot</code>을 개발한 해들리위컴이 (Hadley Wickham) 중심이 되어 만들어 졌으며 <code>ggplot2</code>와 함께 <code>tidyverse</code>의 (<a href="https://www.tidyverse.org/" class="uri">https://www.tidyverse.org/</a>) 핵심 패키지 입니다. 데이터 변환은 앞 7장에서와 같이 R의 builtin 함수에서 이미 제공하는 기능입니다. <code>dplyr</code>은 이러한 기능들에 데이터 크기나 분석의 속도, 편의성을 향상시켜 새롭게 만들어놓은 패키지 입니다. 앞에서 배운 <code>apply</code>와 같은 행렬 연산 기능과 <code>subset</code>, <code>split</code>, <code>group</code> 와 같은 행렬 편집 기능을 더하여 만들어진 도구라고 할 수 있습니다.</p>
<p><code>dplyr</code>의 사용을 위해서는 <code>ggplot</code>의 <code>+</code> 오퍼레이터와 유사하게 여러 명령을 연속적으로 수행하도록 해주는 <code>%&gt;%</code> 파이프 오퍼레이터의 이해가 필요합니다. 파이프 오퍼레이터의 작동법은 간단히 <code>%&gt;%</code>의 왼쪽 코드의 결과를 출력으로 받아 오른쪽 코드의 입력 (첫번째 파라미터의 값)으로 받아들이는 작동을 합니다. 다음 예에서 보면 <code>sin(pi)</code> 와 같은 함수의 일반적인 사용법 대신 <code>pi %&gt;% sin</code> 처럼 사용해도 똑같은 결과를 보여줍니다. <code>cos(sin(pi))</code>와 같이 여러 합수를 중첩하여 사용할 경우와 비교해서 코드의 가독성이나 효율 측면에서 크게 향상된 방법을 제공해 줍니다.</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb141-2"><a href="#cb141-2"></a></span>
<span id="cb141-3"><a href="#cb141-3"></a>pi <span class="op">%&gt;%</span><span class="st"> </span>sin</span>
<span id="cb141-4"><a href="#cb141-4"></a><span class="kw">sin</span>(pi)</span>
<span id="cb141-5"><a href="#cb141-5"></a>pi <span class="op">%&gt;%</span><span class="st"> </span>sin <span class="op">%&gt;%</span><span class="st"> </span>cos</span>
<span id="cb141-6"><a href="#cb141-6"></a><span class="kw">cos</span>(<span class="kw">sin</span>(pi))</span></code></pre></div>
<p>특히 <code>%&gt;%</code>는 이후 설명할 <code>dplyr</code>의 <code>group_by</code>, <code>split</code>, <code>filter</code>, <code>summary</code> 등의 행렬 편집/연산 함수를 빈번히 다양한 조합으로 쓰게되는 상황에서 더 큰 효과를 발휘할 수 있습니다. 그에 앞서 pipe 오퍼레이터의 예제를 좀 더 살펴보겠습니다.</p>
<p><img src="images/07/02.PNG" /></p>
<p>pipe operator의 왼쪽 구문의 결과가 오른쪽 구문의 첫 번째 파라미터의 입력 값으로 처리된다고 말씀 드렸습니다. 즉, 함수에서 사용되는 파라미터가 여러개일 경우가 있으므로 기본적으로 <code>%&gt;%</code> 의 왼쪽 구문의 출력 값은 오른쪽 구문 (함수)의 첫 번째 인자의 입력값으로 들어가는 것 입니다. 이는 다음 예들을 통해서 명확히 알 수 있습니다. 먼저 <code>paste</code>함수는 그 파라미터로 <code>,</code>로 구분되는 여러개의 입력 값을 가질 수 있습니다. 따라서 다음 코드는 <code>x</code>가 <code>paste</code>의 첫 번째 파라미터로 들어가게 되어 <code>"1a", "2a", "3a", "4a", "5a"</code>로 a 앞에 x 값들이 붙어서 출력된 것을 알 수 있습니다.</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1"></a>x &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">5</span></span>
<span id="cb142-2"><a href="#cb142-2"></a>x <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;a&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</span></code></pre></div>
<p>특정 데이터셋의 컬럼별 평균을 구하고 각 평균의 합을 구할 경우를 생각해 봅시다. R에서는 <code>colMeans</code>라는 특별한 함수를 제공하여 컬럼별로 평균을 계산해 줍니다. 그 후 sum 함수를 사용하여 최종 원하는 값을 얻을 수 있습니다. 이러한 코드를 <code>%&gt;%</code> 오퍼레이터를 사용한 경우의 코드와 비교해 볼 수 있습니다.</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1"></a>x &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x=</span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>), <span class="dt">y=</span><span class="kw">c</span>(<span class="dv">201</span><span class="op">:</span><span class="dv">300</span>))</span>
<span id="cb143-2"><a href="#cb143-2"></a><span class="kw">sum</span>(<span class="kw">colMeans</span>(x))</span>
<span id="cb143-3"><a href="#cb143-3"></a></span>
<span id="cb143-4"><a href="#cb143-4"></a>x &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x=</span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>), <span class="dt">y=</span><span class="kw">c</span>(<span class="dv">201</span><span class="op">:</span><span class="dv">300</span>))</span>
<span id="cb143-5"><a href="#cb143-5"></a>x <span class="op">%&gt;%</span><span class="st"> </span>colMeans <span class="op">%&gt;%</span><span class="st"> </span>sum</span></code></pre></div>
<p>그럼 만약 두 번째 파라미터에 입력으로 왼쪽 구문의 출력을 받아들이고 싶을 경우는 어떻게 할까요? 그럴때는 place holer라는 <code>.</code> 을 사용하면 되겠습니다. <code>round</code> 함수는 두 개의 파라미터를 설정할 있 이으며 digits 라는 두 번째 파라미터에 값을 pipe operator로 넘겨주고 싶을 경우 아래와 같이 표현할 수 있습니다.</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1"></a><span class="dv">6</span> <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(pi, <span class="dt">digits=</span>.)</span>
<span id="cb144-2"><a href="#cb144-2"></a><span class="kw">round</span>(pi, <span class="dt">digits=</span><span class="dv">6</span>)</span></code></pre></div>
</div>
<div id="dplyr---important-functions" class="section level2">
<h2 number="8.3"><span class="header-section-number">8.3</span> dplyr - Important functions</h2>
<p>이제 본격적으로 <code>dplyr</code> 함수를 사용해 보겠습니다. <code>dplyr</code>을 구성하는 중요한 함수는 다음 6가지가 있습니다.</p>
<ul>
<li><code>select()</code> - select columns</li>
<li><code>filter()</code> - filter rows</li>
<li><code>arrange()</code> - re-order or arrange rows</li>
<li><code>mutate()</code> - create new columns</li>
<li><code>summarise()</code> - summarise values</li>
<li><code>group_by()</code> - allows for group operations in the “split-apply-combine” concept</li>
<li><code>join()</code> - Merge two data.frames (<code>left_join()</code>, ’right_join()<code>, 'inner_join()</code>, ’full_join()`)</li>
</ul>
<p>이 함수들은 <code>%&gt;%</code>와 함께 쓰이면서 강력한 성능을 발휘합니다. <code>summarise</code> 함수는 특정 값들의 통계 값을 계산해 주는 함수이며 그 외 5개 함수들은 행렬 편집을 위한 함수들로 보시면 되겠습니다. 각각의 설명보다는 직접 간단한 예제를 수행하면서 각각의 기능을 살펴보고 왜 <code>dplyr</code>이 널리 사용되고 그 장점이 무엇인지 파악해 보도록 하겠습니다.</p>
<p>예제에 사용할 데이터는 <code>iris</code> 데이터로 R을 설치하면 기본으로 들어있는 데이터 입니다. 세 종류의 iris 품종에 대한 꽃잎과 꽃받침의 length와 with를 측정해 놓은 데이터 입니다. <code>head</code>와 <code>str</code> 명령어를 <code>%&gt;%</code>를 이용해서 데이터를 살펴 봅니다.</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1"></a>iris <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dv">10</span>)</span>
<span id="cb145-2"><a href="#cb145-2"></a>iris <span class="op">%&gt;%</span><span class="st"> </span>str</span></code></pre></div>
<div id="filter" class="section level3">
<h3 number="8.3.1"><span class="header-section-number">8.3.1</span> filter</h3>
<p>먼저 아래와 같이 <code>filter</code> 함수를 사용해서 원하는 조건의 데이터 (샘플)을 골라낼 수 있습니다.</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1"></a><span class="kw">head</span>(iris)</span>
<span id="cb146-2"><a href="#cb146-2"></a><span class="kw">filter</span>(iris, Species<span class="op">==</span><span class="st">&quot;setosa&quot;</span>, Species<span class="op">==</span><span class="st">&quot;versicolor&quot;</span>)</span>
<span id="cb146-3"><a href="#cb146-3"></a><span class="kw">filter</span>(iris, Species<span class="op">==</span><span class="st">&quot;setosa&quot;</span> <span class="op">&amp;</span><span class="st"> </span>Species<span class="op">==</span><span class="st">&quot;versicolor&quot;</span>)</span>
<span id="cb146-4"><a href="#cb146-4"></a><span class="kw">filter</span>(iris, Species<span class="op">==</span><span class="st">&quot;setosa&quot;</span> <span class="op">|</span><span class="st"> </span>Species<span class="op">==</span><span class="st">&quot;versicolor&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>dim</span></code></pre></div>
<p><code>filter</code>의 <code>,</code>로 구분되는 매개변수는 <code>and</code> 로직으로 묶인 조건입니다. 지난 강좌에서 보셨듯 R에서 <code>and</code>는 <code>&amp;</code>, <code>or</code>는 <code>|</code>, 그리고 not은 <code>!</code> 으로 사용하면 되며 <code>filter</code>에서 <code>,</code>로 구분된 조건은 <code>and</code>와 같다고 보시면 되겠습니다.</p>
<p><img src="images/07/03.png" /></p>
<p>Image from (<a href="https://r4ds.had.co.nz/" class="uri">https://r4ds.had.co.nz/</a>)</p>
</div>
<div id="arrange" class="section level3">
<h3 number="8.3.2"><span class="header-section-number">8.3.2</span> arrange</h3>
<p><code>arrange()</code>는 샘플들의 배열 순서 즉, row의 순서를 바꾸는 기능을 수행합니다. 기본으로 크기가 커지는 순서로 정렬이 진행되며 작아지는 순서를 원할 경우 <code>desc</code> 함수를 사용할 수 있습니다.</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1"></a><span class="kw">arrange</span>(iris, Sepal.Length)</span>
<span id="cb147-2"><a href="#cb147-2"></a><span class="kw">arrange</span>(iris, <span class="kw">desc</span>(Sepal.Length))</span>
<span id="cb147-3"><a href="#cb147-3"></a><span class="kw">arrange</span>(iris, Sepal.Length, Sepal.Width)</span></code></pre></div>
</div>
<div id="select" class="section level3">
<h3 number="8.3.3"><span class="header-section-number">8.3.3</span> select</h3>
<p><code>select()</code> 는 주어진 데이터셋으로부터 관심있는 변수를 (column) 선택하여 보여줍니다. 다음 helper 함수들은 select 함수와 같이 유용하게 쓰일 수 있습니다.</p>
<ul>
<li>starts_with(“abc”) - “abc” 로 시작하는 문자열을 갖는 변수 이름</li>
<li>ends_with(“xyz”) - “xyz”으로 끝나는 문자열을 갖는 변수 이름</li>
<li>contains(“ijk”) - “ijk” 문자열을 포함하는 변수 이름</li>
<li>matches(“(.)\1”) - 정규식, 반복되는 문자</li>
</ul>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1"></a><span class="kw">head</span>(iris)</span>
<span id="cb148-2"><a href="#cb148-2"></a><span class="kw">select</span>(iris, Species, <span class="kw">everything</span>())</span>
<span id="cb148-3"><a href="#cb148-3"></a><span class="kw">select</span>(iris, <span class="op">-</span>Species)</span>
<span id="cb148-4"><a href="#cb148-4"></a><span class="kw">select</span>(iris, <span class="kw">starts_with</span>(<span class="st">&#39;S&#39;</span>))</span>
<span id="cb148-5"><a href="#cb148-5"></a><span class="kw">select</span>(iris, <span class="dt">obs =</span> <span class="kw">starts_with</span>(<span class="st">&#39;S&#39;</span>))</span></code></pre></div>
<p>아래는 <code>matches</code> 함수를 사용한 방법 입니다. 좀 더 복잡한 패턴을 적용하여 변수들을 선택할 수 있으며 <code>grep</code> 함수를 사용할 경우도 정규식 패턴을 적용할 수 있습니다. 아래 <code>(.)\\1</code>은 하나의 문자 <code>.</code>가 (어떤 문자든) 한 번 더 <code>\\1</code> 사용된 변수 이름을 말하며 이는 <code>aavar</code> 의 <code>aa</code>밖에 없으므로 <code>aavar</code>가 선택됩니다. <code>grep</code>에서 <code>^</code> 표시는 맨 처음을 나타내므로 <code>^S</code>는 S로 시작하는 문자가 되겠습니다. 따라서 <code>grep("^S", colnames(iris))</code>의 경우 컬럼 이름 중 S로 시작하는 이름은 True로 그렇지 않으면 False 값을 리턴합니다.</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1"></a>iris2 &lt;-<span class="st"> </span><span class="kw">rename</span>(iris, <span class="dt">aavar =</span> Petal.Length)</span>
<span id="cb149-2"><a href="#cb149-2"></a><span class="kw">select</span>(iris2, <span class="kw">matches</span>(<span class="st">&quot;(.)</span><span class="ch">\\</span><span class="st">1&quot;</span>))</span>
<span id="cb149-3"><a href="#cb149-3"></a>tmp &lt;-iris[,<span class="dv">3</span><span class="op">:</span><span class="dv">5</span>]</span>
<span id="cb149-4"><a href="#cb149-4"></a><span class="kw">colnames</span>(iris)[<span class="kw">grep</span>(<span class="st">&quot;^S&quot;</span>, <span class="kw">colnames</span>(iris))]</span>
<span id="cb149-5"><a href="#cb149-5"></a>iris[,<span class="kw">grep</span>(<span class="st">&quot;^S&quot;</span>, <span class="kw">colnames</span>(iris))]</span>
<span id="cb149-6"><a href="#cb149-6"></a>tmp</span></code></pre></div>
</div>
<div id="mutate" class="section level3">
<h3 number="8.3.4"><span class="header-section-number">8.3.4</span> mutate</h3>
<p><code>mutate()</code> 함수는 새로운 변수를 추가할 수 있는 기능을 제공하며 앞에서 배웠던 <code>within()</code>과 비슷하다고 볼 수 있습니다. 아래와 같이 <code>mutate</code>함수는 sepal_ratio라는 변수를 새로 만들어서 기존 iris 데이터들과 함께 반환해 줍니다.</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1"></a>iris2 &lt;-<span class="st"> </span><span class="kw">mutate</span>(iris, <span class="dt">sepal_ratio =</span> Sepal.Length<span class="op">/</span>Sepal.Width)</span>
<span id="cb150-2"><a href="#cb150-2"></a><span class="kw">head</span>(iris2)</span></code></pre></div>
</div>
<div id="summarise" class="section level3">
<h3 number="8.3.5"><span class="header-section-number">8.3.5</span> summarise</h3>
<p><code>summarise()</code>는 <code>data.frame</code>내 특정 변수의 값들로 하나의 요약값/대푯값을 만들어 줍니다. <code>summarise</code> 함수는 단독으로 쓰이기 보다는 <code>group_by()</code> 기능과 병행해서 쓰이는 경우에 유용하게 쓰입니다. <code>summarise_all()</code> 함수를 사용하면 모든 변수에 대해서 지정된 함수를 실행합니다.</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1"></a><span class="kw">summarise</span>(iris, <span class="kw">mean</span>(Sepal.Length), <span class="dt">m=</span><span class="kw">mean</span>(Sepal.Width))</span>
<span id="cb151-2"><a href="#cb151-2"></a>by_species &lt;-<span class="st"> </span><span class="kw">group_by</span>(iris, Species)</span>
<span id="cb151-3"><a href="#cb151-3"></a><span class="kw">summarise</span>(by_species, <span class="kw">mean</span>(Sepal.Width))</span>
<span id="cb151-4"><a href="#cb151-4"></a><span class="kw">summarise_all</span>(by_species, mean)</span>
<span id="cb151-5"><a href="#cb151-5"></a><span class="kw">summarise_all</span>(by_species, sd)</span></code></pre></div>
</div>
<div id="join" class="section level3">
<h3 number="8.3.6"><span class="header-section-number">8.3.6</span> join</h3>
<p><code>join</code> 함수는 앞 7장에서 배운 <code>merge</code> 함수와 유사한 기능을 수행하는 <code>dplyr</code> 패키지에 속한 함수 입니다. 네 가지 종류의 함수가 있으며 (<code>left_join()</code>, ’right_join()<code>, 'inner_join()</code>, ’full_join()`) 기본적으로 공통되는 이름의 변수를 (key) 이용해서 공통되는 샘플끼리 자동으로 병합해 주는 기능을 수행합니다. 7장에서 사용한 예에 동일하게 적용해 보고 7장의 결과와 비교해 보시기 바랍니다.</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1"></a>df1 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">id=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>), <span class="dt">age=</span><span class="kw">c</span>(<span class="dv">30</span>, <span class="dv">41</span>, <span class="dv">33</span>, <span class="dv">56</span>, <span class="dv">20</span>, <span class="dv">17</span>))</span>
<span id="cb152-2"><a href="#cb152-2"></a>df2 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">id=</span><span class="kw">c</span>(<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>), <span class="dt">gender=</span><span class="kw">c</span>(<span class="st">&quot;f&quot;</span>, <span class="st">&quot;f&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;f&quot;</span>, <span class="st">&quot;m&quot;</span>))</span>
<span id="cb152-3"><a href="#cb152-3"></a></span>
<span id="cb152-4"><a href="#cb152-4"></a><span class="kw">inner_join</span>(df1, df2)</span>
<span id="cb152-5"><a href="#cb152-5"></a><span class="kw">left_join</span>(df1, df2)</span>
<span id="cb152-6"><a href="#cb152-6"></a><span class="kw">right_join</span>(df1, df2)</span>
<span id="cb152-7"><a href="#cb152-7"></a><span class="kw">full_join</span>(df1, df2)</span></code></pre></div>
<p>위 예에서는 <code>id</code>라는 공통되는 변수에 의해서 병합이 수행되는 것을 알 수 있습니다.</p>
</div>
<div id="code-comparison" class="section level3">
<h3 number="8.3.7"><span class="header-section-number">8.3.7</span> code comparison</h3>
<p>이제 split, apply, combine을 활용하여 평균을 구하는 코드와 <code>dplyr</code> 패키지를 사용하여 만든 코드를 비교해 보도록 하겠습니다. <code>split</code>은 <code>factor</code>형 변수인 Species를 기준으로 <code>iris</code> 데이터를 나누어 주는 역할을 하며 <code>lapply</code>는 <code>list</code> 형 데이터인 <code>iris_split</code>을 각 리스트의 각각의 원소들에 대해서 임의의 함수 <code>function(x)...</code> 를 수행하는 역할을 합니다. 마지막 <code>data.frame</code>으로 최종 경로를 combine 합니다.</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1"></a>iris_split &lt;-<span class="st"> </span><span class="kw">split</span>(iris, iris<span class="op">$</span>Species)</span>
<span id="cb153-2"><a href="#cb153-2"></a>iris_means &lt;-<span class="st"> </span><span class="kw">lapply</span>(iris_split, <span class="cf">function</span>(x){<span class="kw">colMeans</span>(x[,<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>])})</span>
<span id="cb153-3"><a href="#cb153-3"></a>iris_means_df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(iris_means)</span>
<span id="cb153-4"><a href="#cb153-4"></a>iris_means_df</span></code></pre></div>
<p>위 코드를 한 줄로 사용하여 최종 iris_means_df 데이터를 를 구한다면 다음과 같이 됩니다. 한눈에 코드가 들어오지 않고 이렇게 중첩해서 함수를 사용하는 습관은 어떤 프로그래밍 언어에서도 권장하지 않습니다.</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1"></a>iris_means_df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">lapply</span>(<span class="kw">split</span>(iris, iris<span class="op">$</span>Species), <span class="cf">function</span>(x){<span class="kw">colMeans</span>(x[,<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>])}))</span></code></pre></div>
<p>아래는 <code>dplyr</code> 패키지를 사용한 코드 입니다.</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1"></a>iris_means_df2 &lt;-<span class="st"> </span>iris <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb155-2"><a href="#cb155-2"></a><span class="st">  </span><span class="kw">group_by</span>(Species) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb155-3"><a href="#cb155-3"></a><span class="st">  </span><span class="kw">summarise_all</span>(mean)</span></code></pre></div>
<p>위에서 보듯 <code>dplyr</code> 패키지를 사용할 경우 그 결과는 같으나 코드의 가독성과 효율성면에서 장점을 보여줍니다. <code>iris</code> 데이터를 받아서 Species에 명시된 그룹으로 나누고 <code>mean</code> 함수를 모든 컬럼에 대해서 사용하라는 의미 입니다.</p>
<p>이제 <code>ggplot</code>을 이용하여 각 평균에 대한 <code>barplot</code>을 그려보도록 하겠습니다. 지난 예제와는 달리 <code>ggplot</code>에서는 data만 명시해 주고 <code>geom_bar</code>에 <code>aes</code>와 <code>stat</code>을 모두 사용한 것이 다릅니다. ggplot 구문에서 지정해주는 <code>aes</code> 등의 옵션은 하위 geom_xxx 레이어들에 모두 적용이 되고 각 geom_xxx 레이어에서 지정해주는 <code>aes</code>는 해당 레이어에서만 효과를 나타냅니다.</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1"></a><span class="kw">ggplot</span>(iris_means_df2) <span class="op">+</span></span>
<span id="cb156-2"><a href="#cb156-2"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">x=</span>Species, <span class="dt">y=</span>Sepal.Length), <span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>)</span></code></pre></div>
<p><code>dplyr</code>의 전신이라 할 수 있는 <code>plyr</code> 패키지는 다음과 같이 설명이 되어 있습니다. <em>A set of tools for a common set of problems: you need to split up a big data structure into homogeneous pieces, apply a function to each piece and then combine all the results back together.</em> 즉 split-apply-combine 세 가지 동작을 쉽게 할 수 있도록 만들어 놓은 툴 입니다. R이 다른 언어에 비해 데이터 분석에서 주목을 받는 이유로 <code>split</code>, <code>apply</code> 등의 행렬 연산 함수가 발달한 것을 내세우는데 <code>dplyr</code>은 이들을 보다 더 편리하게 사용할 수 있도록 만들어 놓은 것 입니다.</p>
<p>위 <code>dplyr</code> 패키지의 기능을 <code>ggplot2</code> 패키지의 기능들과 함께 사용할 수도 있습니다. 보통은 앞서와 같이 결과를 특정 변수에 저장한 후 도표 등을 그리지만 다음과 같이 <code>%&gt;%</code> 를 사용하여 <code>plot</code> 까지 함께 볼 수도 있습니다.</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1"></a>iris <span class="op">%&gt;%</span></span>
<span id="cb157-2"><a href="#cb157-2"></a><span class="st">  </span><span class="kw">group_by</span>(Species) <span class="op">%&gt;%</span></span>
<span id="cb157-3"><a href="#cb157-3"></a><span class="st">  </span><span class="kw">summarise_all</span>(mean) <span class="op">%&gt;%</span></span>
<span id="cb157-4"><a href="#cb157-4"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb157-5"><a href="#cb157-5"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">x=</span>Species, <span class="dt">y=</span>Sepal.Length), <span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="dplyr-example-iris" class="section level2">
<h2 number="8.4"><span class="header-section-number">8.4</span> dplyr example iris</h2>
<p><code>dplyr</code>패키지를 이용해서 <code>iris</code> 품종별로 꽃과 꽃받침의 넓이와 길이의 평균을 비교하는 bar그래프를 (error bar 포) 그려보겠습니다. 이를 위해서는 먼저 iris 데이터를 품종별로 grouping 할 필요가 있습니다.</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1"></a>iris2 &lt;-<span class="st"> </span>iris <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(Species)</span>
<span id="cb158-2"><a href="#cb158-2"></a><span class="kw">str</span>(iris2)</span></code></pre></div>
<p>이제 그룹별로 꽃과 꽃받침 길이와 넓이의 평균을 일괄적으로 구합니다.</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1"></a>iris3 &lt;-<span class="st"> </span>iris2 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb159-2"><a href="#cb159-2"></a><span class="st">  </span><span class="kw">summarize_all</span>(mean)</span>
<span id="cb159-3"><a href="#cb159-3"></a>iris3</span></code></pre></div>
<!-- error bar를 위한 표준편차까지 일괄적으로 구하기 위해서는 다음과 같이 수행합니다. 사용되는 함수 (mean, sd)를 여러개 전달할 필요가 있으므로 `list` 형태로 진행합니다. -->
<!-- ```{r, eval=F} -->
<!-- iris3 <- iris2 %>%  -->
<!--   summarize_all(list(mean=mean, sd=sd)) -->
<!-- str(iris3) -->
<!-- ``` -->
<p>이제 이 값들을 이용해서 barplot으로 그려봅니다. 그래프의 x축은 species별 Length나 Width mean 값으로 하고 y축은 각 해당하는 값들로 `stat=“identity”’로 넣어주면 될 듯 합니다. ggplot을 이용해서 그래프를 그리기 위한 long형 데이터로 전환해보면 다음과 같습니다.</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1"></a>iris4 &lt;-<span class="st"> </span>iris3 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb160-2"><a href="#cb160-2"></a><span class="st">  </span><span class="kw">melt</span>(<span class="dt">id.var=</span><span class="st">&quot;Species&quot;</span>)</span>
<span id="cb160-3"><a href="#cb160-3"></a><span class="kw">str</span>(iris4)</span></code></pre></div>
<p>위 데이터로 barplot을 그릴 수 있습니다.</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1"></a><span class="kw">ggplot</span>(iris4, <span class="kw">aes</span>(<span class="dt">x=</span>variable, <span class="dt">y=</span>value, <span class="dt">fill=</span>Species)) <span class="op">+</span></span>
<span id="cb161-2"><a href="#cb161-2"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>, <span class="dt">position=</span><span class="st">&quot;dodge&quot;</span>)</span></code></pre></div>
<p>위 일련의 과정을 다음과 같이 %&gt;% 로 연속적으로 구현할 수 있습니다.</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1"></a>iris_mean &lt;-<span class="st"> </span>iris <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb162-2"><a href="#cb162-2"></a><span class="st">  </span><span class="kw">group_by</span>(Species) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb162-3"><a href="#cb162-3"></a><span class="st">  </span><span class="kw">summarize_all</span>(mean) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb162-4"><a href="#cb162-4"></a><span class="st">  </span><span class="kw">melt</span>(<span class="dt">id.var=</span><span class="st">&quot;Species&quot;</span>)</span>
<span id="cb162-5"><a href="#cb162-5"></a></span>
<span id="cb162-6"><a href="#cb162-6"></a><span class="kw">ggplot</span>(iris2, <span class="kw">aes</span>(<span class="dt">x=</span>variable, <span class="dt">y=</span>value, <span class="dt">fill=</span>Species)) <span class="op">+</span></span>
<span id="cb162-7"><a href="#cb162-7"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>, <span class="dt">position=</span><span class="st">&quot;dodge&quot;</span>)</span></code></pre></div>
<p>error bar 구현을 위해서는 각 그룹별 표준편차 <code>sd</code> 값이 필요합니다. 동일한 방법으로 sd 데이터를 구합니다.</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1"></a>iris_sd &lt;-<span class="st"> </span>iris <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb163-2"><a href="#cb163-2"></a><span class="st">  </span><span class="kw">group_by</span>(Species) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb163-3"><a href="#cb163-3"></a><span class="st">  </span><span class="kw">summarize_all</span>(sd) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb163-4"><a href="#cb163-4"></a><span class="st">  </span><span class="kw">melt</span>(<span class="dt">id.var=</span><span class="st">&quot;Species&quot;</span>)</span></code></pre></div>
<p>이제 두 데이터를 병합 하겠습니다. 두 데이터를 병합할 때 key가 되는 변수가 필요하며 기본으로 동일한 이름을 가진 변수를 사용하지만 이 예제에서는 모든 변수가 동일한 이름을 가지고 있습니다. 따라서 by라는 옵션으로 key 변수를 지정해줄 수 있으며 다음과 같이 두 개 이상의 변수도 지정할 수 있습니다.</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1"></a>iris_new &lt;-<span class="st"> </span><span class="kw">inner_join</span>(iris_mean, iris_sd, <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&quot;Species&quot;</span>, <span class="st">&quot;variable&quot;</span>))</span>
<span id="cb164-2"><a href="#cb164-2"></a><span class="kw">head</span>(iris_mean)</span>
<span id="cb164-3"><a href="#cb164-3"></a><span class="kw">head</span>(iris_sd)</span>
<span id="cb164-4"><a href="#cb164-4"></a><span class="kw">head</span>(iris_new)</span></code></pre></div>
<p>위와 같이 각 해당하는 샘플의 mean과 sd 값을 직접 비교해 보면 적절한 value 값들이 병합된 것을 알 수 있습니다. 단, <code>value</code>라는 변수 이름이 두 테이블에서 동일하게 사용되어 병합될 경우 value.x, value.y와 같이 자동으로 변수 이름이 다르게 할당 됩니다. 이제 위 데이터를 이용해서 barplot을 그려 보겠습니다.</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1"></a><span class="kw">ggplot</span>(iris_new, <span class="kw">aes</span>(<span class="dt">x=</span>variable, <span class="dt">y=</span>value.x, <span class="dt">fill=</span>Species))<span class="op">+</span></span>
<span id="cb165-2"><a href="#cb165-2"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>, <span class="dt">position=</span><span class="st">&quot;dodge&quot;</span>)</span></code></pre></div>
<p>여기에 error bar를 추가하기 위해서는 다음과 같이 <code>geom_errorbar</code>라는 함수를 사용할 수 있습니다. 아래에서 <code>position_dodge(0.9)</code>는 error bar의 위치를 맞추기 위한 옵션으로 width를 사용할 경우는 일반적으로 <code>position_dodge(0.9)</code>를 사용한다고 외우는 것도 괜찮습니다.</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1"></a><span class="kw">ggplot</span>(iris_new, <span class="kw">aes</span>(<span class="dt">x=</span>variable, <span class="dt">y=</span>value.x, <span class="dt">fill=</span>Species))<span class="op">+</span></span>
<span id="cb166-2"><a href="#cb166-2"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>, <span class="dt">position=</span><span class="st">&quot;dodge&quot;</span>) <span class="op">+</span></span>
<span id="cb166-3"><a href="#cb166-3"></a><span class="st">  </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin=</span>value.x<span class="op">-</span>value.y, <span class="dt">ymax=</span>value.x<span class="op">+</span>value.y), </span>
<span id="cb166-4"><a href="#cb166-4"></a>                <span class="dt">position=</span><span class="kw">position_dodge</span>(<span class="fl">0.9</span>), </span>
<span id="cb166-5"><a href="#cb166-5"></a>                <span class="dt">width=</span><span class="fl">0.4</span>)</span></code></pre></div>
<!-- ```{r, eval=F} -->
<!-- ggplot(subdat.mlt, aes(x=device_name, y=value, fill=device_name)) + -->
<!--   geom_violin(trim=FALSE) + -->
<!--   geom_jitter(shape=16, position=position_jitter(0.1), color="#00000055") + -->
<!--   scale_fill_brewer(palette="Blues") + -->
<!--   geom_boxplot(width=0.1, fill="white")+ -->
<!--   theme_minimal() + -->
<!--   labs(y="OD600",  -->
<!--        x="DmpR mutant sensors", -->
<!--        fill=element_blank()) + -->
<!--   theme(legend.position = "none",  -->
<!--         axis.text = element_text(size=12), -->
<!--         axis.title=element_text(size=14)) -->
<!-- ``` -->
<hr />
<p><a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="크리에이티브 커먼즈 라이선스" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/88x31.png" /></a><br />이 저작물은 <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/">크리에이티브 커먼즈 저작자표시-비영리-변경금지 4.0 국제 라이선스</a>에 따라 이용할 수 있습니다.</p>
<!--chapter:end:08-dplyr.Rmd-->
</div>
</div>
<div id="exercise-class" class="section level1">
<h1 number="9"><span class="header-section-number">9</span> Exercise class</h1>
<div id="exercise-7.3-1" class="section level2">
<h2 number="9.1"><span class="header-section-number">9.1</span> Exercise 7.3</h2>
<p>연습문제 7.3</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1"></a>g &lt;-<span class="st"> </span><span class="kw">factor</span>(airquality<span class="op">$</span>Month)</span>
<span id="cb167-2"><a href="#cb167-2"></a>airq_split &lt;-<span class="st"> </span><span class="kw">split</span>(airquality, g)</span>
<span id="cb167-3"><a href="#cb167-3"></a>df &lt;-<span class="st"> </span>airq_split[[<span class="dv">1</span>]]</span>
<span id="cb167-4"><a href="#cb167-4"></a></span>
<span id="cb167-5"><a href="#cb167-5"></a>ozone_func &lt;-<span class="st"> </span><span class="cf">function</span>(df){</span>
<span id="cb167-6"><a href="#cb167-6"></a>  oz_mean &lt;-<span class="st"> </span><span class="kw">mean</span>(df<span class="op">$</span>Ozone, <span class="dt">na.rm=</span>T)</span>
<span id="cb167-7"><a href="#cb167-7"></a>  <span class="kw">return</span>(oz_mean)</span>
<span id="cb167-8"><a href="#cb167-8"></a>}</span>
<span id="cb167-9"><a href="#cb167-9"></a></span>
<span id="cb167-10"><a href="#cb167-10"></a><span class="kw">ozone_func</span>(df)</span>
<span id="cb167-11"><a href="#cb167-11"></a>ozone_means &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">lapply</span>(airq_split, ozone_func))</span></code></pre></div>
</div>
<div id="exercise-9.1" class="section level2">
<h2 number="9.2"><span class="header-section-number">9.2</span> Exercise 9.1</h2>
<p>airquality 데이터의 모든 변수에 대한 월별 평균 및 편차 구하기 (dplyr 함수 이용)</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1"></a>airquality <span class="op">%&gt;%</span><span class="st"> </span>str</span>
<span id="cb168-2"><a href="#cb168-2"></a>airquality <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb168-3"><a href="#cb168-3"></a><span class="st">  </span><span class="kw">group_by</span>(Month) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb168-4"><a href="#cb168-4"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">ozone_mean=</span><span class="kw">mean</span>(Ozone, <span class="dt">na.rm=</span>T), <span class="dt">temp_mean=</span><span class="kw">mean</span>(Temp, <span class="dt">na.rm=</span>T))</span>
<span id="cb168-5"><a href="#cb168-5"></a></span>
<span id="cb168-6"><a href="#cb168-6"></a>airquality <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb168-7"><a href="#cb168-7"></a><span class="st">  </span><span class="kw">group_by</span>(Month) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb168-8"><a href="#cb168-8"></a><span class="st">  </span><span class="kw">summarise_all</span>(mean, <span class="dt">na.rm=</span>T)</span>
<span id="cb168-9"><a href="#cb168-9"></a></span>
<span id="cb168-10"><a href="#cb168-10"></a><span class="co">## mean</span></span>
<span id="cb168-11"><a href="#cb168-11"></a>aq_mean &lt;-<span class="st"> </span>airquality <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb168-12"><a href="#cb168-12"></a><span class="st">  </span><span class="kw">group_by</span>(Month) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb168-13"><a href="#cb168-13"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(<span class="op">-</span>Day) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb168-14"><a href="#cb168-14"></a><span class="st">  </span><span class="kw">summarise_all</span>(mean, <span class="dt">na.rm=</span>T)</span>
<span id="cb168-15"><a href="#cb168-15"></a></span>
<span id="cb168-16"><a href="#cb168-16"></a><span class="co">## sd</span></span>
<span id="cb168-17"><a href="#cb168-17"></a>aq_sd &lt;-<span class="st"> </span>airquality <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb168-18"><a href="#cb168-18"></a><span class="st">  </span><span class="kw">group_by</span>(Month) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb168-19"><a href="#cb168-19"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(<span class="op">-</span>Day) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb168-20"><a href="#cb168-20"></a><span class="st">  </span><span class="kw">summarise_all</span>(sd, <span class="dt">na.rm=</span>T)</span></code></pre></div>
</div>
<div id="exercise-9.2" class="section level2">
<h2 number="9.3"><span class="header-section-number">9.3</span> Exercise 9.2</h2>
<p>예제 9.1 데이터 막대그래프로 표현 (에러바 포함)</p>
</div>
<div id="exercise-9.3" class="section level2">
<h2 number="9.4"><span class="header-section-number">9.4</span> Exercise 9.3</h2>
<p>7.4 Babies dataset에서 data filtering 후 wt와 gestation의 산포도 그리기</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1"></a><span class="kw">library</span>(UsingR)</span>
<span id="cb169-2"><a href="#cb169-2"></a><span class="kw">head</span>(babies)</span>
<span id="cb169-3"><a href="#cb169-3"></a></span>
<span id="cb169-4"><a href="#cb169-4"></a>babies <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw">select</span>(wt, gestation, smoke) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb169-5"><a href="#cb169-5"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>wt, <span class="dt">y=</span>gestation)) <span class="op">+</span></span>
<span id="cb169-6"><a href="#cb169-6"></a><span class="st">  </span><span class="kw">geom_point</span>()</span>
<span id="cb169-7"><a href="#cb169-7"></a></span>
<span id="cb169-8"><a href="#cb169-8"></a>b1 &lt;-<span class="st"> </span>babies <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw">select</span>(wt, gestation, smoke) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb169-9"><a href="#cb169-9"></a><span class="st">  </span><span class="kw">filter</span>(gestation<span class="op">!=</span><span class="dv">999</span> <span class="op">&amp;</span><span class="st"> </span>smoke<span class="op">!=</span><span class="dv">9</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb169-10"><a href="#cb169-10"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">smokef=</span><span class="kw">factor</span>(smoke, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;naver&quot;</span>, </span>
<span id="cb169-11"><a href="#cb169-11"></a>                                         <span class="st">&quot;smoke now&quot;</span>,</span>
<span id="cb169-12"><a href="#cb169-12"></a>                                         <span class="st">&quot;until current pre&quot;</span>,</span>
<span id="cb169-13"><a href="#cb169-13"></a>                                         <span class="st">&quot;once did, not now&quot;</span>)))</span>
<span id="cb169-14"><a href="#cb169-14"></a></span>
<span id="cb169-15"><a href="#cb169-15"></a>b1 <span class="op">%&gt;%</span><span class="st"> </span>str</span>
<span id="cb169-16"><a href="#cb169-16"></a></span>
<span id="cb169-17"><a href="#cb169-17"></a><span class="kw">plot</span>(b1<span class="op">$</span>smoke)</span>
<span id="cb169-18"><a href="#cb169-18"></a></span>
<span id="cb169-19"><a href="#cb169-19"></a><span class="kw">ggplot</span>(b1, <span class="kw">aes</span>(<span class="dt">x=</span>wt, <span class="dt">y=</span>gestation, <span class="dt">color=</span>smokef)) <span class="op">+</span></span>
<span id="cb169-20"><a href="#cb169-20"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb169-21"><a href="#cb169-21"></a><span class="st">  </span><span class="kw">facet_wrap</span>(.<span class="op">~</span>smokef, <span class="dt">nrow=</span><span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb169-22"><a href="#cb169-22"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span><span class="st">&quot;lm&quot;</span>, <span class="dt">color=</span><span class="st">&quot;black&quot;</span>) <span class="op">+</span></span>
<span id="cb169-23"><a href="#cb169-23"></a><span class="st">  </span><span class="kw">theme_bw</span>()</span>
<span id="cb169-24"><a href="#cb169-24"></a></span>
<span id="cb169-25"><a href="#cb169-25"></a><span class="co"># average gestation in each smoke group </span></span>
<span id="cb169-26"><a href="#cb169-26"></a>b1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(smokef) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise</span>(<span class="kw">mean</span>(gestation))</span>
<span id="cb169-27"><a href="#cb169-27"></a></span>
<span id="cb169-28"><a href="#cb169-28"></a><span class="co"># correlation between gestation and wt in each smoke group</span></span>
<span id="cb169-29"><a href="#cb169-29"></a>b1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(smokef) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise</span>(<span class="kw">cor</span>(gestation, wt))</span></code></pre></div>
</div>
<div id="exercise-9.4" class="section level2">
<h2 number="9.5"><span class="header-section-number">9.5</span> Exercise 9.4</h2>
<ul>
<li>(Categorical) data generation</li>
<li>Save the data to an excel file (생략)</li>
<li>Read the data from the excel file (생략)</li>
<li>Visualize the data using Boxplot (바이올린)</li>
</ul>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1"></a>n &lt;-<span class="st"> </span><span class="dv">200</span></span>
<span id="cb170-2"><a href="#cb170-2"></a>x1 &lt;-<span class="st"> </span><span class="kw">rnorm</span>(n, <span class="dt">mean=</span><span class="dv">0</span>, <span class="dt">sd=</span><span class="dv">2</span>)</span>
<span id="cb170-3"><a href="#cb170-3"></a>x2 &lt;-<span class="st"> </span><span class="kw">rnorm</span>(n, <span class="dt">mean=</span><span class="dv">5</span>, <span class="dt">sd=</span><span class="dv">2</span>)</span>
<span id="cb170-4"><a href="#cb170-4"></a>x &lt;-<span class="st"> </span><span class="kw">data.frame</span>(x1, x2)</span>
<span id="cb170-5"><a href="#cb170-5"></a><span class="kw">boxplot</span>(x)</span>
<span id="cb170-6"><a href="#cb170-6"></a>x_mlt &lt;-<span class="st"> </span><span class="kw">melt</span>(x)</span>
<span id="cb170-7"><a href="#cb170-7"></a><span class="kw">ggplot</span>(x_mlt, <span class="kw">aes</span>(<span class="dt">x=</span>variable, <span class="dt">y=</span>value)) <span class="op">+</span></span>
<span id="cb170-8"><a href="#cb170-8"></a><span class="st">  </span><span class="kw">geom_boxplot</span>()</span></code></pre></div>
<hr />
<p><a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="크리에이티브 커먼즈 라이선스" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/88x31.png" /></a><br />이 저작물은 <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/">크리에이티브 커먼즈 저작자표시-비영리-변경금지 4.0 국제 라이선스</a>에 따라 이용할 수 있습니다.</p>
<!--chapter:end:09-exercise.Rmd-->
</div>
</div>
<!--bookdown:body:end-->
            </section>

          </div>
        </div>
      </div>
<!--bookdown:link_prev-->
<!--bookdown:link_next-->
    </div>
  </div>
<!--bookdown:config-->

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
